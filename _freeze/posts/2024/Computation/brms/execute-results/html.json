{
  "hash": "ccd802464483bd7140a68dd0003d5b60",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"R によるベイズ推定入門\"\nsubtitle: \"brms を用いたベイズ階層モデリング入門\"\nauthor: \"司馬 博文\"\ndate: 5/12/2024\ndate-modified: 6/5/2024\ncategories: [MCMC, Stan, R]\nbibliography: \n    - ../../../mathematics.bib\n    - ../../../bib.bib\ncsl: ../../../apa.csl\nabstract-title: 概要\nabstract: |\n  `brms` はベイズ階層モデリングを，確率的プログラミング言語 Stan をエンジンとして行うための R パッケージである．本稿では，`brms` の基本的な使い方と，その実装を紹介する．\nformat:\n  html:\n    code-fold: false\nexecute:\n  cache: true\n---\n::: {.hidden}\n\nA Blog Entry on Bayesian Computation by an Applied Mathematician\n\n$$\n%%% 汎用コード列\n\\renewcommand{\\P}{\\operatorname{P}}\\newcommand{\\E}{\\operatorname{E}}\n\\newcommand{\\R}{\\mathbb{R}}\\newcommand{\\F}{\\mathcal{F}}\n\\newcommand{\\abs}[1]{\\lvert#1\\rvert}\\newcommand{\\Abs}[1]{\\left|#1\\right|}\\newcommand{\\ABs}[1]{\\biggl|#1\\biggr|}\\newcommand{\\norm}[1]{\\|#1\\|}\\newcommand{\\Norm}[1]{\\left\\|#1\\right\\|}\\newcommand{\\NOrm}[1]{\\biggl\\|#1\\biggr\\|}\\newcommand{\\Brace}[1]{\\left\\{#1\\right\\}}\\newcommand{\\BRace}[1]{\\biggl\\{#1\\biggr\\}}\\newcommand{\\paren}[1]{\\left(#1\\right)}\\newcommand{\\Paren}[1]{\\biggr(#1\\biggl)}\\newcommand{\\bracket}[1]{\\langle#1\\rangle}\\newcommand{\\brac}[1]{\\langle#1\\rangle}\\newcommand{\\Bracket}[1]{\\left\\langle#1\\right\\rangle}\\newcommand{\\Brac}[1]{\\left\\langle#1\\right\\rangle}\\newcommand{\\bra}[1]{\\left\\langle#1\\right|}\\newcommand{\\ket}[1]{\\left|#1\\right\\rangle}\\newcommand{\\Square}[1]{\\left[#1\\right]}\\newcommand{\\SQuare}[1]{\\biggl[#1\\biggr]}\n\n\\usepackage[all]{xy}\\usepackage{amsmath}\\newcommand{\\y}{\\b{y}}\\newcommand{\\mi}{\\,|\\,}\\newcommand{\\Mark}{\\mathrm{Mark}}\n\n%%% 演算子\n\\DeclareMathOperator{\\grad}{\\mathrm{grad}}\\DeclareMathOperator{\\rot}{\\mathrm{rot}}\\DeclareMathOperator{\\divergence}{\\mathrm{div}}\\DeclareMathOperator{\\tr}{tr}\\DeclareMathOperator{\\Tr}{Tr}\\newcommand{\\pr}{\\mathrm{pr}}\n\\newcommand{\\Map}{\\mathrm{Map}}\\newcommand{\\dom}{\\mathrm{Dom}\\;}\\newcommand{\\cod}{\\mathrm{Cod}\\;}\\newcommand{\\supp}{\\mathrm{supp}\\;}\n\n\n%%% 線型代数学\n\\newcommand{\\vctr}[2]{\\begin{pmatrix}#1\\\\#2\\end{pmatrix}}\\newcommand{\\vctrr}[3]{\\begin{pmatrix}#1\\\\#2\\\\#3\\end{pmatrix}}\\newcommand{\\mtrx}[4]{\\begin{pmatrix}#1&#2\\\\#3&#4\\end{pmatrix}}\\newcommand{\\smtrx}[4]{\\paren{\\begin{smallmatrix}#1&#2\\\\#3&#4\\end{smallmatrix}}}\\newcommand{\\Ker}{\\mathrm{Ker}\\;}\\newcommand{\\Coker}{\\mathrm{Coker}\\;}\\newcommand{\\Coim}{\\mathrm{Coim}\\;}\\DeclareMathOperator{\\rank}{\\mathrm{rank}}\\newcommand{\\lcm}{\\mathrm{lcm}}\\newcommand{\\GL}{\\mathrm{GL}}\\newcommand{\\SL}{\\mathrm{SL}}\\newcommand{\\alt}{\\mathrm{alt}}\\DeclareMathOperator{\\sgn}{sgn}\n%%% 複素解析学\n\\renewcommand{\\Re}{\\mathrm{Re}\\;}\\renewcommand{\\Im}{\\mathrm{Im}\\,}\\newcommand{\\Gal}{\\mathrm{Gal}}\\newcommand{\\PGL}{\\mathrm{PGL}}\\newcommand{\\PSL}{\\mathrm{PSL}}\\newcommand{\\Log}{\\mathrm{Log}\\,}\\newcommand{\\Res}{\\mathrm{Res}\\,}\\newcommand{\\on}{\\mathrm{on}\\;}\\newcommand{\\hatC}{\\widehat{\\C}}\\newcommand{\\hatR}{\\hat{\\R}}\\newcommand{\\PV}{\\mathrm{P.V.}}\\newcommand{\\diam}{\\mathrm{diam}}\\newcommand{\\Area}{\\mathrm{Area}}\\newcommand{\\Lap}{\\Laplace}\\newcommand{\\f}{\\mathbf{f}}\\newcommand{\\cR}{\\mathcal{R}}\\newcommand{\\const}{\\mathrm{const.}}\\newcommand{\\Om}{\\Omega}\\newcommand{\\Cinf}{C^\\infty}\\newcommand{\\ep}{\\epsilon}\\newcommand{\\dist}{\\mathrm{dist}}\\newcommand{\\opart}{\\o{\\partial}}\\newcommand{\\Length}{\\mathrm{Length}}\n%%% 集合と位相\n\\newcommand{\\cA}{\\mathcal{A}}\\newcommand{\\cO}{\\mathcal{O}}\\newcommand{\\cW}{\\mathcal{W}}\\renewcommand{\\O}{\\mathcal{O}}\\renewcommand{\\S}{\\mathcal{S}}\\newcommand{\\U}{\\mathcal{U}}\\newcommand{\\V}{\\mathrm{V}}\\newcommand{\\N}{\\mathbb{N}}\\newcommand{\\bN}{\\mathbb{N}}\\newcommand{\\C}{\\mathrm{C}}\\newcommand{\\bC}{\\mathbb{C}}\\newcommand{\\Z}{\\mathcal{Z}}\\newcommand{\\Q}{\\mathbb{Q}}\\newcommand{\\bQ}{\\mathbb{Q}}\\newcommand{\\TV}{\\mathrm{TV}}\\newcommand{\\ORD}{\\mathrm{ORD}}\\newcommand{\\Card}{\\mathrm{Card}\\,}\\newcommand{\\Top}{\\mathrm{Top}}\\newcommand{\\Disc}{\\mathrm{Disc}}\\newcommand{\\Codisc}{\\mathrm{Codisc}}\\newcommand{\\CoDisc}{\\mathrm{CoDisc}}\\newcommand{\\Ult}{\\mathrm{Ult}}\\newcommand{\\ord}{\\mathrm{ord}}\\DeclareMathOperator{\\maj}{\\mathrm{maj}}\\newcommand{\\bS}{\\mathbb{S}}\\newcommand{\\PConn}{\\mathrm{PConn}}\n\n%%% 形式言語理論\n\\newcommand{\\REGEX}{\\mathrm{REGEX}}\\newcommand{\\RE}{\\mathbf{RE}}\n%%% Graph Theory\n\\newcommand{\\SimpGph}{\\mathrm{SimpGph}}\\newcommand{\\Gph}{\\mathrm{Gph}}\\newcommand{\\mult}{\\mathrm{mult}}\\newcommand{\\inv}{\\mathrm{inv}}\n\n%%% 多様体\n\\newcommand{\\Der}{\\mathrm{Der}}\\newcommand{\\osub}{\\overset{\\mathrm{open}}{\\subset}}\\newcommand{\\osup}{\\overset{\\mathrm{open}}{\\supset}}\\newcommand{\\al}{\\alpha}\\newcommand{\\K}{\\mathbb{K}}\\newcommand{\\Sp}{\\mathrm{Sp}}\\newcommand{\\g}{\\mathfrak{g}}\\newcommand{\\h}{\\mathfrak{h}}\\newcommand{\\Imm}{\\mathrm{Imm}}\\newcommand{\\Imb}{\\mathrm{Imb}}\\newcommand{\\Gr}{\\mathrm{Gr}}\n\\DeclareMathOperator{\\Exp}{Exp}\\DeclareMathOperator{\\codim}{codim}\n%%% 代数\n\\newcommand{\\Ad}{\\mathrm{Ad}}\\newcommand{\\finsupp}{\\mathrm{fin\\;supp}}\\newcommand{\\SO}{\\mathrm{SO}}\\newcommand{\\SU}{\\mathrm{SU}}\\newcommand{\\acts}{\\curvearrowright}\\newcommand{\\mono}{\\hookrightarrow}\\newcommand{\\epi}{\\twoheadrightarrow}\\newcommand{\\Stab}{\\mathrm{Stab}}\\newcommand{\\nor}{\\mathrm{nor}}\\newcommand{\\T}{\\mathbb{T}}\\newcommand{\\Aff}{\\mathrm{Aff}}\\newcommand{\\rsub}{\\triangleleft}\\newcommand{\\rsup}{\\triangleright}\\newcommand{\\subgrp}{\\overset{\\mathrm{subgrp}}{\\subset}}\\newcommand{\\Ext}{\\mathrm{Ext}}\\newcommand{\\sbs}{\\subset}\\newcommand{\\sps}{\\supset}\\newcommand{\\In}{\\mathrm{in}\\;}\\newcommand{\\Tor}{\\mathrm{Tor}}\\newcommand{\\p}{\\b{p}}\\newcommand{\\q}{\\mathfrak{q}}\\newcommand{\\m}{\\mathfrak{m}}\\newcommand{\\cS}{\\mathcal{S}}\\newcommand{\\Frac}{\\mathrm{Frac}\\,}\\newcommand{\\Spec}{\\mathrm{Spec}\\,}\\newcommand{\\bA}{\\mathbb{A}}\\newcommand{\\Sym}{\\mathrm{Sym}}\\newcommand{\\Ann}{\\mathrm{Ann}}\\newcommand{\\Her}{\\mathrm{Her}}\\newcommand{\\Bil}{\\mathrm{Bil}}\\newcommand{\\Ses}{\\mathrm{Ses}}\\newcommand{\\FVS}{\\mathrm{FVS}}\n%%% 代数的位相幾何学\n\\newcommand{\\Ho}{\\mathrm{Ho}}\\newcommand{\\CW}{\\mathrm{CW}}\\newcommand{\\lc}{\\mathrm{lc}}\\newcommand{\\cg}{\\mathrm{cg}}\\newcommand{\\Fib}{\\mathrm{Fib}}\\newcommand{\\Cyl}{\\mathrm{Cyl}}\\newcommand{\\Ch}{\\mathrm{Ch}}\n%%% 微分幾何学\n\\newcommand{\\rP}{\\mathrm{P}}\\newcommand{\\rE}{\\mathrm{E}}\\newcommand{\\e}{\\b{e}}\\renewcommand{\\k}{\\b{k}}\\newcommand{\\Christ}[2]{\\begin{Bmatrix}#1\\\\#2\\end{Bmatrix}}\\renewcommand{\\Vec}[1]{\\overrightarrow{\\mathrm{#1}}}\\newcommand{\\hen}[1]{\\mathrm{#1}}\\renewcommand{\\b}[1]{\\boldsymbol{#1}}\n\n%%% 函数解析\n\\newcommand{\\Inc}{\\mathrm{Inc}}\\newcommand{\\aInc}{\\mathrm{aInc}}\\newcommand{\\HS}{\\mathrm{HS}}\\newcommand{\\loc}{\\mathrm{loc}}\\newcommand{\\Lh}{\\mathrm{L.h.}}\\newcommand{\\Epi}{\\mathrm{Epi}}\\newcommand{\\slim}{\\mathrm{slim}}\\newcommand{\\Ban}{\\mathrm{Ban}}\\newcommand{\\Hilb}{\\mathrm{Hilb}}\\newcommand{\\Ex}{\\mathrm{Ex}}\\newcommand{\\Co}{\\mathrm{Co}}\\newcommand{\\sa}{\\mathrm{sa}}\\newcommand{\\nnorm}[1]{{\\left\\vert\\kern-0.25ex\\left\\vert\\kern-0.25ex\\left\\vert #1 \\right\\vert\\kern-0.25ex\\right\\vert\\kern-0.25ex\\right\\vert}}\\newcommand{\\dvol}{\\mathrm{dvol}}\\newcommand{\\Sconv}{\\mathrm{Sconv}}\\newcommand{\\I}{\\mathcal{I}}\\newcommand{\\nonunital}{\\mathrm{nu}}\\newcommand{\\cpt}{\\mathrm{cpt}}\\newcommand{\\lcpt}{\\mathrm{lcpt}}\\newcommand{\\com}{\\mathrm{com}}\\newcommand{\\Haus}{\\mathrm{Haus}}\\newcommand{\\proper}{\\mathrm{proper}}\\newcommand{\\infinity}{\\mathrm{inf}}\\newcommand{\\TVS}{\\mathrm{TVS}}\\newcommand{\\ess}{\\mathrm{ess}}\\newcommand{\\ext}{\\mathrm{ext}}\\newcommand{\\Index}{\\mathrm{Index}\\;}\\newcommand{\\SSR}{\\mathrm{SSR}}\\newcommand{\\vs}{\\mathrm{vs.}}\\newcommand{\\fM}{\\mathfrak{M}}\\newcommand{\\EDM}{\\mathrm{EDM}}\\newcommand{\\Tw}{\\mathrm{Tw}}\\newcommand{\\fC}{\\mathfrak{C}}\\newcommand{\\bn}{\\boldsymbol{n}}\\newcommand{\\br}{\\boldsymbol{r}}\\newcommand{\\Lam}{\\Lambda}\\newcommand{\\lam}{\\lambda}\\newcommand{\\one}{\\mathbf{1}}\\newcommand{\\dae}{\\text{-a.e.}}\\newcommand{\\das}{\\text{-a.s.}}\\newcommand{\\td}{\\text{-}}\\newcommand{\\RM}{\\mathrm{RM}}\\newcommand{\\BV}{\\mathrm{BV}}\\newcommand{\\normal}{\\mathrm{normal}}\\newcommand{\\lub}{\\mathrm{lub}\\;}\\newcommand{\\Graph}{\\mathrm{Graph}}\\newcommand{\\Ascent}{\\mathrm{Ascent}}\\newcommand{\\Descent}{\\mathrm{Descent}}\\newcommand{\\BIL}{\\mathrm{BIL}}\\newcommand{\\fL}{\\mathfrak{L}}\\newcommand{\\De}{\\Delta}\n%%% 積分論\n\\newcommand{\\calA}{\\mathcal{A}}\\newcommand{\\calB}{\\mathcal{B}}\\newcommand{\\D}{\\mathcal{D}}\\newcommand{\\Y}{\\mathcal{Y}}\\newcommand{\\calC}{\\mathcal{C}}\\renewcommand{\\ae}{\\mathrm{a.e.}\\;}\\newcommand{\\cZ}{\\mathcal{Z}}\\newcommand{\\fF}{\\mathfrak{F}}\\newcommand{\\fI}{\\mathfrak{I}}\\newcommand{\\rV}{\\mathrm{V}}\\newcommand{\\cE}{\\mathcal{E}}\\newcommand{\\sMap}{\\sigma\\textrm{-}\\mathrm{Map}}\\DeclareMathOperator*{\\argmax}{arg\\,max}\\DeclareMathOperator*{\\argmin}{arg\\,min}\\newcommand{\\cC}{\\mathcal{C}}\\newcommand{\\comp}{\\complement}\\newcommand{\\J}{\\mathcal{J}}\\newcommand{\\sumN}[1]{\\sum_{#1\\in\\N}}\\newcommand{\\cupN}[1]{\\cup_{#1\\in\\N}}\\newcommand{\\capN}[1]{\\cap_{#1\\in\\N}}\\newcommand{\\Sum}[1]{\\sum_{#1=1}^\\infty}\\newcommand{\\sumn}{\\sum_{n=1}^\\infty}\\newcommand{\\summ}{\\sum_{m=1}^\\infty}\\newcommand{\\sumk}{\\sum_{k=1}^\\infty}\\newcommand{\\sumi}{\\sum_{i=1}^\\infty}\\newcommand{\\sumj}{\\sum_{j=1}^\\infty}\\newcommand{\\cupn}{\\cup_{n=1}^\\infty}\\newcommand{\\capn}{\\cap_{n=1}^\\infty}\\newcommand{\\cupk}{\\cup_{k=1}^\\infty}\\newcommand{\\cupi}{\\cup_{i=1}^\\infty}\\newcommand{\\cupj}{\\cup_{j=1}^\\infty}\\newcommand{\\limn}{\\lim_{n\\to\\infty}}\\renewcommand{\\L}{\\mathcal{L}}\\newcommand{\\cL}{\\mathcal{L}}\\newcommand{\\Cl}{\\mathrm{Cl}}\\newcommand{\\cN}{\\mathcal{N}}\\newcommand{\\Ae}{\\textrm{-a.e.}\\;}\\newcommand{\\csub}{\\overset{\\textrm{closed}}{\\subset}}\\newcommand{\\csup}{\\overset{\\textrm{closed}}{\\supset}}\\newcommand{\\wB}{\\wt{B}}\\newcommand{\\cG}{\\mathcal{G}}\\newcommand{\\Lip}{\\mathrm{Lip}}\\DeclareMathOperator{\\Dom}{\\mathrm{Dom}}\\newcommand{\\AC}{\\mathrm{AC}}\\newcommand{\\Mol}{\\mathrm{Mol}}\n%%% Fourier解析\n\\newcommand{\\Pe}{\\mathrm{Pe}}\\newcommand{\\wR}{\\wh{\\mathbb{\\R}}}\\newcommand*{\\Laplace}{\\mathop{}\\!\\mathbin\\bigtriangleup}\\newcommand*{\\DAlambert}{\\mathop{}\\!\\mathbin\\Box}\\newcommand{\\bT}{\\mathbb{T}}\\newcommand{\\dx}{\\dslash x}\\newcommand{\\dt}{\\dslash t}\\newcommand{\\ds}{\\dslash s}\n%%% 数値解析\n\\newcommand{\\round}{\\mathrm{round}}\\newcommand{\\cond}{\\mathrm{cond}}\\newcommand{\\diag}{\\mathrm{diag}}\n\\newcommand{\\Adj}{\\mathrm{Adj}}\\newcommand{\\Pf}{\\mathrm{Pf}}\\newcommand{\\Sg}{\\mathrm{Sg}}\n\n%%% 確率論\n\\newcommand{\\aseq}{\\overset{\\text{a.s.}}{=}}\\newcommand{\\deq}{\\overset{\\text{d}}{=}}\\newcommand{\\cV}{\\mathcal{V}}\\newcommand{\\FM}{\\mathrm{FM}}\\newcommand{\\KR}{\\mathrm{KR}}\\newcommand{\\rba}{\\mathrm{rba}}\\newcommand{\\rca}{\\mathrm{rca}}\\newcommand{\\Prob}{\\mathrm{Prob}}\\newcommand{\\X}{\\mathcal{X}}\\newcommand{\\Meas}{\\mathrm{Meas}}\\newcommand{\\as}{\\;\\text{a.s.}}\\newcommand{\\io}{\\;\\mathrm{i.o.}}\\newcommand{\\fe}{\\;\\text{f.e.}}\\newcommand{\\bF}{\\mathbb{F}}\\newcommand{\\W}{\\mathcal{W}}\\newcommand{\\Pois}{\\mathrm{Pois}}\\newcommand{\\iid}{\\text{i.i.d.}}\\newcommand{\\wconv}{\\rightsquigarrow}\\newcommand{\\Var}{\\mathrm{Var}}\\newcommand{\\xrightarrown}{\\xrightarrow{n\\to\\infty}}\\newcommand{\\au}{\\mathrm{au}}\\newcommand{\\cT}{\\mathcal{T}}\\newcommand{\\wto}{\\overset{\\text{w}}{\\to}}\\newcommand{\\dto}{\\overset{\\text{d}}{\\to}}\\newcommand{\\sto}{\\overset{\\text{s}}{\\to}}\\newcommand{\\pto}{\\overset{\\text{p}}{\\to}}\\newcommand{\\mto}{\\overset{\\text{m}}{\\to}}\\newcommand{\\vto}{\\overset{v}{\\to}}\\newcommand{\\Cont}{\\mathrm{Cont}}\\newcommand{\\stably}{\\mathrm{stably}}\\newcommand{\\Np}{\\mathbb{N}^+}\\newcommand{\\oM}{\\overline{\\mathcal{M}}}\\newcommand{\\fP}{\\mathfrak{P}}\\newcommand{\\sign}{\\mathrm{sign}}\n\\DeclareMathOperator{\\Ent}{Ent}\\DeclareMathOperator{\\Polya}{Polya}\\newcommand{\\Borel}{\\mathrm{Borel}}\\newcommand{\\Mid}{\\,|\\,}\\newcommand{\\middleMid}{\\;\\middle|\\;}\\DeclareMathOperator{\\LR}{LR}\\newcommand{\\CP}{\\mathrm{CP}}\\newcommand{\\bD}{\\mathbb{D}}\\newcommand{\\bL}{\\mathbb{L}}\\newcommand{\\fW}{\\mathfrak{W}}\\newcommand{\\DL}{\\mathcal{D}\\mathcal{L}}\\renewcommand{\\r}[1]{\\mathrm{#1}}\\newcommand{\\rC}{\\mathrm{C}}\\newcommand{\\qqquad}{\\qquad\\quad}\n%%% 情報理論\n\\newcommand{\\bit}{\\mathrm{bit}}\\DeclareMathOperator{\\sinc}{sinc}\n%%% 量子論\n\\newcommand{\\err}{\\mathrm{err}}\n%%% 最適化\n\\newcommand{\\varparallel}{\\mathbin{\\!/\\mkern-5mu/\\!}}\\DeclareMathOperator{\\minimize}{minimize}\\DeclareMathOperator{\\subjectto}{subject to}\\newcommand{\\Ri}{\\mathrm{Ri}}\\newcommand{\\Cone}{\\mathrm{Cone}}\\newcommand{\\Int}{\\mathrm{Int}}\n%%% 数理ファイナンス\n\\newcommand{\\pre}{\\mathrm{pre}}\\newcommand{\\om}{\\omega}\n\n%%% 偏微分方程式\n\\DeclareMathOperator{\\div}{div}\n\\newcommand{\\del}{\\partial}\n\\newcommand{\\LHS}{\\mathrm{LHS}}\\newcommand{\\RHS}{\\mathrm{RHS}}\\newcommand{\\bnu}{\\boldsymbol{\\nu}}\\newcommand{\\interior}{\\mathrm{in}\\;}\\newcommand{\\SH}{\\mathrm{SH}}\\renewcommand{\\v}{\\boldsymbol{\\nu}}\\newcommand{\\n}{\\mathbf{n}}\\newcommand{\\ssub}{\\Subset}\\newcommand{\\curl}{\\mathrm{curl}}\n%%% 常微分方程式\n\\newcommand{\\Ei}{\\mathrm{Ei}}\\newcommand{\\sn}{\\mathrm{sn}}\\newcommand{\\wgamma}{\\widetilde{\\gamma}}\n%%% 統計力学\n\\newcommand{\\Ens}{\\mathrm{Ens}}\n%%% 解析力学\n\\newcommand{\\cl}{\\mathrm{cl}}\\newcommand{\\x}{\\boldsymbol{x}}\n\n%%% 統計的因果推論\n\\newcommand{\\Do}{\\mathrm{Do}}\\newcommand{\\IV}{\\mathrm{IV}}\n%%% 応用統計学\n\\DeclareMathOperator{\\pl}{pl}\\newcommand{\\AIC}{\\mathrm{AIC}}\\newcommand{\\mrl}{\\mathrm{mrl}}\\newcommand{\\dotx}{\\dot{x}}\\newcommand{\\UMV}{\\mathrm{UMV}}\\newcommand{\\BLU}{\\mathrm{BLU}}\n%%% 数理統計\n\\DeclareMathOperator{\\arctanh}{arctanh}\\newcommand{\\comb}[2]{\\begin{pmatrix}#1\\\\#2\\end{pmatrix}}\\newcommand{\\bP}{\\mathbb{P}}\\newcommand{\\compsub}{\\overset{\\textrm{cpt}}{\\subset}}\\newcommand{\\lip}{\\textrm{lip}}\\newcommand{\\BL}{\\mathrm{BL}}\\newcommand{\\G}{\\mathbb{G}}\\newcommand{\\NB}{\\mathrm{NB}}\\newcommand{\\oR}{\\ov{\\R}}\\newcommand{\\liminfn}{\\liminf_{n\\to\\infty}}\\newcommand{\\limsupn}{\\limsup_{n\\to\\infty}}\\newcommand{\\esssup}{\\mathrm{ess.sup}}\\newcommand{\\asto}{\\xrightarrow{\\as}}\\newcommand{\\Cov}{\\mathrm{Cov}}\\newcommand{\\cQ}{\\mathcal{Q}}\\newcommand{\\VC}{\\mathrm{VC}}\\newcommand{\\mb}{\\mathrm{mb}}\\newcommand{\\Avar}{\\mathrm{Avar}}\\newcommand{\\bB}{\\mathbb{B}}\\newcommand{\\bW}{\\mathbb{W}}\\newcommand{\\sd}{\\mathrm{sd}}\\newcommand{\\w}[1]{\\widehat{#1}}\\newcommand{\\bZ}{\\mathbb{Z}}\\newcommand{\\Bernoulli}{\\mathrm{Ber}}\\newcommand{\\Ber}{\\mathrm{Ber}}\\newcommand{\\Mult}{\\mathrm{Mult}}\\newcommand{\\BPois}{\\mathrm{BPois}}\\newcommand{\\fraks}{\\mathfrak{s}}\\newcommand{\\frakk}{\\mathfrak{k}}\\newcommand{\\IF}{\\mathrm{IF}}\\newcommand{\\bX}{\\boldsymbol{X}}\\newcommand{\\bx}{\\boldsymbol{x}}\\newcommand{\\indep}{\\perp\\!\\!\\!\\perp}\\newcommand{\\IG}{\\mathrm{IG}}\\newcommand{\\Levy}{\\mathrm{Levy}}\\newcommand{\\MP}{\\mathrm{MP}}\\newcommand{\\Hermite}{\\mathrm{Hermite}}\\newcommand{\\Skellam}{\\mathrm{Skellam}}\\newcommand{\\Dirichlet}{\\mathrm{Dirichlet}}\\newcommand{\\Beta}{\\mathrm{Beta}}\\newcommand{\\bE}{\\mathbb{E}}\\newcommand{\\bG}{\\mathbb{G}}\\newcommand{\\MISE}{\\mathrm{MISE}}\\newcommand{\\logit}{\\mathtt{logit}}\\newcommand{\\expit}{\\mathtt{expit}}\\newcommand{\\cK}{\\mathcal{K}}\\newcommand{\\dl}{\\dot{l}}\\newcommand{\\dotp}{\\dot{p}}\\newcommand{\\wl}{\\wt{l}}\\newcommand{\\Gauss}{\\mathrm{Gauss}}\\newcommand{\\fA}{\\mathfrak{A}}\\newcommand{\\under}{\\mathrm{under}\\;}\\newcommand{\\whtheta}{\\wh{\\theta}}\\newcommand{\\Em}{\\mathrm{Em}}\\newcommand{\\ztheta}{{\\theta_0}}\n\\newcommand{\\rO}{\\mathrm{O}}\\newcommand{\\Bin}{\\mathrm{Bin}}\\newcommand{\\rW}{\\mathrm{W}}\\newcommand{\\rG}{\\mathrm{G}}\\newcommand{\\rB}{\\mathrm{B}}\\newcommand{\\rN}{\\mathrm{N}}\\newcommand{\\rU}{\\mathrm{U}}\\newcommand{\\HG}{\\mathrm{HG}}\\newcommand{\\GAMMA}{\\mathrm{Gamma}}\\newcommand{\\Cauchy}{\\mathrm{Cauchy}}\\newcommand{\\rt}{\\mathrm{t}}\\newcommand{\\rF}{\\mathrm{F}}\n\\DeclareMathOperator{\\erf}{erf}\n%%% 計量経済学\n\\newcommand{\\FE}{\\mathrm{FE}}\\newcommand{\\bV}{\\boldsymbol{V}}\\newcommand{\\GLS}{\\mathrm{GLS}}\\newcommand{\\be}{\\boldsymbol{e}}\\newcommand{\\POOL}{\\mathrm{POOL}}\\newcommand{\\GMM}{\\mathrm{GMM}}\\newcommand{\\MM}{\\mathrm{MM}}\\newcommand{\\SSIV}{\\mathrm{SSIV}}\\newcommand{\\JIV}{\\mathrm{JIV}}\\newcommand{\\AR}{\\mathrm{AR}}\\newcommand{\\ILS}{\\mathrm{ILS}}\\newcommand{\\SLS}{\\mathrm{SLS}}\\newcommand{\\LIML}{\\mathrm{LIML}}\n\n%%% 無限次元統計模型の理論\n\\newcommand{\\Rad}{\\mathrm{Rad}}\\newcommand{\\bY}{\\boldsymbol{Y}}\\newcommand{\\pone}{{(1)}}\\newcommand{\\ptwo}{{(2)}}\\newcommand{\\ps}[1]{{(#1)}}\\newcommand{\\fsub}{\\overset{\\text{finite}}{\\subset}}\n%%% Banach Lattices\n\\newcommand{\\Slv}{\\mathrm{Slv}}\\newcommand{\\Hypo}{\\mathrm{Hypo}}\\newcommand{\\CL}{\\mathrm{CL}}\\DeclareMathOperator{\\ba}{ba}\\DeclareMathOperator{\\ca}{ca}\n\n%%% 圏\n\\newcommand{\\varlim}{\\varprojlim}\\newcommand{\\Hom}{\\mathrm{Hom}}\\newcommand{\\Iso}{\\mathrm{Iso}}\\newcommand{\\Mor}{\\mathrm{Mor}}\\newcommand{\\Isom}{\\mathrm{Isom}}\\newcommand{\\Aut}{\\mathrm{Aut}}\\newcommand{\\End}{\\mathrm{End}}\\newcommand{\\op}{\\mathrm{op}}\\newcommand{\\ev}{\\mathrm{ev}}\\newcommand{\\Ob}{\\mathrm{Ob}}\\newcommand{\\Ar}{\\mathrm{Ar}}\\newcommand{\\Arr}{\\mathrm{Arr}}\\newcommand{\\Set}{\\mathrm{Set}}\\newcommand{\\Grp}{\\mathrm{Grp}}\\newcommand{\\Cat}{\\mathrm{Cat}}\\newcommand{\\Mon}{\\mathrm{Mon}}\\newcommand{\\Ring}{\\mathrm{Ring}}\\newcommand{\\CRing}{\\mathrm{CRing}}\\newcommand{\\Ab}{\\mathrm{Ab}}\\newcommand{\\Pos}{\\mathrm{Pos}}\\newcommand{\\Vect}{\\mathrm{Vect}}\\newcommand{\\FinVect}{\\mathrm{FinVect}}\\newcommand{\\FinSet}{\\mathrm{FinSet}}\\newcommand{\\FinMeas}{\\mathrm{FinMeas}}\\newcommand{\\OmegaAlg}{\\Omega\\text{-}\\mathrm{Alg}}\\newcommand{\\OmegaEAlg}{(\\Omega,E)\\text{-}\\mathrm{Alg}}\\newcommand{\\Fun}{\\mathrm{Fun}}\\newcommand{\\Func}{\\mathrm{Func}}\\newcommand{\\Alg}{\\mathrm{Alg}} %代数の圏\n\\newcommand{\\Met}{\\mathrm{Met}} %Metric space & Contraction maps\n\\newcommand{\\Stoch}{\\mathrm{Stoch}}\\newcommand{\\FinStoch}{\\mathrm{FinStoch}}\\newcommand{\\Copy}{\\mathrm{copy}}\\newcommand{\\Delete}{\\mathrm{delete}} %確率空間とMarkov核の圏\n\\newcommand{\\Bool}{\\mathrm{Bool}}\\newcommand{\\CABool}{\\mathrm{CABool}}\\newcommand{\\CompBoolAlg}{\\mathrm{CompBoolAlg}}\\newcommand{\\BoolAlg}{\\mathrm{BoolAlg}}\\newcommand{\\BoolRng}{\\mathrm{BoolRng}}\\newcommand{\\HeytAlg}{\\mathrm{HeytAlg}}\\newcommand{\\CompHeytAlg}{\\mathrm{CompHeytAlg}}\\newcommand{\\Lat}{\\mathrm{Lat}}\\newcommand{\\CompLat}{\\mathrm{CompLat}}\\newcommand{\\SemiLat}{\\mathrm{SemiLat}}\\newcommand{\\Stone}{\\mathrm{Stone}}\\newcommand{\\Mfd}{\\mathrm{Mfd}}\\newcommand{\\LieAlg}{\\mathrm{LieAlg}}\n\\newcommand{\\Sob}{\\mathrm{Sob}} %Sober space & continuous map\n\\newcommand{\\Op}{\\mathrm{Op}} %Category of open subsets\n\\newcommand{\\Sh}{\\mathrm{Sh}} %Category of sheave\n\\newcommand{\\PSh}{\\mathrm{PSh}} %Category of presheave, PSh(C)=[C^op,set]のこと\n\\DeclareMathOperator{\\Conv}{Conv} %Convergence spaceの圏\n\\newcommand{\\Unif}{\\mathrm{Unif}} %一様空間と一様連続写像の圏\n\\newcommand{\\Frm}{\\mathrm{Frm}} %フレームとフレームの射\n\\newcommand{\\Locale}{\\mathrm{Locale}} %その反対圏\n\\newcommand{\\Diff}{\\mathrm{Diff}} %滑らかな多様体の圏\n\\newcommand{\\Quiv}{\\mathrm{Quiv}} %Quiverの圏\n\\newcommand{\\B}{\\mathcal{B}}\\newcommand{\\cB}{\\mathcal{B}}\\newcommand{\\Span}{\\mathrm{Span}}\\newcommand{\\Corr}{\\mathrm{Corr}}\\newcommand{\\Decat}{\\mathrm{Decat}}\\newcommand{\\Rep}{\\mathrm{Rep}}\\newcommand{\\Grpd}{\\mathrm{Grpd}}\\newcommand{\\sSet}{\\mathrm{sSet}}\\newcommand{\\Mod}{\\mathrm{Mod}}\\newcommand{\\SmoothMnf}{\\mathrm{SmoothMnf}}\\newcommand{\\coker}{\\mathrm{coker}}\\newcommand{\\Ord}{\\mathrm{Ord}}\\newcommand{\\eq}{\\mathrm{eq}}\\newcommand{\\coeq}{\\mathrm{coeq}}\\newcommand{\\act}{\\mathrm{act}}\n\n%%% SMC\n\\newcommand{\\apf}{\\mathrm{apf}}\\newcommand{\\opt}{\\mathrm{opt}}\\newcommand{\\IS}{\\mathrm{IS}}\\newcommand{\\IR}{\\mathrm{IR}}\\newcommand{\\iidsim}{\\overset{\\text{iid}}{\\sim}}\\DeclareMathOperator{\\KL}{KL}\\DeclareMathOperator{\\JS}{JS}\\DeclareMathOperator{\\ESS}{ESS}\\DeclareMathOperator{\\MSE}{MSE}\\newcommand{\\propt}{\\,\\propto\\,}\\newcommand{\\bM}{\\mathbb{M}}\\newcommand{\\cX}{\\mathcal{X}}\\newcommand{\\cY}{\\mathcal{Y}}\\newcommand{\\cP}{\\mathcal{P}}\\newcommand{\\ola}[1]{\\overleftarrow{#1}}\n\n%%% 括弧類\n\\newcommand{\\ov}[1]{\\overline{#1}}\\newcommand{\\un}[1]{\\underline{#1}}\\newcommand{\\wt}[1]{\\widetilde{#1}}\\newcommand{\\wh}[1]{\\widehat{#1}}\n\\newcommand{\\pp}[2]{\\frac{\\partial #1}{\\partial #2}}\\newcommand{\\ppp}[3]{\\frac{\\partial #1}{\\partial #2\\partial #3}}\\newcommand{\\dd}[2]{\\frac{d #1}{d #2}}\n\\newcommand{\\floor}[1]{\\lfloor#1\\rfloor}\\newcommand{\\Floor}[1]{\\left\\lfloor#1\\right\\rfloor}\\newcommand{\\ceil}[1]{\\lceil#1\\rceil}\n\\newcommand{\\ocinterval}[1]{(#1]}\\newcommand{\\cointerval}[1]{[#1)}\\newcommand{\\COinterval}[1]{\\left[#1\\right)}\n\n%%% 予約語\n\\renewcommand{\\iff}{\\;\\mathrm{iff}\\;}\n\\newcommand{\\False}{\\mathrm{False}}\\newcommand{\\True}{\\mathrm{True}}\n\\newcommand{\\otherwise}{\\mathrm{otherwise}}\n\\newcommand{\\suchthat}{\\;\\mathrm{s.t.}\\;}\n\n%%% 略記\n\\newcommand{\\cM}{\\mathcal{M}}\\newcommand{\\M}{\\mathbb{M}}\\newcommand{\\cF}{\\mathcal{F}}\\newcommand{\\cD}{\\mathcal{D}}\\newcommand{\\fX}{\\mathfrak{X}}\\newcommand{\\fY}{\\mathfrak{Y}}\\newcommand{\\fZ}{\\mathfrak{Z}}\\renewcommand{\\H}{\\mathcal{H}}\\newcommand{\\cH}{\\mathcal{H}}\\newcommand{\\fH}{\\mathfrak{H}}\\newcommand{\\bH}{\\mathbb{H}}\\newcommand{\\id}{\\mathrm{id}}\\newcommand{\\A}{\\mathcal{A}}\n\\newcommand{\\lmd}{\\lambda}\n\\newcommand{\\Lmd}{\\Lambda}\n\\newcommand{\\cI}{\\mathcal{I}}\n\n%%% 矢印類\n\\newcommand{\\iso}{\\overset{\\sim}{\\to}}\n\\newcommand{\\Lrarrow}{\\;\\;\\Leftrightarrow\\;\\;}\n$$\n:::\n\n\n\n::: {.callout-tip title=\"リンク集\" appearance=\"simple\"}\n\n* [r-project](https://cran.r-project.org/web/packages/brms/)\n* [Documentation](https://paul-buerkner.github.io/brms/)\n* [GitHub](https://github.com/paul-buerkner/brms)\n* [discourse](https://discourse.mc-stan.org/)\n* [@Burkner2017]\n* [@Burkner2018]\n* [@Burkner2021]\n\n:::\n\nダウンロードは：^[R を最新バージョン 4.3.1 → 4.4.0 にアップデートしなければインストールに失敗したことに注意．]\n\n```r\ninstall.packages(\"brms\")\n```\n\n## 例\n\nDocumentation で紹介されている，[`Epilepsy Seizures Data`](https://search.r-project.org/CRAN/refmans/dhglm/html/epilepsy.html) [@Thall-Vail1990] を用いた [例](https://paul-buerkner.github.io/brms/) を実行してみる：\n\n```r\nlibrary(brms)\nfit1 <- brm(count ~ zAge + zBase * Trt + (1|patient),\n            data = epilepsy, family = poisson())\n```\n\nてんかん (epilepsy) 患者の発作回数`count`を被説明変数とし，処置の効果を表す説明変数`Trt`と患者毎のランダムな切片項`(1|patient)`と`zAge`,`zBase`への依存構造を調べたい．被説明変数`count`のモデルとしては，Poisson 分布族を用いる．\n\n::: {.callout-note appearance=\"simple\" title=\"説明変数\"}\n\n* `zAge`：標準化された年齢\n* `zBase`：ベースの発作回数\n* `Trt`：治療の有無を表す２値変数\n* `(1|patient)`：患者ごとに異なるとした切片項\n\n`zBase * Trt`という記法は，この２つの交互作用もモデルに含めることを意味する．\n\nまた，59 人の患者に関して，４回の入院時の発作回数を記録した，全 236 データからなる．`patient`が患者を識別する ID であり，`(1|patient)`は患者ごとのランダム効果ということになる．\n\n従って本モデルは`zAge`と`zBase`という固定効果，`(1|patient)`というランダム効果を取り入れた混合モデルということになり，回帰式は次の通りである：\n$$\n\\text{count}_{it} = \\beta_1 \\cdot\\text{zAge}_i+ \\beta_2 \\cdot \\text{zBase}_i + \\beta_3 \\cdot \\text{Trt}_i + \\beta_4 \\cdot (\\text{zBase}_i \\cdot \\text{Trt}_i) + u_i +\\ep_{it}\n$$\n\n:::\n\n::: {.callout-caution collapse=\"true\" title=\"全データ\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nepilepsy\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    Age Base Trt patient visit count obs        zAge        zBase\n1    31   11   0       1     1     5   1  0.42499501 -0.757172825\n2    30   11   0       2     1     3   2  0.26528351 -0.757172825\n3    25    6   0       3     1     2   3 -0.53327400 -0.944403322\n4    36    8   0       4     1     4   4  1.22355252 -0.869511123\n5    22   66   0       5     1     7   5 -1.01240850  1.302362646\n6    29   27   0       6     1     5   6  0.10557201 -0.158035233\n7    31   12   0       7     1     6   7  0.42499501 -0.719726725\n8    42   52   0       8     1    40   8  2.18182153  0.778117253\n9    37   23   0       9     1     5   9  1.38326402 -0.307819631\n10   28   10   0      10     1    14  10 -0.05413949 -0.794618924\n11   36   52   0      11     1    26  11  1.22355252  0.778117253\n12   24   33   0      12     1    12  12 -0.69298550  0.066641363\n13   23   18   0      13     1     4  13 -0.85269700 -0.495050128\n14   36   42   0      14     1     7  14  1.22355252  0.403656259\n15   26   87   0      15     1    16  15 -0.37356249  2.088730734\n16   26   50   0      16     1    11  16 -0.37356249  0.703225054\n17   28   18   0      17     1     0  17 -0.05413949 -0.495050128\n18   31  111   0      18     1    37  18  0.42499501  2.987437121\n19   32   18   0      19     1     3  19  0.58470651 -0.495050128\n20   21   20   0      20     1     3  20 -1.17212000 -0.420157930\n21   29   12   0      21     1     3  21  0.10557201 -0.719726725\n22   21    9   0      22     1     3  22 -1.17212000 -0.832065024\n23   32   17   0      23     1     2  23  0.58470651 -0.532496228\n24   25   28   0      24     1     8  24 -0.53327400 -0.120589134\n25   30   55   0      25     1    18  25  0.26528351  0.890455552\n26   40    9   0      26     1     2  26  1.86239852 -0.832065024\n27   19   10   0      27     1     3  27 -1.49154300 -0.794618924\n28   22   47   0      28     1    13  28 -1.01240850  0.590886756\n29   18   76   1      29     1    11  29 -1.65125450  1.676823640\n30   32   38   1      30     1     8  30  0.58470651  0.253871861\n31   20   19   1      31     1     0  31 -1.33183150 -0.457604029\n32   30   10   1      32     1     3  32  0.26528351 -0.794618924\n33   18   19   1      33     1     2  33 -1.65125450 -0.457604029\n34   24   24   1      34     1     4  34 -0.69298550 -0.270373532\n35   30   31   1      35     1    22  35  0.26528351 -0.008250835\n36   35   14   1      36     1     5  36  1.06384102 -0.644834526\n37   27   11   1      37     1     2  37 -0.21385099 -0.757172825\n38   20   67   1      38     1     3  38 -1.33183150  1.339808745\n39   22   41   1      39     1     4  39 -1.01240850  0.366210159\n40   28    7   1      40     1     2  40 -0.05413949 -0.906957223\n41   23   22   1      41     1     0  41 -0.85269700 -0.345265731\n42   40   13   1      42     1     5  42  1.86239852 -0.682280626\n43   33   46   1      43     1    11  43  0.74441801  0.553440656\n44   21   36   1      44     1    10  44 -1.17212000  0.178979662\n45   35   38   1      45     1    19  45  1.06384102  0.253871861\n46   25    7   1      46     1     1  46 -0.53327400 -0.906957223\n47   26   36   1      47     1     6  47 -0.37356249  0.178979662\n48   25   11   1      48     1     2  48 -0.53327400 -0.757172825\n49   22  151   1      49     1   102  49 -1.01240850  4.485281100\n50   32   22   1      50     1     4  50  0.58470651 -0.345265731\n51   25   41   1      51     1     8  51 -0.53327400  0.366210159\n52   35   32   1      52     1     1  52  1.06384102  0.029195264\n53   21   56   1      53     1    18  53 -1.17212000  0.927901651\n54   41   24   1      54     1     6  54  2.02211002 -0.270373532\n55   32   16   1      55     1     3  55  0.58470651 -0.569942327\n56   26   22   1      56     1     1  56 -0.37356249 -0.345265731\n57   21   25   1      57     1     2  57 -1.17212000 -0.232927432\n58   36   13   1      58     1     0  58  1.22355252 -0.682280626\n59   37   12   1      59     1     1  59  1.38326402 -0.719726725\n60   31   11   0       1     2     3  60  0.42499501 -0.757172825\n61   30   11   0       2     2     5  61  0.26528351 -0.757172825\n62   25    6   0       3     2     4  62 -0.53327400 -0.944403322\n63   36    8   0       4     2     4  63  1.22355252 -0.869511123\n64   22   66   0       5     2    18  64 -1.01240850  1.302362646\n65   29   27   0       6     2     2  65  0.10557201 -0.158035233\n66   31   12   0       7     2     4  66  0.42499501 -0.719726725\n67   42   52   0       8     2    20  67  2.18182153  0.778117253\n68   37   23   0       9     2     6  68  1.38326402 -0.307819631\n69   28   10   0      10     2    13  69 -0.05413949 -0.794618924\n70   36   52   0      11     2    12  70  1.22355252  0.778117253\n71   24   33   0      12     2     6  71 -0.69298550  0.066641363\n72   23   18   0      13     2     4  72 -0.85269700 -0.495050128\n73   36   42   0      14     2     9  73  1.22355252  0.403656259\n74   26   87   0      15     2    24  74 -0.37356249  2.088730734\n75   26   50   0      16     2     0  75 -0.37356249  0.703225054\n76   28   18   0      17     2     0  76 -0.05413949 -0.495050128\n77   31  111   0      18     2    29  77  0.42499501  2.987437121\n78   32   18   0      19     2     5  78  0.58470651 -0.495050128\n79   21   20   0      20     2     0  79 -1.17212000 -0.420157930\n80   29   12   0      21     2     4  80  0.10557201 -0.719726725\n81   21    9   0      22     2     4  81 -1.17212000 -0.832065024\n82   32   17   0      23     2     3  82  0.58470651 -0.532496228\n83   25   28   0      24     2    12  83 -0.53327400 -0.120589134\n84   30   55   0      25     2    24  84  0.26528351  0.890455552\n85   40    9   0      26     2     1  85  1.86239852 -0.832065024\n86   19   10   0      27     2     1  86 -1.49154300 -0.794618924\n87   22   47   0      28     2    15  87 -1.01240850  0.590886756\n88   18   76   1      29     2    14  88 -1.65125450  1.676823640\n89   32   38   1      30     2     7  89  0.58470651  0.253871861\n90   20   19   1      31     2     4  90 -1.33183150 -0.457604029\n91   30   10   1      32     2     6  91  0.26528351 -0.794618924\n92   18   19   1      33     2     6  92 -1.65125450 -0.457604029\n93   24   24   1      34     2     3  93 -0.69298550 -0.270373532\n94   30   31   1      35     2    17  94  0.26528351 -0.008250835\n95   35   14   1      36     2     4  95  1.06384102 -0.644834526\n96   27   11   1      37     2     4  96 -0.21385099 -0.757172825\n97   20   67   1      38     2     7  97 -1.33183150  1.339808745\n98   22   41   1      39     2    18  98 -1.01240850  0.366210159\n99   28    7   1      40     2     1  99 -0.05413949 -0.906957223\n100  23   22   1      41     2     2 100 -0.85269700 -0.345265731\n101  40   13   1      42     2     4 101  1.86239852 -0.682280626\n102  33   46   1      43     2    14 102  0.74441801  0.553440656\n103  21   36   1      44     2     5 103 -1.17212000  0.178979662\n104  35   38   1      45     2     7 104  1.06384102  0.253871861\n105  25    7   1      46     2     1 105 -0.53327400 -0.906957223\n106  26   36   1      47     2    10 106 -0.37356249  0.178979662\n107  25   11   1      48     2     1 107 -0.53327400 -0.757172825\n108  22  151   1      49     2    65 108 -1.01240850  4.485281100\n109  32   22   1      50     2     3 109  0.58470651 -0.345265731\n110  25   41   1      51     2     6 110 -0.53327400  0.366210159\n111  35   32   1      52     2     3 111  1.06384102  0.029195264\n112  21   56   1      53     2    11 112 -1.17212000  0.927901651\n113  41   24   1      54     2     3 113  2.02211002 -0.270373532\n114  32   16   1      55     2     5 114  0.58470651 -0.569942327\n115  26   22   1      56     2    23 115 -0.37356249 -0.345265731\n116  21   25   1      57     2     3 116 -1.17212000 -0.232927432\n117  36   13   1      58     2     0 117  1.22355252 -0.682280626\n118  37   12   1      59     2     4 118  1.38326402 -0.719726725\n119  31   11   0       1     3     3 119  0.42499501 -0.757172825\n120  30   11   0       2     3     3 120  0.26528351 -0.757172825\n121  25    6   0       3     3     0 121 -0.53327400 -0.944403322\n122  36    8   0       4     3     1 122  1.22355252 -0.869511123\n123  22   66   0       5     3     9 123 -1.01240850  1.302362646\n124  29   27   0       6     3     8 124  0.10557201 -0.158035233\n125  31   12   0       7     3     0 125  0.42499501 -0.719726725\n126  42   52   0       8     3    21 126  2.18182153  0.778117253\n127  37   23   0       9     3     6 127  1.38326402 -0.307819631\n128  28   10   0      10     3     6 128 -0.05413949 -0.794618924\n129  36   52   0      11     3     6 129  1.22355252  0.778117253\n130  24   33   0      12     3     8 130 -0.69298550  0.066641363\n131  23   18   0      13     3     6 131 -0.85269700 -0.495050128\n132  36   42   0      14     3    12 132  1.22355252  0.403656259\n133  26   87   0      15     3    10 133 -0.37356249  2.088730734\n134  26   50   0      16     3     0 134 -0.37356249  0.703225054\n135  28   18   0      17     3     3 135 -0.05413949 -0.495050128\n136  31  111   0      18     3    28 136  0.42499501  2.987437121\n137  32   18   0      19     3     2 137  0.58470651 -0.495050128\n138  21   20   0      20     3     6 138 -1.17212000 -0.420157930\n139  29   12   0      21     3     3 139  0.10557201 -0.719726725\n140  21    9   0      22     3     3 140 -1.17212000 -0.832065024\n141  32   17   0      23     3     3 141  0.58470651 -0.532496228\n142  25   28   0      24     3     2 142 -0.53327400 -0.120589134\n143  30   55   0      25     3    76 143  0.26528351  0.890455552\n144  40    9   0      26     3     2 144  1.86239852 -0.832065024\n145  19   10   0      27     3     4 145 -1.49154300 -0.794618924\n146  22   47   0      28     3    13 146 -1.01240850  0.590886756\n147  18   76   1      29     3     9 147 -1.65125450  1.676823640\n148  32   38   1      30     3     9 148  0.58470651  0.253871861\n149  20   19   1      31     3     3 149 -1.33183150 -0.457604029\n150  30   10   1      32     3     1 150  0.26528351 -0.794618924\n151  18   19   1      33     3     7 151 -1.65125450 -0.457604029\n152  24   24   1      34     3     1 152 -0.69298550 -0.270373532\n153  30   31   1      35     3    19 153  0.26528351 -0.008250835\n154  35   14   1      36     3     7 154  1.06384102 -0.644834526\n155  27   11   1      37     3     0 155 -0.21385099 -0.757172825\n156  20   67   1      38     3     7 156 -1.33183150  1.339808745\n157  22   41   1      39     3     2 157 -1.01240850  0.366210159\n158  28    7   1      40     3     1 158 -0.05413949 -0.906957223\n159  23   22   1      41     3     4 159 -0.85269700 -0.345265731\n160  40   13   1      42     3     0 160  1.86239852 -0.682280626\n161  33   46   1      43     3    25 161  0.74441801  0.553440656\n162  21   36   1      44     3     3 162 -1.17212000  0.178979662\n163  35   38   1      45     3     6 163  1.06384102  0.253871861\n164  25    7   1      46     3     2 164 -0.53327400 -0.906957223\n165  26   36   1      47     3     8 165 -0.37356249  0.178979662\n166  25   11   1      48     3     0 166 -0.53327400 -0.757172825\n167  22  151   1      49     3    72 167 -1.01240850  4.485281100\n168  32   22   1      50     3     2 168  0.58470651 -0.345265731\n169  25   41   1      51     3     5 169 -0.53327400  0.366210159\n170  35   32   1      52     3     1 170  1.06384102  0.029195264\n171  21   56   1      53     3    28 171 -1.17212000  0.927901651\n172  41   24   1      54     3     4 172  2.02211002 -0.270373532\n173  32   16   1      55     3     4 173  0.58470651 -0.569942327\n174  26   22   1      56     3    19 174 -0.37356249 -0.345265731\n175  21   25   1      57     3     0 175 -1.17212000 -0.232927432\n176  36   13   1      58     3     0 176  1.22355252 -0.682280626\n177  37   12   1      59     3     3 177  1.38326402 -0.719726725\n178  31   11   0       1     4     3 178  0.42499501 -0.757172825\n179  30   11   0       2     4     3 179  0.26528351 -0.757172825\n180  25    6   0       3     4     5 180 -0.53327400 -0.944403322\n181  36    8   0       4     4     4 181  1.22355252 -0.869511123\n182  22   66   0       5     4    21 182 -1.01240850  1.302362646\n183  29   27   0       6     4     7 183  0.10557201 -0.158035233\n184  31   12   0       7     4     2 184  0.42499501 -0.719726725\n185  42   52   0       8     4    12 185  2.18182153  0.778117253\n186  37   23   0       9     4     5 186  1.38326402 -0.307819631\n187  28   10   0      10     4     0 187 -0.05413949 -0.794618924\n188  36   52   0      11     4    22 188  1.22355252  0.778117253\n189  24   33   0      12     4     4 189 -0.69298550  0.066641363\n190  23   18   0      13     4     2 190 -0.85269700 -0.495050128\n191  36   42   0      14     4    14 191  1.22355252  0.403656259\n192  26   87   0      15     4     9 192 -0.37356249  2.088730734\n193  26   50   0      16     4     5 193 -0.37356249  0.703225054\n194  28   18   0      17     4     3 194 -0.05413949 -0.495050128\n195  31  111   0      18     4    29 195  0.42499501  2.987437121\n196  32   18   0      19     4     5 196  0.58470651 -0.495050128\n197  21   20   0      20     4     7 197 -1.17212000 -0.420157930\n198  29   12   0      21     4     4 198  0.10557201 -0.719726725\n199  21    9   0      22     4     4 199 -1.17212000 -0.832065024\n200  32   17   0      23     4     5 200  0.58470651 -0.532496228\n201  25   28   0      24     4     8 201 -0.53327400 -0.120589134\n202  30   55   0      25     4    25 202  0.26528351  0.890455552\n203  40    9   0      26     4     1 203  1.86239852 -0.832065024\n204  19   10   0      27     4     2 204 -1.49154300 -0.794618924\n205  22   47   0      28     4    12 205 -1.01240850  0.590886756\n206  18   76   1      29     4     8 206 -1.65125450  1.676823640\n207  32   38   1      30     4     4 207  0.58470651  0.253871861\n208  20   19   1      31     4     0 208 -1.33183150 -0.457604029\n209  30   10   1      32     4     3 209  0.26528351 -0.794618924\n210  18   19   1      33     4     4 210 -1.65125450 -0.457604029\n211  24   24   1      34     4     3 211 -0.69298550 -0.270373532\n212  30   31   1      35     4    16 212  0.26528351 -0.008250835\n213  35   14   1      36     4     4 213  1.06384102 -0.644834526\n214  27   11   1      37     4     4 214 -0.21385099 -0.757172825\n215  20   67   1      38     4     7 215 -1.33183150  1.339808745\n216  22   41   1      39     4     5 216 -1.01240850  0.366210159\n217  28    7   1      40     4     0 217 -0.05413949 -0.906957223\n218  23   22   1      41     4     0 218 -0.85269700 -0.345265731\n219  40   13   1      42     4     3 219  1.86239852 -0.682280626\n220  33   46   1      43     4    15 220  0.74441801  0.553440656\n221  21   36   1      44     4     8 221 -1.17212000  0.178979662\n222  35   38   1      45     4     7 222  1.06384102  0.253871861\n223  25    7   1      46     4     3 223 -0.53327400 -0.906957223\n224  26   36   1      47     4     8 224 -0.37356249  0.178979662\n225  25   11   1      48     4     0 225 -0.53327400 -0.757172825\n226  22  151   1      49     4    63 226 -1.01240850  4.485281100\n227  32   22   1      50     4     4 227  0.58470651 -0.345265731\n228  25   41   1      51     4     7 228 -0.53327400  0.366210159\n229  35   32   1      52     4     5 229  1.06384102  0.029195264\n230  21   56   1      53     4    13 230 -1.17212000  0.927901651\n231  41   24   1      54     4     0 231  2.02211002 -0.270373532\n232  32   16   1      55     4     3 232  0.58470651 -0.569942327\n233  26   22   1      56     4     8 233 -0.37356249 -0.345265731\n234  21   25   1      57     4     1 234 -1.17212000 -0.232927432\n235  36   13   1      58     4     0 235  1.22355252 -0.682280626\n236  37   12   1      59     4     2 236  1.38326402 -0.719726725\n```\n\n\n:::\n:::\n\n:::\n\n### モデルの推定とプロット\n\n::: {.callout-caution collapse=\"true\" title=\"フィッティングの出力\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(brms)\nfit1 <- brm(count ~ zAge + zBase * Trt + (1|patient),\n            data = epilepsy, family = poisson())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCompiling Stan program...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nStart sampling\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).\nChain 1: \nChain 1: Gradient evaluation took 5.1e-05 seconds\nChain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.51 seconds.\nChain 1: Adjust your expectations accordingly!\nChain 1: \nChain 1: \nChain 1: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 1: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 1: \nChain 1:  Elapsed Time: 1.039 seconds (Warm-up)\nChain 1:                0.712 seconds (Sampling)\nChain 1:                1.751 seconds (Total)\nChain 1: \n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).\nChain 2: \nChain 2: Gradient evaluation took 1.2e-05 seconds\nChain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.12 seconds.\nChain 2: Adjust your expectations accordingly!\nChain 2: \nChain 2: \nChain 2: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 2: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 2: \nChain 2:  Elapsed Time: 1.102 seconds (Warm-up)\nChain 2:                0.763 seconds (Sampling)\nChain 2:                1.865 seconds (Total)\nChain 2: \n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).\nChain 3: \nChain 3: Gradient evaluation took 1.6e-05 seconds\nChain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.16 seconds.\nChain 3: Adjust your expectations accordingly!\nChain 3: \nChain 3: \nChain 3: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 3: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 3: \nChain 3:  Elapsed Time: 1.02 seconds (Warm-up)\nChain 3:                0.79 seconds (Sampling)\nChain 3:                1.81 seconds (Total)\nChain 3: \n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).\nChain 4: \nChain 4: Gradient evaluation took 1.2e-05 seconds\nChain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.12 seconds.\nChain 4: Adjust your expectations accordingly!\nChain 4: \nChain 4: \nChain 4: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 4: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 4: \nChain 4:  Elapsed Time: 1.008 seconds (Warm-up)\nChain 4:                0.74 seconds (Sampling)\nChain 4:                1.748 seconds (Total)\nChain 4: \n```\n\n\n:::\n:::\n\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: poisson \n  Links: mu = log \nFormula: count ~ zAge + zBase * Trt + (1 | patient) \n   Data: epilepsy (Number of observations: 236) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~patient (Number of levels: 59) \n              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsd(Intercept)     0.58      0.07     0.46     0.74 1.00      719     1600\n\nRegression Coefficients:\n           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept      1.77      0.12     1.54     2.00 1.00      690     1215\nzAge           0.10      0.09    -0.09     0.28 1.00      618     1043\nzBase          0.70      0.12     0.47     0.94 1.01      675     1415\nTrt1          -0.27      0.16    -0.59     0.06 1.00      724     1395\nzBase:Trt1     0.05      0.16    -0.27     0.37 1.00      758     1479\n\nDraws were sampled using sampling(NUTS). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n基本的な解析の前提がまず出力され，推定結果はグループ毎（今回は患者毎）の変数（今回は $u_i$）から表示される．\n\n後半に固定効果の係数，すなわち回帰係数の推定結果が表示される．\n\n治療効果`Trt`の係数は負で，平均的に処置効果はある可能性があるが，95% 信頼区間は $0$ を跨いでいるという意味で，有意とは言えない．また，交差項`zBase*Trt`の係数は小さく，交互効果の存在を示す証拠はないと思われる．\n\n$\\wh{R}$ が１より大きい場合，MCMC が収束していない可能性を意味する．\n\n変数を指定して，事後分布と MCMC の軌跡をプロットできる：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fit1, variable = c(\"b_Trt1\", \"b_zBase\"))\n```\n\n::: {.cell-output-display}\n![](brms_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nより詳しく見るには`conditional_effects`関数を用いることもできる．交差項の効果はほとんどないことがわかる：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(conditional_effects(fit1, effects = \"zBase:Trt\"))\n```\n\n::: {.cell-output-display}\n![](brms_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(conditional_effects(fit1, effects = \"Trt\"))\n```\n\n::: {.cell-output-display}\n![](brms_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n### モデルによる予測\n\nfit したモデル `fit1` を用いて，平均年齢と平均ベースレートを持つ患者に対する治療効果を予測する：\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnewdata <- data.frame(Trt = c(0, 1), zAge = 0, zBase = 0)\npredict(fit1, newdata = newdata, re_formula = NA)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Estimate Est.Error Q2.5 Q97.5\n[1,]  5.93450  2.522360    2    11\n[2,]  4.54775  2.183898    1     9\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfitted(fit1, newdata = newdata, re_formula = NA)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Estimate Est.Error     Q2.5    Q97.5\n[1,] 5.939461 0.7104193 4.648686 7.423907\n[2,] 4.519774 0.5232029 3.604023 5.638578\n```\n\n\n:::\n:::\n\n\n### モデルの比較\n\nモデル`fit1`で行った Poisson 回帰分析は，個々の観測が独立であるという仮定の上に成り立っている．\n\nこの仮定が破れているとき，Poisson 分布の性質\n$$\n\\E[X]=\\V[X]=\\lambda\\qquad (X\\sim\\Pois(\\lambda))\n$$\nからの離反として現れ，この現象は **過分散**（overdispersion）とも呼ばれる．\n\nそこで，モデル`fit1`に，観測ごとの切片項 $\\eta_{it}$ を追加してみる．\n\n```r\nfit2 <- brm(count ~ zAge + zBase * Trt + (1|patient) + (1|obs),\n            data = epilepsy, family = poisson())\n```\n\n::: {.callout-caution collapse=\"true\" title=\"フィッティングの出力\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit2 <- brm(count ~ zAge + zBase * Trt + (1|patient) + (1|obs),\n            data = epilepsy, family = poisson())\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCompiling Stan program...\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nStart sampling\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 1).\nChain 1: \nChain 1: Gradient evaluation took 7.3e-05 seconds\nChain 1: 1000 transitions using 10 leapfrog steps per transition would take 0.73 seconds.\nChain 1: Adjust your expectations accordingly!\nChain 1: \nChain 1: \nChain 1: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 1: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 1: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 1: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 1: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 1: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 1: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 1: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 1: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 1: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 1: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 1: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 1: \nChain 1:  Elapsed Time: 1.976 seconds (Warm-up)\nChain 1:                1.156 seconds (Sampling)\nChain 1:                3.132 seconds (Total)\nChain 1: \n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 2).\nChain 2: \nChain 2: Gradient evaluation took 1.8e-05 seconds\nChain 2: 1000 transitions using 10 leapfrog steps per transition would take 0.18 seconds.\nChain 2: Adjust your expectations accordingly!\nChain 2: \nChain 2: \nChain 2: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 2: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 2: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 2: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 2: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 2: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 2: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 2: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 2: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 2: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 2: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 2: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 2: \nChain 2:  Elapsed Time: 2.089 seconds (Warm-up)\nChain 2:                1.839 seconds (Sampling)\nChain 2:                3.928 seconds (Total)\nChain 2: \n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 3).\nChain 3: \nChain 3: Gradient evaluation took 1.8e-05 seconds\nChain 3: 1000 transitions using 10 leapfrog steps per transition would take 0.18 seconds.\nChain 3: Adjust your expectations accordingly!\nChain 3: \nChain 3: \nChain 3: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 3: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 3: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 3: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 3: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 3: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 3: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 3: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 3: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 3: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 3: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 3: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 3: \nChain 3:  Elapsed Time: 1.888 seconds (Warm-up)\nChain 3:                1.158 seconds (Sampling)\nChain 3:                3.046 seconds (Total)\nChain 3: \n\nSAMPLING FOR MODEL 'anon_model' NOW (CHAIN 4).\nChain 4: \nChain 4: Gradient evaluation took 2.3e-05 seconds\nChain 4: 1000 transitions using 10 leapfrog steps per transition would take 0.23 seconds.\nChain 4: Adjust your expectations accordingly!\nChain 4: \nChain 4: \nChain 4: Iteration:    1 / 2000 [  0%]  (Warmup)\nChain 4: Iteration:  200 / 2000 [ 10%]  (Warmup)\nChain 4: Iteration:  400 / 2000 [ 20%]  (Warmup)\nChain 4: Iteration:  600 / 2000 [ 30%]  (Warmup)\nChain 4: Iteration:  800 / 2000 [ 40%]  (Warmup)\nChain 4: Iteration: 1000 / 2000 [ 50%]  (Warmup)\nChain 4: Iteration: 1001 / 2000 [ 50%]  (Sampling)\nChain 4: Iteration: 1200 / 2000 [ 60%]  (Sampling)\nChain 4: Iteration: 1400 / 2000 [ 70%]  (Sampling)\nChain 4: Iteration: 1600 / 2000 [ 80%]  (Sampling)\nChain 4: Iteration: 1800 / 2000 [ 90%]  (Sampling)\nChain 4: Iteration: 2000 / 2000 [100%]  (Sampling)\nChain 4: \nChain 4:  Elapsed Time: 1.96 seconds (Warm-up)\nChain 4:                1.613 seconds (Sampling)\nChain 4:                3.573 seconds (Total)\nChain 4: \n```\n\n\n:::\n:::\n\n\n:::\n\n２つのモデルを比較することを考える．LLO (Leave-One-Out) cross-validation が関数`loo`によって実行できる：\n\n```r\nloo(fit1, fit2)\n```\n\n::: {.callout-caution collapse=\"true\" title=\"LOO-CV の結果\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloo(fit1, fit2)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Found 6 observations with a pareto_k > 0.7 in model 'fit1'. We\nrecommend to set 'moment_match = TRUE' in order to perform moment matching for\nproblematic observations.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Found 55 observations with a pareto_k > 0.7 in model 'fit2'. We\nrecommend to set 'moment_match = TRUE' in order to perform moment matching for\nproblematic observations.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nOutput of model 'fit1':\n\nComputed from 4000 by 236 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo   -673.3 37.4\np_loo        96.0 15.4\nlooic      1346.6 74.8\n------\nMCSE of elpd_loo is NA.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 2.3]).\n\nPareto k diagnostic values:\n                         Count Pct.    Min. ESS\n(-Inf, 0.7]   (good)     230   97.5%   144     \n   (0.7, 1]   (bad)        4    1.7%   <NA>    \n   (1, Inf)   (very bad)   2    0.8%   <NA>    \nSee help('pareto-k-diagnostic') for details.\n\nOutput of model 'fit2':\n\nComputed from 4000 by 236 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo   -595.0 14.0\np_loo       107.7  7.1\nlooic      1190.1 27.9\n------\nMCSE of elpd_loo is NA.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.6]).\n\nPareto k diagnostic values:\n                         Count Pct.    Min. ESS\n(-Inf, 0.7]   (good)     181   76.7%   65      \n   (0.7, 1]   (bad)       50   21.2%   <NA>    \n   (1, Inf)   (very bad)   5    2.1%   <NA>    \nSee help('pareto-k-diagnostic') for details.\n\nModel comparisons:\n     elpd_diff se_diff\nfit2   0.0       0.0  \nfit1 -78.3      27.9  \n```\n\n\n:::\n:::\n\n\n:::\n\n`elpd_diff` は expected log posterior density の差異を表す．`fit2`の方が大きく当てはまりが良いことが見て取れる．\n\nまた，WAIC (Watanabe-Akaike Information Criterion) も実装されている：\n\n```r\nprint(waic(fit1))\n```\n\n::: {.callout-caution collapse=\"true\" title=\"WAIC の結果\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(waic(fit1))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: \n52 (22.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nComputed from 4000 by 236 log-likelihood matrix.\n\n          Estimate   SE\nelpd_waic   -668.5 36.5\np_waic        91.2 14.5\nwaic        1337.0 73.1\n\n52 (22.0%) p_waic estimates greater than 0.4. We recommend trying loo instead. \n```\n\n\n:::\n\n```{.r .cell-code}\nprint(waic(fit2))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: \n64 (27.1%) p_waic estimates greater than 0.4. We recommend trying loo instead.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nComputed from 4000 by 236 log-likelihood matrix.\n\n          Estimate   SE\nelpd_waic   -572.5 12.0\np_waic        85.1  5.2\nwaic        1144.9 24.1\n\n64 (27.1%) p_waic estimates greater than 0.4. We recommend trying loo instead. \n```\n\n\n:::\n:::\n\n\n:::\n\n他にも，`reloo`, `kfold` などの関数もある．\n\n::: {.callout-caution collapse=\"true\" title=\"他の関数一覧\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmethods(class=\"brmsfit\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] add_criterion           add_ic                  as_draws_array         \n [4] as_draws_df             as_draws_list           as_draws_matrix        \n [7] as_draws_rvars          as_draws                as.array               \n[10] as.data.frame           as.matrix               as.mcmc                \n[13] autocor                 bayes_factor            bayes_R2               \n[16] bridge_sampler          coef                    conditional_effects    \n[19] conditional_smooths     control_params          default_prior          \n[22] expose_functions        family                  fitted                 \n[25] fixef                   formula                 getCall                \n[28] hypothesis              kfold                   log_lik                \n[31] log_posterior           logLik                  loo_compare            \n[34] loo_linpred             loo_model_weights       loo_moment_match       \n[37] loo_predict             loo_predictive_interval loo_R2                 \n[40] loo_subsample           loo                     LOO                    \n[43] marginal_effects        marginal_smooths        mcmc_plot              \n[46] model_weights           model.frame             nchains                \n[49] ndraws                  neff_ratio              ngrps                  \n[52] niterations             nobs                    nsamples               \n[55] nuts_params             nvariables              pairs                  \n[58] parnames                plot                    post_prob              \n[61] posterior_average       posterior_epred         posterior_interval     \n[64] posterior_linpred       posterior_predict       posterior_samples      \n[67] posterior_smooths       posterior_summary       pp_average             \n[70] pp_check                pp_mixture              predict                \n[73] predictive_error        predictive_interval     prepare_predictions    \n[76] print                   prior_draws             prior_summary          \n[79] psis                    ranef                   reloo                  \n[82] residuals               restructure             rhat                   \n[85] stancode                standata                stanplot               \n[88] summary                 update                  VarCorr                \n[91] variables               vcov                    waic                   \n[94] WAIC                   \nsee '?methods' for accessing help and source code\n```\n\n\n:::\n:::\n\n\n:::\n\n## 実装\n\n`brm` 関数（コードは [こちら](https://github.com/paul-buerkner/brms/blob/master/R/brm.R)）の実装を調べる．\n\n::: {.callout-important appearance=\"simple\" icon=\"false\"}\n\n* [`brms`](https://github.com/paul-buerkner/brms/blob/master/R/brm.R#L436)\n\nStan コードを扱っている関数は [`.stancode()`](https://github.com/paul-buerkner/brms/blob/d42adcd22f5af441870038b1d78ad4d9408f344f/R/stancode.R) であった．最終的に，[`.compile_model_rstan()`](https://github.com/paul-buerkner/brms/blob/d42adcd22f5af441870038b1d78ad4d9408f344f/R/backends.R#L67) と [`.fit_model_rstan()`](https://github.com/paul-buerkner/brms/blob/d42adcd22f5af441870038b1d78ad4d9408f344f/R/backends.R#L145) が呼ばれるようになっている．\n\n* [`.standata`](https://github.com/paul-buerkner/brms/blob/d42adcd22f5af441870038b1d78ad4d9408f344f/R/standata.R#L109)\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}