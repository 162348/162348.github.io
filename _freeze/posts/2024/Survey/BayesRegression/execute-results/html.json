{
  "hash": "6fe4e0da7ede985f177abe06a7d6918b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"`brms` を用いたベイズ重回帰分析\"\nsubtitle: \"BMI データを題材として\"\nauthor: \"司馬博文\"\ndate: 12/10/2024\ndate-modified: 12/12/2024\ncategories: [Bayesian, Statistics, R]\nbibliography: \n    - ../../../assets/mathematics.bib\n    - ../../../assets/bib.bib\n    - ../../../assets/bib1.bib\ncsl: ../../../assets/apalike.csl\nabstract-title: 概要\nabstract: |\n    ベイズ重回帰分析は解析者のデータへの理解を促進する強力な探索的データ解析手法である．\n    このことを `brms` パッケージと BMI データを用いて例証する．\n    １変数の場合から始め，変数を追加して挙動が変わるのを解釈・検証（残差プロット・事後予測プロット）しながら慎重に進んでいく．\n    交差検証による事後予測スコア elpd を用いて，データの非線型変換を利用することで，非線型な関係を見出す方法を扱う．\n    ここまで行えば，データの階層化やノンパラメトリックな手法の採用などの次のステップが自然と見えてくるだろう．\nimage: Files/elpd.svg\ncode-fold: false\nexecute:\n    cache: true\nlisting: \n    -   id: lst-survey\n        type: grid\n        sort: false\n        contents:\n            - \"BayesANOVA.qmd\"\n            - \"../Computation/brms.qmd\"\n            - \"BDA1.qmd\"\n        date-format: iso\n        fields: [title,image,date,subtitle]\n    -   id: lst-embedding\n        type: grid\n        grid-columns: 1\n        grid-item-align: center\n        sort: false\n        contents:\n            - \"BDA2.qmd\"\n        date-format: iso\n        fields: [title,image,date,subtitle]\n    -   id: lst-embedding2\n        type: grid\n        grid-columns: 1\n        grid-item-align: center\n        sort: false\n        contents:\n            - \"../TransDimensionalModels/BayesSelection.qmd\"\n        date-format: iso\n        fields: [title,image,date,subtitle]\n---\n\n\n::: {.hidden}\n\n::: {.content-visible when-format=\"html\"}\n\nA Blog Entry on Bayesian Computation by an Applied Mathematician\n\n$$\n\n\\renewcommand{\\P}{\\operatorname{P}}\\newcommand{\\E}{\\operatorname{E}}\n\\newcommand{\\R}{\\mathbb{R}}\\newcommand{\\F}{\\mathcal{F}}\n\\newcommand{\\abs}[1]{\\lvert#1\\rvert}\\newcommand{\\Abs}[1]{\\left|#1\\right|}\\newcommand{\\ABs}[1]{\\biggl|#1\\biggr|}\\newcommand{\\norm}[1]{\\|#1\\|}\\newcommand{\\Norm}[1]{\\left\\|#1\\right\\|}\\newcommand{\\NOrm}[1]{\\biggl\\|#1\\biggr\\|}\\newcommand{\\Brace}[1]{\\left\\{#1\\right\\}}\\newcommand{\\BRace}[1]{\\biggl\\{#1\\biggr\\}}\\newcommand{\\paren}[1]{\\left(#1\\right)}\\newcommand{\\Paren}[1]{\\biggr(#1\\biggl)}\\newcommand{\\brac}[1]{\\langle#1\\rangle}\\newcommand{\\Brac}[1]{\\left\\langle#1\\right\\rangle}\\newcommand{\\BRac}[1]{\\biggl\\langle#1\\biggr\\rangle}\\newcommand{\\bra}[1]{\\left\\langle#1\\right|}\\newcommand{\\ket}[1]{\\left|#1\\right\\rangle}\\newcommand{\\Square}[1]{\\left[#1\\right]}\\newcommand{\\SQuare}[1]{\\biggl[#1\\biggr]}\\newcommand{\\rN}{\\mathrm{N}}\\newcommand{\\ov}[1]{\\overline{#1}}\\newcommand{\\un}[1]{\\underline{#1}}\\newcommand{\\wt}[1]{\\widetilde{#1}}\\newcommand{\\wh}[1]{\\widehat{#1}}\\newcommand{\\pp}[2]{\\frac{\\partial #1}{\\partial #2}}\\newcommand{\\ppp}[3]{\\frac{\\partial #1}{\\partial #2\\partial #3}}\\newcommand{\\dd}[2]{\\frac{d #1}{d #2}}\\newcommand{\\floor}[1]{\\lfloor#1\\rfloor}\\newcommand{\\Floor}[1]{\\left\\lfloor#1\\right\\rfloor}\\newcommand{\\ceil}[1]{\\lceil#1\\rceil}\\newcommand{\\ocinterval}[1]{(#1]}\\newcommand{\\cointerval}[1]{[#1)}\\newcommand{\\COinterval}[1]{\\left[#1\\right)}\\newcommand{\\iso}{\\overset{\\sim}{\\to}}\n\n\n\n\\newcommand{\\y}{\\b{y}}\\newcommand{\\mi}{\\,|\\,}\\newcommand{\\Mark}{\\mathrm{Mark}}\n\\newcommand{\\argmax}{\\operatorname*{argmax}}\\newcommand{\\argmin}{\\operatorname*{argmin}}\n\n\\newcommand{\\pr}{\\mathrm{pr}}\\newcommand{\\Conv}{\\operatorname{Conv}}\\newcommand{\\cU}{\\mathcal{U}}\n\\newcommand{\\Map}{\\mathrm{Map}}\\newcommand{\\dom}{\\mathrm{Dom}\\;}\\newcommand{\\cod}{\\mathrm{Cod}\\;}\\newcommand{\\supp}{\\mathrm{supp}\\;}\n\\newcommand{\\grad}{\\operatorname{grad}}\\newcommand{\\rot}{\\operatorname{rot}}\\renewcommand{\\div}{\\operatorname{div}}\\newcommand{\\tr}{\\operatorname{tr}}\\newcommand{\\Tr}{\\operatorname{Tr}}\\newcommand{\\KL}{\\operatorname{KL}}\\newcommand{\\JS}{\\operatorname{JS}}\\newcommand{\\ESS}{\\operatorname{ESS}}\\newcommand{\\MSE}{\\operatorname{MSE}}\\newcommand{\\erf}{\\operatorname{erf}}\\newcommand{\\arctanh}{\\operatorname{arctanh}}\\newcommand{\\pl}{\\operatorname{pl}}\\newcommand{\\minimize}{\\operatorname{minimize}}\\newcommand{\\subjectto}{\\operatorname{subject to}}\\newcommand{\\sinc}{\\operatorname{sinc}}\\newcommand{\\Ent}{\\operatorname{Ent}}\\newcommand{\\Polya}{\\operatorname{Polya}}\\newcommand{\\Exp}{\\operatorname{Exp}}\\newcommand{\\codim}{\\operatorname{codim}}\\newcommand{\\sgn}{\\operatorname{sgn}}\\newcommand{\\rank}{\\operatorname{rank}}\n\n\\newcommand{\\vctr}[2]{\\begin{pmatrix}#1\\\\#2\\end{pmatrix}}\\newcommand{\\vctrr}[3]{\\begin{pmatrix}#1\\\\#2\\\\#3\\end{pmatrix}}\\newcommand{\\mtrx}[4]{\\begin{pmatrix}#1&#2\\\\#3&#4\\end{pmatrix}}\\newcommand{\\smtrx}[4]{\\paren{\\begin{smallmatrix}#1&#2\\\\#3&#4\\end{smallmatrix}}}\\newcommand{\\Ker}{\\mathrm{Ker}\\;}\\newcommand{\\Coker}{\\mathrm{Coker}\\;}\\newcommand{\\Coim}{\\mathrm{Coim}\\;}\\newcommand{\\lcm}{\\mathrm{lcm}}\\newcommand{\\GL}{\\mathrm{GL}}\\newcommand{\\SL}{\\mathrm{SL}}\\newcommand{\\alt}{\\mathrm{alt}}\n\n\\renewcommand{\\Re}{\\mathrm{Re}\\;}\\renewcommand{\\Im}{\\mathrm{Im}\\,}\\newcommand{\\Gal}{\\mathrm{Gal}}\\newcommand{\\PGL}{\\mathrm{PGL}}\\newcommand{\\PSL}{\\mathrm{PSL}}\\newcommand{\\Log}{\\mathrm{Log}\\,}\\newcommand{\\Res}{\\mathrm{Res}\\,}\\newcommand{\\on}{\\mathrm{on}\\;}\\newcommand{\\hatC}{\\widehat{\\C}}\\newcommand{\\hatR}{\\hat{\\R}}\\newcommand{\\PV}{\\mathrm{P.V.}}\\newcommand{\\diam}{\\mathrm{diam}}\\newcommand{\\Area}{\\mathrm{Area}}\\newcommand{\\Lap}{\\Laplace}\\newcommand{\\f}{\\mathbf{f}}\\newcommand{\\cR}{\\mathcal{R}}\\newcommand{\\const}{\\mathrm{const.}}\\newcommand{\\Om}{\\Omega}\\newcommand{\\Cinf}{C^\\infty}\\newcommand{\\ep}{\\epsilon}\\newcommand{\\dist}{\\mathrm{dist}}\\newcommand{\\opart}{\\o{\\partial}}\\newcommand{\\Length}{\\mathrm{Length}}\n\n\\newcommand{\\cA}{\\mathcal{A}}\\newcommand{\\cO}{\\mathcal{O}}\\newcommand{\\cW}{\\mathcal{W}}\\renewcommand{\\O}{\\mathcal{O}}\\renewcommand{\\S}{\\mathcal{S}}\\newcommand{\\U}{\\mathcal{U}}\\newcommand{\\V}{\\mathrm{V}}\\newcommand{\\N}{\\mathbb{N}}\\newcommand{\\bN}{\\mathbb{N}}\\newcommand{\\C}{\\mathrm{C}}\\newcommand{\\bC}{\\mathbb{C}}\\newcommand{\\Z}{\\mathcal{Z}}\\newcommand{\\Q}{\\mathbb{Q}}\\newcommand{\\bQ}{\\mathbb{Q}}\\newcommand{\\TV}{\\mathrm{TV}}\\newcommand{\\ORD}{\\mathrm{ORD}}\\newcommand{\\Card}{\\mathrm{Card}\\,}\\newcommand{\\Top}{\\mathrm{Top}}\\newcommand{\\Disc}{\\mathrm{Disc}}\\newcommand{\\Codisc}{\\mathrm{Codisc}}\\newcommand{\\CoDisc}{\\mathrm{CoDisc}}\\newcommand{\\Ult}{\\mathrm{Ult}}\\newcommand{\\ord}{\\mathrm{ord}}\\newcommand{\\bS}{\\mathbb{S}}\\newcommand{\\PConn}{\\mathrm{PConn}}\\newcommand{\\mult}{\\mathrm{mult}}\\newcommand{\\inv}{\\mathrm{inv}}\n\n\\newcommand{\\Der}{\\mathrm{Der}}\\newcommand{\\osub}{\\overset{\\mathrm{open}}{\\subset}}\\newcommand{\\osup}{\\overset{\\mathrm{open}}{\\supset}}\\newcommand{\\al}{\\alpha}\\newcommand{\\K}{\\mathbb{K}}\\newcommand{\\Sp}{\\mathrm{Sp}}\\newcommand{\\g}{\\mathfrak{g}}\\newcommand{\\h}{\\mathfrak{h}}\\newcommand{\\Imm}{\\mathrm{Imm}}\\newcommand{\\Imb}{\\mathrm{Imb}}\\newcommand{\\Gr}{\\mathrm{Gr}}\n\n\\newcommand{\\Ad}{\\mathrm{Ad}}\\newcommand{\\finsupp}{\\mathrm{fin\\;supp}}\\newcommand{\\SO}{\\mathrm{SO}}\\newcommand{\\SU}{\\mathrm{SU}}\\newcommand{\\acts}{\\curvearrowright}\\newcommand{\\mono}{\\hookrightarrow}\\newcommand{\\epi}{\\twoheadrightarrow}\\newcommand{\\Stab}{\\mathrm{Stab}}\\newcommand{\\nor}{\\mathrm{nor}}\\newcommand{\\T}{\\mathbb{T}}\\newcommand{\\Aff}{\\mathrm{Aff}}\\newcommand{\\rsup}{\\triangleright}\\newcommand{\\subgrp}{\\overset{\\mathrm{subgrp}}{\\subset}}\\newcommand{\\Ext}{\\mathrm{Ext}}\\newcommand{\\sbs}{\\subset}\\newcommand{\\sps}{\\supset}\\newcommand{\\In}{\\mathrm{in}\\;}\\newcommand{\\Tor}{\\mathrm{Tor}}\\newcommand{\\p}{\\b{p}}\\newcommand{\\q}{\\mathfrak{q}}\\newcommand{\\m}{\\mathfrak{m}}\\newcommand{\\cS}{\\mathcal{S}}\\newcommand{\\Frac}{\\mathrm{Frac}\\,}\\newcommand{\\Spec}{\\mathrm{Spec}\\,}\\newcommand{\\bA}{\\mathbb{A}}\\newcommand{\\Sym}{\\mathrm{Sym}}\\newcommand{\\Ann}{\\mathrm{Ann}}\\newcommand{\\Her}{\\mathrm{Her}}\\newcommand{\\Bil}{\\mathrm{Bil}}\\newcommand{\\Ses}{\\mathrm{Ses}}\\newcommand{\\FVS}{\\mathrm{FVS}}\n\n\\newcommand{\\Ho}{\\mathrm{Ho}}\\newcommand{\\CW}{\\mathrm{CW}}\\newcommand{\\lc}{\\mathrm{lc}}\\newcommand{\\cg}{\\mathrm{cg}}\\newcommand{\\Fib}{\\mathrm{Fib}}\\newcommand{\\Cyl}{\\mathrm{Cyl}}\\newcommand{\\Ch}{\\mathrm{Ch}}\n\\newcommand{\\rP}{\\mathrm{P}}\\newcommand{\\rE}{\\mathrm{E}}\\newcommand{\\e}{\\b{e}}\\renewcommand{\\k}{\\b{k}}\\newcommand{\\Christ}[2]{\\begin{Bmatrix}#1\\\\#2\\end{Bmatrix}}\\renewcommand{\\Vec}[1]{\\overrightarrow{\\mathrm{#1}}}\\newcommand{\\hen}[1]{\\mathrm{#1}}\\renewcommand{\\b}[1]{\\boldsymbol{#1}}\n\n\\newcommand{\\Inc}{\\mathrm{Inc}}\\newcommand{\\aInc}{\\mathrm{aInc}}\\newcommand{\\HS}{\\mathrm{HS}}\\newcommand{\\loc}{\\mathrm{loc}}\\newcommand{\\Lh}{\\mathrm{L.h.}}\\newcommand{\\Epi}{\\mathrm{Epi}}\\newcommand{\\slim}{\\mathrm{slim}}\\newcommand{\\Ban}{\\mathrm{Ban}}\\newcommand{\\Hilb}{\\mathrm{Hilb}}\\newcommand{\\Ex}{\\mathrm{Ex}}\\newcommand{\\Co}{\\mathrm{Co}}\\newcommand{\\sa}{\\mathrm{sa}}\\newcommand{\\nnorm}[1]{{\\left\\vert\\kern-0.25ex\\left\\vert\\kern-0.25ex\\left\\vert #1 \\right\\vert\\kern-0.25ex\\right\\vert\\kern-0.25ex\\right\\vert}}\\newcommand{\\dvol}{\\mathrm{dvol}}\\newcommand{\\Sconv}{\\mathrm{Sconv}}\\newcommand{\\I}{\\mathcal{I}}\\newcommand{\\nonunital}{\\mathrm{nu}}\\newcommand{\\cpt}{\\mathrm{cpt}}\\newcommand{\\lcpt}{\\mathrm{lcpt}}\\newcommand{\\com}{\\mathrm{com}}\\newcommand{\\Haus}{\\mathrm{Haus}}\\newcommand{\\proper}{\\mathrm{proper}}\\newcommand{\\infinity}{\\mathrm{inf}}\\newcommand{\\TVS}{\\mathrm{TVS}}\\newcommand{\\ess}{\\mathrm{ess}}\\newcommand{\\ext}{\\mathrm{ext}}\\newcommand{\\Index}{\\mathrm{Index}\\;}\\newcommand{\\SSR}{\\mathrm{SSR}}\\newcommand{\\vs}{\\mathrm{vs.}}\\newcommand{\\fM}{\\mathfrak{M}}\\newcommand{\\EDM}{\\mathrm{EDM}}\\newcommand{\\Tw}{\\mathrm{Tw}}\\newcommand{\\fC}{\\mathfrak{C}}\\newcommand{\\bn}{\\boldsymbol{n}}\\newcommand{\\br}{\\boldsymbol{r}}\\newcommand{\\Lam}{\\Lambda}\\newcommand{\\lam}{\\lambda}\\newcommand{\\one}{\\mathbf{1}}\\newcommand{\\dae}{\\text{-a.e.}}\\newcommand{\\das}{\\text{-a.s.}}\\newcommand{\\td}{\\text{-}}\\newcommand{\\RM}{\\mathrm{RM}}\\newcommand{\\BV}{\\mathrm{BV}}\\newcommand{\\normal}{\\mathrm{normal}}\\newcommand{\\lub}{\\mathrm{lub}\\;}\\newcommand{\\Graph}{\\mathrm{Graph}}\\newcommand{\\Ascent}{\\mathrm{Ascent}}\\newcommand{\\Descent}{\\mathrm{Descent}}\\newcommand{\\BIL}{\\mathrm{BIL}}\\newcommand{\\fL}{\\mathfrak{L}}\\newcommand{\\De}{\\Delta}\n\n\\newcommand{\\calA}{\\mathcal{A}}\\newcommand{\\calB}{\\mathcal{B}}\\newcommand{\\D}{\\mathcal{D}}\\newcommand{\\Y}{\\mathcal{Y}}\\newcommand{\\calC}{\\mathcal{C}}\\renewcommand{\\ae}{\\mathrm{a.e.}\\;}\\newcommand{\\cZ}{\\mathcal{Z}}\\newcommand{\\fF}{\\mathfrak{F}}\\newcommand{\\fI}{\\mathfrak{I}}\\newcommand{\\rV}{\\mathrm{V}}\\newcommand{\\cE}{\\mathcal{E}}\\newcommand{\\sMap}{\\sigma\\textrm{-}\\mathrm{Map}}\\newcommand{\\cC}{\\mathcal{C}}\\newcommand{\\comp}{\\complement}\\newcommand{\\J}{\\mathcal{J}}\\newcommand{\\sumN}[1]{\\sum_{#1\\in\\N}}\\newcommand{\\cupN}[1]{\\cup_{#1\\in\\N}}\\newcommand{\\capN}[1]{\\cap_{#1\\in\\N}}\\newcommand{\\Sum}[1]{\\sum_{#1=1}^\\infty}\\newcommand{\\sumn}{\\sum_{n=1}^\\infty}\\newcommand{\\summ}{\\sum_{m=1}^\\infty}\\newcommand{\\sumk}{\\sum_{k=1}^\\infty}\\newcommand{\\sumi}{\\sum_{i=1}^\\infty}\\newcommand{\\sumj}{\\sum_{j=1}^\\infty}\\newcommand{\\cupn}{\\cup_{n=1}^\\infty}\\newcommand{\\capn}{\\cap_{n=1}^\\infty}\\newcommand{\\cupk}{\\cup_{k=1}^\\infty}\\newcommand{\\cupi}{\\cup_{i=1}^\\infty}\\newcommand{\\cupj}{\\cup_{j=1}^\\infty}\\newcommand{\\limn}{\\lim_{n\\to\\infty}}\\renewcommand{\\L}{\\mathcal{L}}\\newcommand{\\cL}{\\mathcal{L}}\\newcommand{\\Cl}{\\mathrm{Cl}}\\newcommand{\\cN}{\\mathcal{N}}\\newcommand{\\Ae}{\\textrm{-a.e.}\\;}\\renewcommand{\\csub}{\\overset{\\textrm{closed}}{\\subset}}\\renewcommand{\\csup}{\\overset{\\textrm{closed}}{\\supset}}\\newcommand{\\wB}{\\wt{B}}\\newcommand{\\cG}{\\mathcal{G}}\\newcommand{\\Lip}{\\mathrm{Lip}}\\newcommand{\\AC}{\\mathrm{AC}}\\newcommand{\\Mol}{\\mathrm{Mol}}\n\n\\newcommand{\\Pe}{\\mathrm{Pe}}\\newcommand{\\wR}{\\wh{\\mathbb{\\R}}}\\newcommand*{\\Laplace}{\\mathop{}\\!\\mathbin\\bigtriangleup}\\newcommand*{\\DAlambert}{\\mathop{}\\!\\mathbin\\Box}\\newcommand{\\bT}{\\mathbb{T}}\\newcommand{\\dx}{\\dslash x}\\newcommand{\\dt}{\\dslash t}\\newcommand{\\ds}{\\dslash s}\n\n\\newcommand{\\round}{\\mathrm{round}}\\newcommand{\\cond}{\\mathrm{cond}}\\newcommand{\\diag}{\\mathrm{diag}}\n\\newcommand{\\Adj}{\\mathrm{Adj}}\\newcommand{\\Pf}{\\mathrm{Pf}}\\newcommand{\\Sg}{\\mathrm{Sg}}\n\n\n\\newcommand{\\aseq}{\\overset{\\text{a.s.}}{=}}\\newcommand{\\deq}{\\overset{\\text{d}}{=}}\\newcommand{\\cV}{\\mathcal{V}}\\newcommand{\\FM}{\\mathrm{FM}}\\newcommand{\\KR}{\\mathrm{KR}}\\newcommand{\\rba}{\\mathrm{rba}}\\newcommand{\\rca}{\\mathrm{rca}}\\newcommand{\\Prob}{\\mathrm{Prob}}\\newcommand{\\X}{\\mathcal{X}}\\newcommand{\\Meas}{\\mathrm{Meas}}\\newcommand{\\as}{\\;\\text{a.s.}}\\newcommand{\\io}{\\;\\mathrm{i.o.}}\\newcommand{\\fe}{\\;\\text{f.e.}}\\newcommand{\\bF}{\\mathbb{F}}\\newcommand{\\W}{\\mathcal{W}}\\newcommand{\\Pois}{\\mathrm{Pois}}\\newcommand{\\iid}{\\text{i.i.d.}}\\newcommand{\\wconv}{\\rightsquigarrow}\\newcommand{\\Var}{\\mathrm{Var}}\\newcommand{\\xrightarrown}{\\xrightarrow{n\\to\\infty}}\\newcommand{\\au}{\\mathrm{au}}\\newcommand{\\cT}{\\mathcal{T}}\\newcommand{\\wto}{\\overset{\\text{w}}{\\to}}\\newcommand{\\dto}{\\overset{\\text{d}}{\\to}}\\newcommand{\\sto}{\\overset{\\text{s}}{\\to}}\\newcommand{\\pto}{\\overset{\\text{p}}{\\to}}\\newcommand{\\mto}{\\overset{\\text{m}}{\\to}}\\newcommand{\\vto}{\\overset{v}{\\to}}\\newcommand{\\Cont}{\\mathrm{Cont}}\\newcommand{\\stably}{\\mathrm{stably}}\\newcommand{\\Np}{\\mathbb{N}^+}\\newcommand{\\oM}{\\overline{\\mathcal{M}}}\\newcommand{\\fP}{\\mathfrak{P}}\\newcommand{\\sign}{\\mathrm{sign}}\n\\newcommand{\\Borel}{\\mathrm{Borel}}\\newcommand{\\Mid}{\\,|\\,}\\newcommand{\\middleMid}{\\;\\middle|\\;}\\newcommand{\\CP}{\\mathrm{CP}}\\newcommand{\\bD}{\\mathbb{D}}\\newcommand{\\bL}{\\mathbb{L}}\\newcommand{\\fW}{\\mathfrak{W}}\\newcommand{\\DL}{\\mathcal{D}\\mathcal{L}}\\renewcommand{\\r}[1]{\\mathrm{#1}}\\newcommand{\\rC}{\\mathrm{C}}\\newcommand{\\qqquad}{\\qquad\\quad}\n\n\\newcommand{\\bit}{\\mathrm{bit}}\n\n\\newcommand{\\err}{\\mathrm{err}}\n\n\\newcommand{\\varparallel}{\\mathbin{\\!/\\mkern-5mu/\\!}}\\newcommand{\\Ri}{\\mathrm{Ri}}\\newcommand{\\Cone}{\\mathrm{Cone}}\\newcommand{\\Int}{\\mathrm{Int}}\n\n\\newcommand{\\pre}{\\mathrm{pre}}\\newcommand{\\om}{\\omega}\n\n\n\\newcommand{\\del}{\\partial}\n\\newcommand{\\LHS}{\\mathrm{LHS}}\\newcommand{\\RHS}{\\mathrm{RHS}}\\newcommand{\\bnu}{\\boldsymbol{\\nu}}\\newcommand{\\interior}{\\mathrm{in}\\;}\\newcommand{\\SH}{\\mathrm{SH}}\\renewcommand{\\v}{\\boldsymbol{\\nu}}\\newcommand{\\n}{\\mathbf{n}}\\newcommand{\\ssub}{\\Subset}\\newcommand{\\curl}{\\mathrm{curl}}\n\n\\newcommand{\\Ei}{\\mathrm{Ei}}\\newcommand{\\sn}{\\mathrm{sn}}\\newcommand{\\wgamma}{\\widetilde{\\gamma}}\n\n\\newcommand{\\Ens}{\\mathrm{Ens}}\n\n\\newcommand{\\cl}{\\mathrm{cl}}\\newcommand{\\x}{\\boldsymbol{x}}\n\n\\newcommand{\\Do}{\\mathrm{Do}}\\newcommand{\\IV}{\\mathrm{IV}}\n\n\\newcommand{\\AIC}{\\mathrm{AIC}}\\newcommand{\\mrl}{\\mathrm{mrl}}\\newcommand{\\dotx}{\\dot{x}}\\newcommand{\\UMV}{\\mathrm{UMV}}\\newcommand{\\BLU}{\\mathrm{BLU}}\n\n\\newcommand{\\comb}[2]{\\begin{pmatrix}#1\\\\#2\\end{pmatrix}}\\newcommand{\\bP}{\\mathbb{P}}\\newcommand{\\compsub}{\\overset{\\textrm{cpt}}{\\subset}}\\newcommand{\\lip}{\\textrm{lip}}\\newcommand{\\BL}{\\mathrm{BL}}\\newcommand{\\G}{\\mathbb{G}}\\newcommand{\\NB}{\\mathrm{NB}}\\newcommand{\\oR}{\\ov{\\R}}\\newcommand{\\liminfn}{\\liminf_{n\\to\\infty}}\\newcommand{\\limsupn}{\\limsup_{n\\to\\infty}}\\newcommand{\\esssup}{\\mathrm{ess.sup}}\\newcommand{\\asto}{\\xrightarrow{\\as}}\\newcommand{\\Cov}{\\mathrm{Cov}}\\newcommand{\\cQ}{\\mathcal{Q}}\\newcommand{\\VC}{\\mathrm{VC}}\\newcommand{\\mb}{\\mathrm{mb}}\\newcommand{\\Avar}{\\mathrm{Avar}}\\newcommand{\\bB}{\\mathbb{B}}\\newcommand{\\bW}{\\mathbb{W}}\\newcommand{\\sd}{\\mathrm{sd}}\\newcommand{\\w}[1]{\\widehat{#1}}\\newcommand{\\bZ}{\\mathbb{Z}}\\newcommand{\\Bernoulli}{\\mathrm{Ber}}\\newcommand{\\Ber}{\\mathrm{Ber}}\\newcommand{\\Mult}{\\mathrm{Mult}}\\newcommand{\\BPois}{\\mathrm{BPois}}\\newcommand{\\fraks}{\\mathfrak{s}}\\newcommand{\\frakk}{\\mathfrak{k}}\\newcommand{\\IF}{\\mathrm{IF}}\\newcommand{\\bX}{\\boldsymbol{X}}\\newcommand{\\bx}{\\boldsymbol{x}}\\newcommand{\\indep}{\\perp\\!\\!\\!\\perp}\\newcommand{\\IG}{\\mathrm{IG}}\\newcommand{\\Levy}{\\mathrm{Levy}}\\newcommand{\\MP}{\\mathrm{MP}}\\newcommand{\\Hermite}{\\mathrm{Hermite}}\\newcommand{\\Skellam}{\\mathrm{Skellam}}\\newcommand{\\Dirichlet}{\\mathrm{Dirichlet}}\\renewcommand{\\Beta}{\\operatorname{Beta}}\\newcommand{\\bE}{\\mathbb{E}}\\newcommand{\\bG}{\\mathbb{G}}\\newcommand{\\MISE}{\\mathrm{MISE}}\\newcommand{\\logit}{\\mathtt{logit}}\\newcommand{\\expit}{\\mathtt{expit}}\\newcommand{\\cK}{\\mathcal{K}}\\newcommand{\\dl}{\\dot{l}}\\newcommand{\\dotp}{\\dot{p}}\\newcommand{\\wl}{\\wt{l}}\\newcommand{\\Gauss}{\\mathrm{Gauss}}\\newcommand{\\fA}{\\mathfrak{A}}\\newcommand{\\under}{\\mathrm{under}\\;}\\newcommand{\\whtheta}{\\wh{\\theta}}\\newcommand{\\Em}{\\mathrm{Em}}\\newcommand{\\ztheta}{{\\theta_0}}\n\\newcommand{\\rO}{\\mathrm{O}}\\newcommand{\\Bin}{\\mathrm{Bin}}\\newcommand{\\rW}{\\mathrm{W}}\\newcommand{\\rG}{\\mathrm{G}}\\newcommand{\\rB}{\\mathrm{B}}\\newcommand{\\rU}{\\mathrm{U}}\\newcommand{\\HG}{\\mathrm{HG}}\\newcommand{\\GAMMA}{\\mathrm{Gamma}}\\newcommand{\\Cauchy}{\\mathrm{Cauchy}}\\newcommand{\\rt}{\\mathrm{t}}\\newcommand{\\rF}{\\mathrm{F}}\n\\newcommand{\\FE}{\\mathrm{FE}}\\newcommand{\\bV}{\\boldsymbol{V}}\\newcommand{\\GLS}{\\mathrm{GLS}}\\newcommand{\\be}{\\boldsymbol{e}}\\newcommand{\\POOL}{\\mathrm{POOL}}\\newcommand{\\GMM}{\\mathrm{GMM}}\\newcommand{\\MM}{\\mathrm{MM}}\\newcommand{\\SSIV}{\\mathrm{SSIV}}\\newcommand{\\JIV}{\\mathrm{JIV}}\\newcommand{\\AR}{\\mathrm{AR}}\\newcommand{\\ILS}{\\mathrm{ILS}}\\newcommand{\\SLS}{\\mathrm{SLS}}\\newcommand{\\LIML}{\\mathrm{LIML}}\n\n\\newcommand{\\Rad}{\\mathrm{Rad}}\\newcommand{\\bY}{\\boldsymbol{Y}}\\newcommand{\\pone}{{(1)}}\\newcommand{\\ptwo}{{(2)}}\\newcommand{\\ps}[1]{{(#1)}}\\newcommand{\\fsub}{\\overset{\\text{finite}}{\\subset}}\n\n\n\\newcommand{\\varlim}{\\varprojlim}\\newcommand{\\Hom}{\\mathrm{Hom}}\\newcommand{\\Iso}{\\mathrm{Iso}}\\newcommand{\\Mor}{\\mathrm{Mor}}\\newcommand{\\Isom}{\\mathrm{Isom}}\\newcommand{\\Aut}{\\mathrm{Aut}}\\newcommand{\\End}{\\mathrm{End}}\\newcommand{\\op}{\\mathrm{op}}\\newcommand{\\ev}{\\mathrm{ev}}\\newcommand{\\Ob}{\\mathrm{Ob}}\\newcommand{\\Ar}{\\mathrm{Ar}}\\newcommand{\\Arr}{\\mathrm{Arr}}\\newcommand{\\Set}{\\mathrm{Set}}\\newcommand{\\Grp}{\\mathrm{Grp}}\\newcommand{\\Cat}{\\mathrm{Cat}}\\newcommand{\\Mon}{\\mathrm{Mon}}\\newcommand{\\Ring}{\\mathrm{Ring}}\\newcommand{\\CRing}{\\mathrm{CRing}}\\newcommand{\\Ab}{\\mathrm{Ab}}\\newcommand{\\Pos}{\\mathrm{Pos}}\\newcommand{\\Vect}{\\mathrm{Vect}}\\newcommand{\\FinVect}{\\mathrm{FinVect}}\\newcommand{\\FinSet}{\\mathrm{FinSet}}\\newcommand{\\FinMeas}{\\mathrm{FinMeas}}\\newcommand{\\OmegaAlg}{\\Omega\\text{-}\\mathrm{Alg}}\\newcommand{\\OmegaEAlg}{(\\Omega,E)\\text{-}\\mathrm{Alg}}\\newcommand{\\Fun}{\\mathrm{Fun}}\\newcommand{\\Func}{\\mathrm{Func}}\n\n\\newcommand{\\Stoch}{\\mathrm{Stoch}}\\newcommand{\\FinStoch}{\\mathrm{FinStoch}}\\newcommand{\\Copy}{\\mathrm{copy}}\\newcommand{\\Delete}{\\mathrm{delete}}\n\\newcommand{\\Bool}{\\mathrm{Bool}}\\newcommand{\\CABool}{\\mathrm{CABool}}\\newcommand{\\CompBoolAlg}{\\mathrm{CompBoolAlg}}\\newcommand{\\BoolAlg}{\\mathrm{BoolAlg}}\\newcommand{\\BoolRng}{\\mathrm{BoolRng}}\\newcommand{\\HeytAlg}{\\mathrm{HeytAlg}}\\newcommand{\\CompHeytAlg}{\\mathrm{CompHeytAlg}}\\newcommand{\\Lat}{\\mathrm{Lat}}\\newcommand{\\CompLat}{\\mathrm{CompLat}}\\newcommand{\\SemiLat}{\\mathrm{SemiLat}}\\newcommand{\\Stone}{\\mathrm{Stone}}\\newcommand{\\Mfd}{\\mathrm{Mfd}}\\newcommand{\\LieAlg}{\\mathrm{LieAlg}}\n\\newcommand{\\Op}{\\mathrm{Op}}\n\\newcommand{\\Sh}{\\mathrm{Sh}}\n\\newcommand{\\Diff}{\\mathrm{Diff}}\n\\newcommand{\\B}{\\mathcal{B}}\\newcommand{\\cB}{\\mathcal{B}}\\newcommand{\\Span}{\\mathrm{Span}}\\newcommand{\\Corr}{\\mathrm{Corr}}\\newcommand{\\Decat}{\\mathrm{Decat}}\\newcommand{\\Rep}{\\mathrm{Rep}}\\newcommand{\\Grpd}{\\mathrm{Grpd}}\\newcommand{\\sSet}{\\mathrm{sSet}}\\newcommand{\\Mod}{\\mathrm{Mod}}\\newcommand{\\SmoothMnf}{\\mathrm{SmoothMnf}}\\newcommand{\\coker}{\\mathrm{coker}}\\newcommand{\\Ord}{\\mathrm{Ord}}\\newcommand{\\eq}{\\mathrm{eq}}\\newcommand{\\coeq}{\\mathrm{coeq}}\\newcommand{\\act}{\\mathrm{act}}\n\n\\newcommand{\\apf}{\\mathrm{apf}}\\newcommand{\\opt}{\\mathrm{opt}}\\newcommand{\\IS}{\\mathrm{IS}}\\newcommand{\\IR}{\\mathrm{IR}}\\newcommand{\\iidsim}{\\overset{\\text{i.i.d.}}{\\sim}}\\newcommand{\\propt}{\\,\\propto\\,}\\newcommand{\\bM}{\\mathbb{M}}\\newcommand{\\cX}{\\mathcal{X}}\\newcommand{\\cY}{\\mathcal{Y}}\\newcommand{\\cP}{\\mathcal{P}}\\newcommand{\\ola}[1]{\\overleftarrow{#1}}\n\n\\renewcommand{\\iff}{\\;\\mathrm{iff}\\;}\n\\newcommand{\\False}{\\mathrm{False}}\\newcommand{\\True}{\\mathrm{True}}\n\\newcommand{\\otherwise}{\\mathrm{otherwise}}\n\\newcommand{\\suchthat}{\\;\\mathrm{s.t.}\\;}\n\n\\newcommand{\\cM}{\\mathcal{M}}\\newcommand{\\M}{\\mathbb{M}}\\newcommand{\\cF}{\\mathcal{F}}\\newcommand{\\cD}{\\mathcal{D}}\\newcommand{\\fX}{\\mathfrak{X}}\\newcommand{\\fY}{\\mathfrak{Y}}\\newcommand{\\fZ}{\\mathfrak{Z}}\\renewcommand{\\H}{\\mathcal{H}}\\newcommand{\\cH}{\\mathcal{H}}\\newcommand{\\fH}{\\mathfrak{H}}\\newcommand{\\bH}{\\mathbb{H}}\\newcommand{\\id}{\\mathrm{id}}\\newcommand{\\A}{\\mathcal{A}}\n\\newcommand{\\lmd}{\\lambda}\n\\newcommand{\\Lmd}{\\Lambda}\n\\newcommand{\\cI}{\\mathcal{I}}\n\n\\newcommand{\\Lrarrow}{\\;\\;\\Leftrightarrow\\;\\;}\n\\DeclareMathOperator{\\des}{des}\n\\DeclareMathOperator{\\nd}{nd}\n\\DeclareMathOperator{\\dsep}{d-sep}\n\\DeclareMathOperator{\\sep}{sep}\n\\newcommand{\\rLL}{\\mathrm{LL}}\\newcommand{\\HT}{\\mathrm{HT}}\\newcommand{\\PS}{\\mathrm{PS}}\\newcommand{\\rI}{\\mathrm{I}}\n$$\n\n:::\n\n:::\n\n\n\n## はじめに\n\nベイズ線型回帰分析は多くのデータ解析における「最初の一歩」である．ベイズ回帰分析から始まるベイズのワークフローや，理論的な背景は次稿を参照：\n\n::: {#lst-survey}\n:::\n\nここではベイズ回帰モデルに変数を増やしていく際の解釈の変化や，変数の選択の問題などの実際的な問題を扱う．\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(readxl)\nraw_df <- read_excel(path)\n```\n:::\n\n::: {.cell}\n\n:::\n\n\n\n## ベイズ線型重回帰\n\n### ベイズ単回帰の実行と視覚化\n\n<!-- \n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rstanarm)\noptions(auto_write = TRUE)\noptions(mc.cores = parallel::detectCores())\n\nfit1 <- stan_glm(\n  formula = BMI ~ LAB,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprior_summary(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nPriors for model 'fit1' \n------\nIntercept (after predictors centered)\n  Specified prior:\n    ~ normal(location = 23, scale = 2.5)\n  Adjusted prior:\n    ~ normal(location = 23, scale = 8.7)\n\nCoefficients\n  Specified prior:\n    ~ normal(location = 0, scale = 2.5)\n  Adjusted prior:\n    ~ normal(location = 0, scale = 7.8)\n\nAuxiliary (sigma)\n  Specified prior:\n    ~ exponential(rate = 1)\n  Adjusted prior:\n    ~ exponential(rate = 0.29)\n------\nSee help('prior_summary.stanreg') for more details\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nprint(fit1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nstan_glm\n family:       gaussian [identity]\n formula:      BMI ~ LAB\n observations: 839\n predictors:   2\n------\n            Median MAD_SD\n(Intercept) 20.7    0.4  \nLAB          0.6    0.1  \n\nAuxiliary parameter(s):\n      Median MAD_SD\nsigma 3.4    0.1   \n\n------\n* For help interpreting the printed output see ?print.stanreg\n* For info on the priors used see ?prior_summary.stanreg\n```\n\n\n:::\n:::\n\n\n-->\n\n最終的には\n$$\n\\texttt{BMI} = \\beta_0 + \\beta_{\\texttt{LAB}}\\cdot\\mathtt{LAB} + \\beta_{\\texttt{LDL}}\\cdot\\mathtt{LDL} + \\beta_{\\texttt{LAB:LDL}}\\cdot\\mathtt{LAB}\\cdot\\mathtt{LDL} + \\epsilon\n$$\n$$\n\\beta_0\\sim\\rt(3;\\mu_0,3.4),\\qquad\\ep\\sim\\rN(0,\\sigma^2),\n$$\n$$\n\\beta_{\\texttt{LAB}},\\beta_{\\texttt{LDL}},\\beta_{\\texttt{LAB:LDL}}\\sim\\rN(0,\\infty),\\qquad\\sigma\\sim\\rt(3;0,3.4),\n$$\nという５つのパラメータを持ったモデルを考えるが，ここではまず１つの説明変数 LAB にのみ注目する．\n\nなお，分散パラメータに出てくる $3.4$ の数字は，被説明変数 BMI の標本分散である：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsqrt(var(raw_df$BMI))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3.471758\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(brms)\nmodel1 <- bf(\n  BMI ~ LAB\n)\nfit1 <- brm(\n  formula = model1,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(knitr)\nkable(get_prior(\n  formula = model1,\n  data = raw_df\n))\n```\n\n::: {.cell-output-display}\n\n\n|prior                   |class     |coef |group |resp |dpar |nlpar |lb |ub |source  |\n|:-----------------------|:---------|:----|:-----|:----|:----|:-----|:--|:--|:-------|\n|                        |b         |     |      |     |     |      |   |   |default |\n|                        |b         |LAB  |      |     |     |      |   |   |default |\n|student_t(3, 22.7, 3.4) |Intercept |     |      |     |     |      |   |   |default |\n|student_t(3, 0, 3.4)    |sigma     |     |      |     |     |      |0  |   |default |\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fit1, variable = c(\"b_Intercept\", \"b_LAB\"))\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit1)$fixed\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            Estimate Est.Error   l-95% CI   u-95% CI     Rhat Bulk_ESS Tail_ESS\nIntercept 20.7016164 0.4252379 19.8602962 21.5361855 1.000239 10139.53 7329.774\nLAB        0.6106412 0.1044871  0.4069246  0.8194326 1.000457 10303.02 6531.444\n```\n\n\n:::\n:::\n\n\n\n$\\beta_{\\texttt{LAB}}$ の最頻値＝最尤推定量は $0.6$ である．これは，LAB が $1$ 違う個人の間で BMI の値が約 $0.6$ 違うと解釈できる．\n\n例えば LAB が $3.0$ の個人の予測される BMI は\n$$\n\\mathtt{BMI}\\approx20.7+0.6\\times3.0=22.5\n$$\nとなる．\n\n\n\n::: {.cell fig-caption='回帰直線のプロット'}\n\n```{.r .cell-code}\nplot(raw_df$LAB, raw_df$BMI, xlab=\"LAB\", ylab=\"BMI\")\nabline(summary(fit1)$fixed[1,1], summary(fit1)$fixed[2,1])\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/fig-fit1-line-1.png){#fig-fit1-line width=672}\n:::\n:::\n\n\n\nしかしこの図を見ればわかる通り，LAB は BMI の変動の一部しか説明しておらず，上述ような点推定的な議論にどれほど意味があるかは疑問である．\n\nベイズ回帰では幅を持って結果を理解できるため，その美点を活かさない理由はない．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(raw_df$LAB, raw_df$BMI, xlab=\"LAB\", ylab=\"BMI\")\nsims <- as.matrix(fit1)\nsims_to_display <- sample(nrow(sims), 100)\nfor (i in sims_to_display) {\n  abline(sims[i, 1], sims[i, 2], col = \"gray\")\n}\nabline(summary(fit1)$fixed[1,1], summary(fit1)$fixed[2,1])\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n### モデルのチェック：事後予測分布と残差プロット {#sec-pp-check1}\n\nさらにベイズ模型は事後予測分布をプロットし，実際の観測データと比べることで，モデルがデータ生成過程をどれほど反映できているかが瞬時に把握できる：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsynthetic_data <- posterior_predict(fit1, newdata = data.frame(LAB = 3.0), ndraws = 10000)\nhist(synthetic_data, nclass = 100, xlab = \"BMI\", main = \"Predicted BMI for a person with LAB = 3.0\")\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- pp_check(fit1, ndraws = 100)\np1\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n事後予測分布のプロットを見ると，モデルが取り逃がしている構造として，BMI の分布が左右で非対称であることがあることがわかる．回帰直線のプロット @fig-fit1-line を見ても，直線の上側の点の方が裾が広く分散している．\n\n「やせ」と「肥満」は対称ではないのである．\n\n残差をプロットすることでさらに明らかになる：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- residuals(fit1)\nplot(raw_df$LAB, res[,1], xlab=\"LAB\", ylab=\"Residuals\")\nabline(0,0)\n```\n\n::: {.cell-output-display}\n![残差のプロット](BayesRegression_files/figure-html/fig-fit1-res-1.png){#fig-fit1-res width=672}\n:::\n:::\n\n\n\nただし，残差と事後予測分布には，標本内のデータを見ているか，標本外のデータを想定しているかという大きな違いがある．\n\nこの２つの結果が乖離している場合，モデルが標本に過適合していることを疑う必要がある．具体的には次節 [-@sec-model-validation] 参照．\n\n### 変数の追加による係数の解釈の変化\n\nここに新たな変数 LDL を追加すると，LAB の係数 $\\beta_{\\texttt{LAB}}$ は $0.6$ から $0.5$ に減少する．これはどういう意味だろうか？\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel2 <- update(model1, BMI ~ LAB + LDL)\nfit2 <- brm(\n  formula = model2,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fit2, variable = c(\"b_Intercept\", \"b_LAB\", \"b_LDL\"))\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n一般に係数の追加は層別に当たる．例えばこの結果は，**LDL の値が同じ人の中では** LAB が $1$ 違う人の BMI の値が $0.5$ 違うと解釈できる．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit2)$fixed\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Estimate   Est.Error      l-95% CI    u-95% CI     Rhat  Bulk_ESS\nIntercept 20.163355017 0.517973058  1.914440e+01 21.17476148 1.000687 12617.051\nLAB        0.483922973 0.124983258  2.390836e-01  0.72708676 1.000109  9080.697\nLDL        0.008582008 0.004412872 -8.612193e-05  0.01716285 1.000207  9537.469\n          Tail_ESS\nIntercept 7619.117\nLAB       7383.503\nLDL       7324.199\n```\n\n\n:::\n:::\n\n\n\nここで $\\beta_{\\texttt{LDL}}$ の値が極めて小さいことに気づくかもしれない．これは LAB に比べて LDL の影響が小さいことを意味しない．なぜならばこの２つの変数はスケールが約 $10^2$ 違うためである．LDL は 100 のスケール，LAB は 1 のスケールである．\n\n説明変数 LAB と LDL のどちらが重要か，どっちをモデルに含めるべきかは全く別の方法で議論する必要がある．\n\n### データの正規化：係数同士の比較 {#sec-standardization}\n\n係数同士の比較をするためには，説明変数のスケールを揃える必要がある．\n\nそこでデータを正規化してみる：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- data.frame(\n  sBMI = scale(raw_df$BMI),\n  sLAB = scale(raw_df$LAB),\n  sLDL = scale(raw_df$LDL)\n)\n\nmodel2s <- bf(sBMI ~ sLAB + sLDL)\nfit2s <- brm(\n  formula = model2s,\n  data = df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fit2s, variable = c(\"b_Intercept\", \"b_sLAB\", \"b_sLDL\"))\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n$\\beta_{\\texttt{LDL}}$ の方が $0$ に近く推定されていることがわかる．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit2s)$fixed\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Estimate  Est.Error      l-95% CI   u-95% CI     Rhat  Bulk_ESS\nIntercept 0.0002000558 0.03413500 -0.0678288418 0.06679971 1.000381 10219.138\nsLAB      0.1549410096 0.03976303  0.0768082214 0.23239875 1.000207  9432.452\nsLDL      0.0773993520 0.03996238 -0.0009089375 0.15622134 1.000184  9099.179\n          Tail_ESS\nIntercept 6757.463\nsLAB      7405.609\nsLDL      7524.666\n```\n\n\n:::\n:::\n\n\n\nデータを正規化してしまったため，直接的な係数の解釈はできないが，係数を相互に比較できる．\n\n係数の大小を見ることで，LAB の方が有効な説明変数であるように思える．だが元々 LAB は $0$ から離れた値だったが，LDL を入れた途端にいずれも $0$ にかぶりかけている．これは２つの間に共線型性が存在するためである．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(df$sLAB, df$sLDL, xlab = \"LAB\", ylab = \"LDL\")\nlm(sLDL ~ sLAB, data = df) %>% abline()\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\nまたその他のモデルの性質は変わらない．例えば事後予測分布も変わらない．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(gridExtra)\np2s <- pp_check(fit2s, ndraws = 100)\np2 <- pp_check(fit2, ndraws = 100)\ngrid.arrange(p2, p2s, nrow = 1)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n### 交差項の係数の解釈\n\n再び正規化する前のデータに戻る．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel3 <- update(model2, BMI ~ LAB * LDL)\nfit3 <- brm(\n  formula = model3,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fit3, variable = c(\"b_Intercept\", \"b_LAB\", \"b_LDL\", \"b_LAB:LDL\"))\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit3)$fixed\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Estimate   Est.Error     l-95% CI     u-95% CI     Rhat Bulk_ESS\nIntercept 18.359567486 1.602638690 15.239030706 21.511927719 1.000538 3653.578\nLAB        0.946655585 0.410287745  0.146005654  1.745291095 1.000150 3690.989\nLDL        0.023793589 0.013531229 -0.002859942  0.050046848 1.000415 3761.381\nLAB:LDL   -0.003753507 0.003173122 -0.009944571  0.002469838 1.000165 3555.572\n          Tail_ESS\nIntercept 4433.506\nLAB       4735.780\nLDL       4718.947\nLAB:LDL   4255.115\n```\n\n\n:::\n:::\n\n\n\n交差項を含む線型回帰における係数の解釈はさらに限定的になる．\n\n$\\beta_{\\texttt{LAB}}$ は LDL が $0$ である人が仮にいたとした場合の，LAB が $1$ 違う人の間の BMI の平均的な違いを表す，と解釈できる．（LDL の平均が $0$ になるように変数変換をして回帰するともっと自然な解釈ができる）．\n\n$\\beta_{\\texttt{LAB:LDL}}$ は片方の係数 $\\beta_{\\texttt{LAB}}$ を固定した際，LDL が $1$ だけ違うグループにおける係数 $\\beta_{\\texttt{LDL}}$ との違いを表す．\n\nすなわち交差項の追加は，LDL に依って層別し，それぞれのグループに異なる $\\beta_{\\texttt{LAB}}$ を推定することを可能にする．この点で階層モデリングに似ている．\n\n### 交差項の層別効果の視覚化\n\n交差項 `LAB*LDL` の追加は，LDL の違うサブグループの間に異なる LAB をフィッティングすることを可能にする．\n\nこのことを最もよく見るには，LDL が上半分か下半分かで LAB の係数がどう変わるかを見るのが良い．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nraw_df$LDLcate2 <- ifelse(raw_df$LDL > median(raw_df$LDL), \"High\", \"Low\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel3_cate <- bf(BMI ~ LAB * LDLcate2)\nfit3_cate <- brm(\n  formula = model3_cate,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(raw_df$LAB, raw_df$BMI, xlab=\"LAB\", ylab=\"BMI\")\nb_hat <- summary(fit3_cate)$fixed\nabline(b_hat[1,1], b_hat[2,1], col = \"red\")\nabline(b_hat[1,1] + b_hat[3,1], b_hat[2,1] + b_hat[4,1], col = \"blue\")\nlegend(\"topleft\", # または \"topright\", \"bottomleft\", \"bottomright\" など\n       legend = c(\"High\", \"Low\"),\n       col = c(\"red\", \"blue\"),\n       lty = 1)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-30-1.png){width=672}\n:::\n:::\n\n\n\nLDL が大きいと，LAB の BMI に与える影響は緩やかになることがわかる．LDL の方が LAB の代わりに BMI の増加を説明してしまっているとも考えられる．\n\n<!--\n\n### まとめ\n\n線型回帰において，説明変数の追加は，「他の説明変数を固定したグループ内での」係数の推定に変化する（階層モデリングにつながる見方）．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel3s <- update(model2s, sBMI ~ sLAB * sLDL)\nfit3s <- brm(\n  formula = model3s,\n  data = df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplot(fit3s, variable = c(\"b_Intercept\", \"b_sLAB\", \"b_sLDL\", \"b_sLAB:sLDL\"))\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-32-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsummary(fit3s)$fixed\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n             Estimate  Est.Error     l-95% CI   u-95% CI      Rhat  Bulk_ESS\nIntercept  0.01961391 0.03754898 -0.053888391 0.09452453 1.0010878 11368.540\nsLAB       0.15684539 0.03976921  0.078153575 0.23599796 1.0002083 10873.281\nsLDL       0.08193502 0.03998232  0.003726138 0.16136846 0.9999750  9660.573\nsLAB:sLDL -0.03691679 0.03109320 -0.098651142 0.02357867 0.9998178 11541.571\n          Tail_ESS\nIntercept 6912.316\nsLAB      7571.400\nsLDL      7330.971\nsLAB:sLDL 7521.834\n```\n\n\n:::\n:::\n\n\n\n全ての係数がほとんど０に近い値になってしまった．\n\nしかし事後予測分布はあまり変わらないようである．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\np3s <- pp_check(fit3s, ndraws = 100)\ngrid.arrange(p2s, p3s, nrow = 1)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-34-1.png){width=672}\n:::\n:::\n\n\n-->\n\n## モデル検証 {#sec-model-validation}\n\n### はじめに\n\n残差プロットや事後予測プロットによるモデルの検証は，解析と並行して見てきた．\n\nここではより詳細に，モデルの予測性能に基づいた検証・比較方法を見る．\n\n交差検証法によるスコア `elpd_loo` によるモデル比較が一つ推奨される．\n\n### 決定係数\n\n@fig-fit1-line の回帰直線のプロットと @fig-fit1-res の残差プロットを見ると，残差がまだ構造を持っていることがわかる．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- residuals(fit3)\nplot(raw_df$LAB, res[,1], xlab=\"LAB\", ylab=\"Residuals\")\nabline(0,0)\n```\n\n::: {.cell-output-display}\n![fit3 の残差のプロット](BayesRegression_files/figure-html/fig-fit3-res-1.png){#fig-fit3-res width=672}\n:::\n:::\n\n\n\nこの残差は標本分散 $\\wh{\\sigma}^2$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsigma <- sqrt(var(res)[1,1])\nprint(sigma)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 3.394462\n```\n\n\n:::\n:::\n\n\n\nを持っている．\n\nひとまず LAB と LDL について回帰をすることで，データの変動がどれほど説明できたかを考えてみよう．\n\n$$\nR^2:=1-\\frac{\\wh{\\sigma}^2}{s_y^2}=\\frac{s_y^2-\\wh{\\sigma}^2}{s_y^2}\n$$\n\nという値は [**決定係数**](https://ja.wikipedia.org/wiki/決定係数) と呼ばれ，データ $y$ の分散 $s_y^2$ のうち「説明された分散」の割合を表す．^[決定係数は，回帰が OLS 推定量により推定された場合には $Y$ と説明変数のベクトル $X$ との間の **重相関係数** とも一致する [@Mudholkar2014]．[@Gelman-Hill-Vehtari2020 p.168] も参照．一般に決定係数は母集団の多重相関係数の一致推定量だと見れる．こうみた場合のバイアスを低減・脱離した値に，自由度調整済み決定係数，[@Olkin-Pratt58-UMVestimator-CorrelationCoefficient] 推定量などが存在する．]\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n1-sigma^2/var(raw_df$BMI)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.04403279\n```\n\n\n:::\n:::\n\n\n\nデータの変動の $4\\%$ しか説明できていないことがわかる．\n\n### ベイズ決定係数\n\nベイズ決定係数 [@Gelman+2019] は `brms` パッケージで次のように計算できる：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbayes_R2(fit3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Estimate  Est.Error       Q2.5      Q97.5\nR2 0.04734955 0.01373743 0.02254274 0.07643401\n```\n\n\n:::\n:::\n\n\n\n以上の $R^2$ の議論では係数を点推定して「残差」を議論していたが，モデルのパラメータ（の関数）である以上，ベイズ推定することもできる．\n\nベイズ決定係数（の事後予測値）は，事後予測分布からのサンプルを用いて複数回予測値 $\\wh{y}_i$ を計算し，\n$$\nR^2_{\\texttt{Bayes}}:=\\frac{\\V[\\wh{y}]}{\\V[\\wh{y}]+\\sigma^2}\n$$\nという値で「データの変動のうち説明された割合」を表す．\n\n### AIC\n\n[@Akaike74-AIC] は次のように定義される：\n$$\n\\mathtt{AIC}=-2\\Paren{\\sup_\\theta\\log p(y|\\theta)}+2p.\n$$\n\n第１項は deviance とも呼ばれ，残差を表す．\n\nAIC は新たなデータ点が観測された際の，そのデータ点に対するデビアンス（ある種の損失）の推定量となっており，小さいほどよい．\n\nAIC と同様の推定を，計算機集約的に行う方法に次節の交差検証法がある：\n\n### 交差検証と elpd\n\n事後予測検証では事後分布と観測を比較したが，よりこの好ましくは新しい（推定に用いていない）データと突き合わせることである．\n\nLOO (Leave-One-Out) 交差検証 [@Stone1974] では，データを１つだけ抜いてモデルを推定し，このモデルの予測値と実際の値を比較するモデル検証法である．\n\n`brms` パッケージでは [`loo` パッケージ](https://mc-stan.org/loo/reference/loo-glossary.html) を内部で利用して高速に計算することができる．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloo(fit3)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nComputed from 10000 by 839 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo  -2220.7 26.7\np_loo         5.6  0.7\nlooic      4441.4 53.5\n------\nMCSE of elpd_loo is 0.0.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.4, 1.0]).\n\nAll Pareto k estimates are good (k < 0.7).\nSee help('pareto-k-diagnostic') for details.\n```\n\n\n:::\n:::\n\n\n\n回帰分析において予測値と実際の（省いていた）データの乖離は，AIC を踏襲して事後予測分布のスコア関数で測る [@Vehtari+2017 p.1414]．\n\nelpd (expected log predictive density) は，LOO 交差検証により得る，（省いていた）データの対数尤度の平均である：\n$$\n\\mathrm{elpd}_{\\text{loo}}:=\\sum_{i=1}^n\\log p(y_i|y_{-i})=\\sum_{i=1}^n\\int p(y_i|\\theta)p(\\theta|y_{-i})\\,d\\theta.\n$$ {#eq-def-elpd}\n\nこの値が大きいほどモデルの予測が良い．一般に elpd は，一度見たことあるデータ点に対する事後予測スコアよりも低くなる．^[訓練に用いたデータ点に関する事後予測スコアはdeviance と関係があり，$-2$ を乗じたものは deviance と同じスケールになる [@Gelman-Hill-Vehtari2020 p.174], [@Vehtari+2017 p.1427]．AIC は deviance から $2p$ を引いたものである [@Gelman-Hill-Vehtari2020 p.175]．] この際の差は `p_loo` が測っており，乖離が大きすぎるとモデルがデータに過適合していることを表す．\n\n`p_loo` は有効パラメータ数の（一致）推定量である．今回のモデルには切片項と `LAB`, `LDL`, `LAB:LDL` そして `sigma` の５つのパラメータがあるが，それより $0.6$ だけ大きい値が出ている．\n\n最後の列は情報量規準のスケールにしたものである：\n$$\n\\mathtt{looic}=-2\\times\\mathrm{elpd}_{\\text{loo}}.\n$$\n\n一般に LOO-CV は計算が大変であるが，`loo` パッケージは Pareto Smoothed Importance Sampling (PSIS) [@Vehtari+2015] を用いて高速に計算している．\n\n$k>0.7$ の場合はこれがうまくいっていないことを示唆する．この下で $\\mathtt{p_loo}>p$ はモデルの誤特定を示唆する．\n\n### 事後予測スコアによるモデル比較 {#sec-posterior-predictive-score}\n\n`brms` パッケージでは `loo_compare` 関数で２つのモデルの elpd スコアを比較できる：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloo_compare(loo(fit1), loo(fit2))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     elpd_diff se_diff\nfit2  0.0       0.0   \nfit1 -0.7       2.1   \n```\n\n\n:::\n:::\n\n\n\n`elpd_diff` の値は標準偏差と比べて大変に小さい．交差検証の観点からは，`LDL` の追加は BMI の予測の観点から全く違いがないことがわかる．\n\n### ベイズワークフロー\n\nこの elpd を基本としたモデルの比較は極めて強力である．\n\n線型モデルが適切な場合，適切な説明変数を新たに作ったり，不要な説明変数を除去して推定を安定化させることで，最適な予測力を持つ線型モデルが特定できる．\n\n[@Gelman-Hill-Vehtari2020 p.206] などの解析例も参照．\n\nその際に elpd は，事後予測分布のプロットを見るという視覚的な方法よりも定量的な指標として大活躍することになる．\n\nしかし時には線型性の仮定が不適切であるという仮説・結論に行き着く場合もある．\n\n## 非線型性への憧憬\n\n### はじめに\n\nLAB による BMI への回帰の残差には，左右の非対称性が見られる [-@sec-pp-check1]．\n\nそして更なる変数 LDL の追加は予測の観点では特に影響がないことがわかった [-@sec-posterior-predictive-score]．\n\nそこでここでは手軽に非線型性を取り入れる方法として，データを変換することを考える．\n\n第 [-@sec-standardization] 節でデータを標準化すると回帰モデルの係数の解釈が容易になることみた．\n\nしかしデータの線型変換は線型回帰モデルを変えず，推定には何の影響も与えない．\n\nそこでここでは非線型な変換に注目する．\n\n### 被説明変数の対数変換\n\n線型回帰モデリングにおける最大の仮定は，説明変数の加法性と，$y$ への効果の線型性である：\n$$\ny=\\beta_0+\\beta_1x_1+\\beta_2x_2+\\cdots.\n$$\n\nLAB や LDL の BMI への影響が線型であると見るのは相当横暴な仮定である．LAB と LDL が両方高いことが相乗的に BMI を高めるシナリオの方があり得そうである．\n\nBMI も LAB も LDL も正の値しか取らないこともあり，対数変換を考えることは良い第一歩だろう．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1_log <- update(model1, log(BMI) ~ LAB)\nfit1_log <- brm(\n  formula = model1_log,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nres <- residuals(fit1_log)\nplot(raw_df$LAB, res[,1], xlab=\"LAB\", ylab=\"Residuals (on log scale)\")\nabline(0,0)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-42-1.png){width=672}\n:::\n:::\n\n\n\n残差プロットを見ると，元のスケールでの線型回帰 @fig-fit1-res と比べて非対称性は軽減している．\n\n<!-- \n\n\n::: {.cell}\n\n```{.r .cell-code}\npp_check(fit1_log, ndraws = 100)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-43-1.png){width=672}\n:::\n:::\n\n\n-->\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(bayesplot)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrep <- posterior_predict(fit1_log, ndraws = 100)\np1_log <- ppc_dens_overlay(raw_df$BMI, exp(yrep))\ngrid.arrange(p1, p1_log, nrow=1)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-45-1.png){width=672}\n:::\n:::\n\n\n\n事後予測分布も改善しているのがわかる．\n\n### 変換前後のモデルの比較：Jacobian の補正\n\nただし，説明変数を対数スケールに変換してしまったので，直接 LOO スコアを比較することはできないことに注意する：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloo_fit1 <- loo(fit1)\nloo_fit1_log <- loo(fit1_log)\nloo_compare(loo_fit1, loo_fit1_log)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Not all models have the same y variable. ('yhash' attributes do not\nmatch)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         elpd_diff se_diff\nfit1_log     0.0       0.0\nfit1     -2656.8       8.2\n```\n\n\n:::\n:::\n\n\n\n実際，`fit1` の elpd が $-2211$ であるのに対し，`fit1_log` は $426$ とスケールが全く違う：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloo_fit1_log\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nComputed from 10000 by 839 log-likelihood matrix.\n\n         Estimate   SE\nelpd_loo    435.6 21.8\np_loo         3.0  0.3\nlooic      -871.3 43.6\n------\nMCSE of elpd_loo is 0.0.\nMCSE and ESS estimates assume MCMC draws (r_eff in [0.6, 1.1]).\n\nAll Pareto k estimates are good (k < 0.7).\nSee help('pareto-k-diagnostic') for details.\n```\n\n\n:::\n:::\n\n\n\nしかし elpd の定義 ([-@eq-def-elpd]) を見ると，$y_i$ の密度変換をするために，Jacobian の値を加えれば良いことがわかる．\n\nそれぞれの項は `loo(fit1_log)$pointwise[,1]` に格納されている：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum(loo_fit1_log$pointwise[,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 435.6273\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nloo_fit1_Jacobian <- loo_fit1_log\nloo_fit1_Jacobian$pointwise[,1] <- loo_fit1_log$pointwise[,1] - log(raw_df$BMI)\nsum(loo_fit1_Jacobian$pointwise[,1])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] -2189.131\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nloo_compare(loo_fit1_Jacobian, loo_fit1)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Not all models have the same y variable. ('yhash' attributes do not\nmatch)\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         elpd_diff se_diff\nfit1_log   0.0       0.0  \nfit1     -32.0       6.7  \n```\n\n\n:::\n:::\n\n\n\n::: {.callout-note title=\"背景\" icon=\"false\" collapse=\"true\"}\n\n$x$ を BMI，$y:=\\log x$ とする．`fit1_log` の elpd は\n$$\n\\log p(y)\n$$\nによって計算されているところを，変数変換\n$$\np(y)\\,dy=\\frac{p\\paren{\\log x}}{x}\\,dx\n$$\nを施すことで\n$$\n\\log p(y)\\mapsto\\log p(\\log x)-\\log x\n$$\nという関係を得る．\n\n左辺が `fit1_log` の elpd のスケールであり，右辺の $\\log p(\\log x)$ の部分が `fit1` の elpd のスケールである．$-\\log x$ の Jacobian に対応する部分を加える必要がある．\n\n:::\n\n被説明変数に対数変換を施すことで，モデルの予測性能が改善したことがわかる．\n\n### 説明変数の対数変換：log-log モデル\n\n同様に説明変数にも対数変換を施すことができる．\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmodel1_loglog <- update(model1_log, log(BMI) ~ log(LAB))\nfit1_loglog <- brm(\n  formula = model1_loglog,\n  data = raw_df,\n  chains = 4, iter = 5000, cores = 4\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nyrep <- posterior_predict(fit1_loglog, ndraws = 100)\np1_loglog <- ppc_dens_overlay(raw_df$BMI, exp(yrep))\ngrid.arrange(p1_log, p1_loglog, nrow=1)\n```\n\n::: {.cell-output-display}\n![](BayesRegression_files/figure-html/unnamed-chunk-52-1.png){width=672}\n:::\n:::\n\n\n\n予測性能はわずかに悪化していることがわかる：\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nloo_compare(loo(fit1_log), loo(fit1_loglog))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            elpd_diff se_diff\nfit1_log     0.0       0.0   \nfit1_loglog -1.8       1.1   \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmedian(loo_R2(fit1_log))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.02481491\n```\n\n\n:::\n\n```{.r .cell-code}\nmedian(loo_R2(fit1_loglog))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 0.02229489\n```\n\n\n:::\n:::\n\n\n\nしかし log-log モデルの係数は弾力性 (elasticity) としての解釈ができることもあり，解釈性の観点から選好されることがある [@Gelman-Hill-Vehtari2020 p.195]．\n\n### 離散変数化\n\n離散変数の扱いは連続変数よりも難しくなる．基本的に一般化線型モデルの枠組みが必要になる．\n\n::: {#lst-embedding}\n:::\n\nしかし連続変数間の関数関係が複雑だと思われる場合，ノンパラメトリック手法を求める前に，変数を離散化して解析することも得るものが大きい場合が多い．\n\nこのような設定は，離散変数を扱う積極的な理由になる．非線型性を扱うために設定を簡略化するのである．\n\n## おわりに\n\nBMI を LAB と LDL から予測する問題を，線型回帰モデルから始めた．\n\n交差項を追加することで，LDL が違う群に対して LAB がどう変わるかの層別の違いを見ることができる．\n\n事後予測分布によるモデルのチェックは残差プロットと同様に，極めて手軽かつ有力なモデル検証の方法である．\n\nこれにより関数関係の非線型性が疑われたため，被説明変数 BMI に対して対数変換を施して線型回帰をすると，予測性能の改善が見られた．\n\n事後予測分布のプロットだけでなく，その「よさ」の定量的な指標として交差検証による事後予測スコア elpd [@Vehtari+2017] があることを学んだ．\n\n::: {#lst-embedding2}\n:::\n\n## 文献紹介 {.appendix}\n\n[10 節 @Gelman-Hill-Vehtari2020] に線型重回帰モデルにおいて，係数の解釈法が丁寧に解説されている．\n\n[11 節 @Gelman-Hill-Vehtari2020] はモデルの検証法を扱っている．\n\n[@Gelman-Hill-Vehtari2020] では基本的に `rstanarm` パッケージを用いているが，本稿では `brms` パッケージを用いた．\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}