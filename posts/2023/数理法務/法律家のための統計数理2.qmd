---
title: "法律家のための統計数理（２）Bayes の定理"
subtitle: "教科書第１章第２―３節 (pp. 14-30)"
author: "Hirofumi Shiba"
date: "12/6/2023"
categories: [草野数理法務]
toc: true
toc-expand: true
number-sections: true
image: cover2.png
twitter-card: true
bibliography: ../../../mathematics.bib
csl: ../../../apa.csl
abstract-title: 概要
abstract: 教科書第1章第2-3節(pp.14-30)までの内容を自分たちで一から解いた．特に，第3節の内容で，Bayesの定理を自分たちの手だけで，公理のみから導出した．加えて，Bayes統計学と筆者の専門であるBayes計算の分野紹介をした．
crossref:
  sec-prefix: 節
  eq-prefix: 式
---

{{< include ../../../_preamble.qmd >}}

シリーズトップページは[こちら](../../../static/Sessions.qmd#sec-法律家のための統計数理)．

## 今回の内容

第一審の裁判において，事実認定が中心的な問題である．この際に起き得る誤謬を，ベイズの方法を用いてどう回避できるか？という例が３つ挙げられている．

### 主観確率の基本的な計算方法と捜査官の誤謬

::: {.callout-tip icon="false" title="問題1-1"}
殺人事件の加害者はAとBのどちらか？利用可能な情報は次のみ：被疑者のA, Bは同居しており，そのうちどちらかが加害者であることはわかっているものとする．

1. 台所に左利きの包丁があった．Aが左利きである確率はいくらか？ただし，人間が左利きである確率は1割とする．
2. Aは左利きであること，被害者の外傷の部位や凶器の形状から加害者も左利きであったことは確定的であるとする．Aに逮捕令状を出しても良いだろうか？ただし，利き手の情報を除けば，AかBかは完全に五分五分であるとする．なお，共犯はなく，どちらか一方の単独犯であることも確実であるとする．
:::

::: {.callout-caution icon="false" title="結論"}
1. AもBも左利きである可能性があるため，5割より少し大きい．
2. AもBも左利きである可能性があるため，9割強である．95%を一つの基準にするなら，逮捕令状は出すべきではない．
:::

この問題のポイントは「条件付き確率」への理解である．

::: {.callout-note icon="false" title="論証"}
1. 事象を
$$
A:=\Brace{\text{Aは左利きである}}
$$
$$
B:=\Brace{\text{Bは左利きである}}
$$
と定めると，
$$
\begin{align*}
    &\quad\;\P[A\cup B]\\
    &=\P[A]+\P[B]-\P[A\cap B]\\
    &=\frac{19}{100}
\end{align*}
$$
これより，[条件付き確率の定義](../数理法務/%E6%B3%95%E5%BE%8B%E5%AE%B6%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E7%B5%B1%E8%A8%88%E6%95%B0%E7%90%861.qmd#sec-conditional-probability)から
$$
\begin{align*}
    \P[A|A\cup B]&=\frac{\P[A]}{\P[A\cup B]}\\
    &=\frac{10}{19}\approx52.6\%
\end{align*}
$$
:::

今回の肝は，事象 $A,B,C$ を互いに独立に設定したために，各積事象 $A\cap B,B\cap C,C\cap A$ が悉く計算可能なものとして得られた，という点である．これを計算しておけば，欲しい値がこれらの言葉で得られているから，答えまで一本道で辿り着ける，という訳である．

::: {.callout-tip icon="false" title="Monty Hall問題"}
[モンティ・ホール問題](https://ja.wikipedia.org/wiki/%E3%83%A2%E3%83%B3%E3%83%86%E3%82%A3%E3%83%BB%E3%83%9B%E3%83%BC%E3%83%AB%E5%95%8F%E9%A1%8C) も条件付けを正しく行えない（「何が分母か」を分別せず，違う次元の話を混同する）ことによって起こるパラドックスの有名な例である．
:::

::: {.callout-caution icon="false" title="まとめ"}
「捜査官の誤謬」は「条件付け」を正しく行わないことにより起こる誤謬である．これを回避するには，独立な事象 $A,B$ を抽出し，これらの確率を計算し，最終的に求めたい確率が何かを正しく特定することが重要である．
:::

### ベイズの公式と検察官の誤謬 {#sec-Bayes-problem}

::: {.callout-tip icon="false" title="問題1-2"}
ドーピング検査の結果から，ある日本選手Iが金メダルを剥奪された．弁護人としては，どのような弁護の筋があるか？

1. 本ドーピング検査において，禁止薬物をを用いていない人に対して陽性の結果が出る（偽陽性）確率は1%で，逆の偽陰性も1%である．
2. 日本選手で，禁止薬物を用いている割合は0.1%とする．当該日本選手Iもこの割合に従うものとする（とりわけ禁止薬物を使っていそうな理由・いそうでない理由はないものとする）．
:::

各事象を
$$
A:=\Brace{\text{ I は薬物を使用していた}}
$$
$$
E:=\Brace{\text{ I に陽性反応が出た}}
$$
と設定する．今回は $A,E$ は独立ではないことに注意．例えば，後からわかることだが，
$$\P[A\cap E]\ne\P[A]\P[E]$$
である．ここで，条件付き確率の計算の問題に分け入ることになる．今回与えられている条件はそれぞれ，

$$
\begin{align*}
\text{1.}&\qquad\P[\ov{E}|A]=\frac{1}{100},\\
&\qquad\P[E|\ov{A}]=\frac{1}{100}\\
\text{2.}&\qquad\P[A]=\frac{1}{1000}
\end{align*}
$$

と表現できており，知りたい値は，今現在Iが本当に薬を使っていたという確率 $\P[A|E]$ である．

実は，**これは全く大きな値ではない！**これは，そもそも薬物を使っている人が少なく，健常な人の方が大多数であるために，検査で陽性が出たからといってそれが本当に薬物を使っている人から出た「真の陽性」である確率が極めて小さくなってしまうという普遍的な現象である．

::: {.callout-note icon="false" title="証明"}
求めたい量 $\P[A|E]$ は
$$
\begin{align*}
&\quad\;\P[A|E]\\
&=\frac{\P[A\cap E]}{\P[E]}\\
&\overset{\text{(2)}}{=}\frac{\P[E|A]\P[A]}{\P[E]}\\
&\overset{\text{(3)}}{=}\frac{\P[E|A]\P[A]}{\P[E|A]\P[A]+\P[E|\ov{A}]\P[\ov{A}]}
\end{align*}
$$ {#eq-Bayes-theorem}
と式変形できる．この右辺は，全て既知の値で表現できている．

なお，途中の式変形については，[条件付き確率の定義](../数理法務/%E6%B3%95%E5%BE%8B%E5%AE%B6%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E7%B5%B1%E8%A8%88%E6%95%B0%E7%90%861.qmd#sec-conditional-probability)から

$$
\P[A\cap E]=\P[E|A]\P[A]
$$ {#eq-conditional-probability}

と，[**全確率の法則**](https://en.wikipedia.org/wiki/Law_of_total_probability)

$$
\begin{align*}
&\quad\;\P[E|A]\P[A]+\P[E|\ov{A}]\P[\ov{A}]\\
&=\frac{\P[E\cap A]}{\P[A]}\P[A]\\
&\qquad\qquad+\frac{\P[E\cap\ov{A}]}{\P[\ov{A}]}\P[\ov{A}]\\
&=\P[E\cap A]+\P[E\cap\ov{A}]\\
&=\P[E]
\end{align*}
$$ {#eq-law-of-total-probability}
とを用いた．
:::
実際に計算してみると，
$$
\P[A|E]=\frac{99}{1098}\approx9.0\%.
$$
選手Iは実際は薬を使っていない可能性の方がよっぽど高いのである．

::: {.callout-tip icon="false" title="Base rate fallacy"}
この検察官の誤謬は，特に不良品検出の文脈では深刻なバイアスになり，英語では[基準確率の誤謬](https://en.wikipedia.org/wiki/Base_rate_fallacy)ともいう．^[[@Arias-Castro22-Principles] と [@Agresti12-CategoricalData 第2.1.3節 p.39], [@Smith2010 pp.22-23] も参照．]

$n$ 人の母集団に，ある病気の検査を行うとしよう．
$$\begin{cases}A_i:=\Brace{i\text{は有病}},\\B_i:=\Brace{i\text{は陽性}}.\end{cases}\quad i\in[n].$$
としたとき，

1. $\al:=P[B_i|A_i^\comp]$ を偽陽率・危険度という．検定一般に言う，**第一種の過誤率**である．
2. 患者が有病であるときに陽性が出る確率 $1-\al$ の値を **感度(sensiticity)**という．
3. $\beta:=P[B_i^\comp|A_i]$ を偽陰率という．検定一般に言う，**第二種の過誤率**である．
4. 患者が無病であるときに陰性が出る確率 $1-\beta$ の値を**特異度(specificity)**という．^[[@Yerushalmy47-Specificity] ] 検定一般に言う**検出力(power)**である．

統計的検定では第一種の過誤率を重く見て，これを制限した上での第二種の過誤率の低さを指標とする．このために「検出力」が重要．一方で失病検査の際は第一種の過誤率が大変重要であり，これに「感度」という名前がついている．

このような一般的な設定の下で，陽性の結果を見て，患者の有病率を $1-\beta$ だと結論づけてしまう誤謬を基準確率の誤謬という．
:::

## ベイズ統計学

### ベイズの公式 {#sec-Bayes-formula}

@sec-Bayes-problem で使った式変形 @eq-Bayes-theorem の最左辺と最右辺のみに注目して公式化すると，次のようになる：
![ベイズの公式](cover2.png)

これを**（分割 $\Om=A\sqcup\ov{A}$ に関する）Bayesの公式**という．

これは[独立性の特徴付け](../数理法務/%E6%B3%95%E5%BE%8B%E5%AE%B6%E3%81%AE%E3%81%9F%E3%82%81%E3%81%AE%E7%B5%B1%E8%A8%88%E6%95%B0%E7%90%861.qmd#sec-independent)
$$
\P[A|E]=\P[A],\quad\P[E|A]=\P[E]
$$
の一般化になっているともみれる．

### ベイズ統計学

事前に確率 $\P[A]$ を想定しておく．そして，$A$ に関連する観測の結果 $\P[E|A]$ を見てから，ベイズの公式を通じて $\P[A|E]$ を計算し，事象 $A$ に関する理解を深める営みが，ベイズ統計学の雛形である．

この $\P[A]$ を**事前確率**，$\P[A|E]$ を**事後確率**という．

1. 事象 $A$ として何を選んでも良い．
2. 事前情報 $\P[A]$ を推論に取り込む余地がある．
3. $A$ と $E$ に対して多様な関係を想定できる．
4. $\P[A|E]$ は一般にグラフの形で与えられるので，（他の統計手法と比べて）情報量が多い．
5. ベイズの公式が全てであり，何をやっているかがわかりやすい．

点がよくベイズ統計学の美点として挙げられる．

### ベイズ計算

前節で解説した通り，ベイズ統計学はベイズの公式が全てであり，原理的には極めて明快である．では，何が難しいかというと，一般的な形のベイズの公式
$$
p(\theta|x)=\frac{p(x|\theta)p(\theta)}{\int_\Theta p(x|\theta)p(\theta)\,d\theta}
$$
は，**最も単純な場合でも，計算が不可能である**という点である．積分は現代では高校で習う数学の範囲であるが，実際に計算できる積分など応用の現場では都合よく出てこないのである．

従って，ベイズ統計学の研究において，計算手法の研究が極めて重要な位置を占める．この分野を**ベイズ計算**というのである．詳しくは [ベイズ計算とは何か](../Surveys/BayesianComp.qmd) の記事を参照してほしい．