---
title: "条件付き期待値の測度論的基礎付け"
author: "Hirofumi Shiba"
date: "12/2/2023"
categories: [Probability, Math Notes]
toc: true
number-sections: true
twitter-card: 
    image: 3-Takeshi-Saito.jpg
bibliography: ../../mathematics.bib
csl: ../../apa.csl
---

## 条件付き期待値の定義

条件付き期待値を，測度論から厳密に定義する際，ポイントは次の３点である．

{{< include ../../_preamble.qmd >}}

1. 条件付き期待値は $\sigma$-代数 $\cG$ に対して $\E[X|\cG]$ の形で（$\Om$ 上殆ど至る所）定義される確率変数である．
2. $\E[X|Y]$ というのは，$\E[X|\sigma(Y)]$ の略記である．
3. $\E[X|Y=y]$ というのは，$\E[X|\sigma(Y)](Y^{-1}(y))$ のことである．

### 測度論による定義

::: {.callout-tip icon="false"}
## 定義（条件付き期待値）
$(\Om,\F,\P)$ を確率空間とし，$\cG$ を $\F$ の部分 $\sigma$-代数とする．可積分確率変数 $X\in\L^1(\Om)$ について，
次の2条件を満たす，$\P$-零集合を除いて一意な確率変数を**条件付き期待値**といい，$\E[X|\cG]$ で表す．

1. $\cG$-可測でもある $\P$-可積分確率変数である．
2. 任意の $\cG$-可測集合 $B\in\cG$ 上では $X$ と期待値が同じ確率変数になる：$$\E[X1_B]=\E[\E[X|\cG]1_B]$$
:::

::: {.callout-note icon="false"}
## 証明

定義の2条件のみから，$\E[X|\cG]$ が $\P$-零集合を除いて一意に定まること（とその存在）を示す．

$$Q(B):=E[X,B]=E[1_BX]\;(B\in\cG)$$
とおくことで，$Q$ は可測空間 $(\Om,\cG)$ 上の確率測度を定める．
いま，$\P|_\cG$ に関して $Q$ は絶対連続になっている：$$\forall_{B\in\cG}\;P(B)=0\Rightarrow Q(B)=0.$$
これより，[Radon-Nikodymの定理](https://ja.wikipedia.org/wiki/%E3%83%A9%E3%83%89%E3%83%B3%EF%BC%9D%E3%83%8B%E3%82%B3%E3%83%87%E3%82%A3%E3%83%A0%E3%81%AE%E5%AE%9A%E7%90%86)から，
ある $\cG$-可測で $\P$-可積分な可測関数 $Y:\Om\to\R$ が，$\P$-零集合上での違いを除いて一意的に存在して，$$\forall_{B\in\cG}\;Q(B)=\int_BY(\om)P(d\om)$$
が成り立つ．
よって，条件付き期待値 $Y$ は確かに存在して（同値類 $L^1(\P)$ の元としては）一意的で，(1),(2)が成り立つ．
:::

[@Dudley02-RealAnalysisAndProbability 10.1節 p.336], [@吉田朋広-数理統計 p.43] がおすすめな参照先．[@舟木-確率論 p.88] が入門しやすい．$X\in L^2(\Om)$ でいい場合は，より「射影」としてわかりやすい特徴付けがある．これのおすすめは [@Jacod-Protter2004 第23節 p.200], [@Kallenberg p.164]．

### 確率変数に関する条件付け

::: {.callout-tip icon="false"}
## 定義（確率変数を与えた下での条件付き期待値）
$S$ を位相空間とする．確率変数 $X\in\L(\Om;S)$ による $Y\in\L^1(\Om)$ の条件付き期待値は，次を満たす可測関数 $E[Y|X=-]:S\to\R$ とする：
$$\forall_{B\in\B(S)}\quad\int_{X^{-1}(B)}Y(\om)P(d\om)=\int_BE[Y|X=x]P^X(dx).$$
:::

$(E,\cE)$ を可測空間とし，確率変数 $X:\Om\to E$ を与えた下での条件付き期待値 $\E[Y|X]$ を，$X$ が $\Om$ 上に引き戻す $\sigma$-代数
$$
\sigma(X):=\Brace{A\subset\Om\mid\exists_{B\in\cE}\; X^{-1}(B)=A}
$$
を与えた下での条件付き期待値 $\E[Y|\sigma(X)]$ と定める．^[[@Dudley02-RealAnalysisAndProbability p.340] など．] すると $\E[Y|X]$ は $\sigma[X]$-可測であるが，可測性の特徴付け（後述）から，これはあるBorel可測関数 $f$ について，$E[Y|X]=f(X)$ と表せる．つまり，$X$ の値域上の関数 $E[Y|X=x]=f(x)\;\P^X\das$ と扱えるはずである．この $f$ が条件付き期待値である．^[[@Kallenberg p.167]．]

::: {.callout-tip icon="false"}
## 命題（Doobの汎函数表現）
$S$ を位相空間，$X\in \L(\Om;S),Y\in \L(\Om)$ を確率変数とする．次は同値：

1. $Y$は $\sigma(X)$-可測．
2. あるBorel可測関数 $f:S\to\R$ が存在して，$Y=f(X)$ を満たす．
:::

::: {.callout-note icon="false"}
## 証明
2 $\Rightarrow$ 1 はすぐに従う．任意の $B\in\B(\R)$ について，$f^{-1}(B)\in\B(S)$ であるから，
$$Y^{-1}(B)=X^{-1}(f^{-1}(B))\in\sigma(X).$$
あとは 1 $\Rightarrow$ 2 を示せば良い．3段階で示す．

1. まず $Y$ が単関数
$$Y=\sum_{i=1}^nc_i1_{A_i},\qquad c_i\ne c_j\;(i\ne j).$$
の場合について示す．仮定より $A_i\in\sigma(X)$ であるから，ある $B_i\in\B(S)$ が存在して $A_i=X^{-1}(B_i)$．よって，
$$f(x):=\sum_{i=1}^nc_i1_{B_i}(x).$$
と定めると $Y=f(X)$．
2. 次に $Y\ge0\;\as$ の場合を考えると，正な単関数の単調増加列 $\{Y_n\}$ で $Y$ に収束するものが取れる．各 $Y_n$ について，$f_n\in\L(S)$ が存在して $Y_n=f_n(X)$ が成り立つ．このとき，$f:=\limsup_{n\to\infty}f_n$ と定めれば，
$$Y=\limsup_{n\to\infty}Y_n=(\limsup_{n\to\infty}f_n)(X)=f(X).$$
3. 一般の場合は $Y=Y^+-Y^-$ の分解から従う．
:::

[@Dudley02-RealAnalysisAndProbability 定理4.2.8 p.128] は $S=\R$ の場合，[@Landkov72-Probability] は $S=\R^m$ の場合, [@Kallenberg 補題1.14 p.18] に一般の標準Borel空間の場合の証明がある．

## 各論

### 練習

::: {.callout-tip icon="false"}
## 問題
確率変数 $X,Y$ とその値域の値 $y\in\mathcal{Y}$ について，
$$
\E[X|Y=y]\P[Y=y]=\E[X1_{\Brace{Y=y}}]
$$
はどう正当化されるか？
:::

::: {.callout-note icon="false"}
## 説明

$\E[X1_{\Brace{Y=y}}]$ の中身を $\sigma(Y)$ で条件付けてTower propertyを使うと（定義の条件2からと論じても良い），$1_{\Brace{Y=y}}$ は $\sigma(Y)$-可測だから，条件付き期待値の中身から出る．これによって正当化できる．式で表すと，
$$
\begin{align*}
\E[X1_{\Brace{Y=y}}]&=\E[\E[X1_{\Brace{Y=y}}|Y]]\\
&=\E[1_{\Brace{Y=y}}\E[X|Y]]\\
&=\int_{\mathcal{Y}}\delta_y(y')\E[X|Y=y']\P(dy')\\
&=\E[X|Y=y]\P[Y=y].
\end{align*}
$$
ただし，$\mathcal{Y}$ 上の確率測度を $\P$ と置いた．
:::