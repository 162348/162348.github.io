---
title: "サンプリングとは何か"
subtitle: "生成＝サンプリング＝シミュレーション＝ Monte Carlo 法が人類にもたらしたもの"
author: "司馬博文"
date: 7/26/2024
date-modified: 7/28/2024
# image: Files/feynman.jpg
categories: [Computation, Sampling, Opinion]
bibliography: 
    - ../../../mathematics.bib
    - ../../../bib.bib
csl: ../../../apalike.csl
abstract-title: 概要
abstract: |
    数値実験と LLM とはいずれもシミュレーションに使えるが，用いる形式が違う（数字と文字）．これにより，物理的な用途と社会的な用途とに別れている．この形式の違いを超克するのが機械学習の悲願であるとするならば，計算とはなんだろうか？ Monte Carlo 法とはシミュレーションと計算を架橋する存在であるならば，今後どのような貢献ができるのであろうか？
---

## サンプリングとは何か？

以下に述べるように，「生成」「シミュレーション」は全て「サンプリング」の類義語とみなすこともできる．

### 「生成」としてのサンプリング {#sec-sampling-as-synthesis}

[GAN](../Kernels/Deep3.qmd)，[VAE](../Kernels/Deep4.qmd)，[正規化流](NF.qmd)，[拡散模型](Diffusion.qmd) などは，いずれも潜在変数モデルを学習していることに等しい．

![Missing Data Model / Latent State Model / Completed Model for $X$](../Computation/incomplete.png)

数学的には $Z\to X$ とは確率核であり，[Markov 圏](../../2023/Probability/MarkovCategory.qmd) における射とも見れる．

#### 階層モデルに内包される概念の総体について

欠測データモデル，潜在変数モデルは全て階層モデルの特別な場合とみなすことができる（[Concept with an attitude](https://ncatlab.org/nlab/show/concept+with+an+attitude)）．そこで本稿では全て「階層モデル」と呼んでしまうこととする．

階層モデルには，これがひとたび推定されたのちは，そのモデルからデータをサンプリングすることが出来るという特徴がある．^[圏論的には，射の列を終対象から辿ることにあたる：$\{*\}\to Z\to X$．]

#### ベイズデータ解析

ベイズ統計学の文脈では，こうして得たデータをモデルの正確さの検証に用いることが出来る点が，生成モデルの美点としてみなされている．^[特に Richard McElreath の統計観に強く現れている．]

これはベイズ統計学では，階層モデルは物理的過程や社会的過程や因果など，何らかの現実を抽象化したものとみなされるためである．

![[from McElreath's Statistical Rethinking 2023 Lecture](https://youtu.be/R1vcdhPBlXA?si=zyjrzNi4greRUCIg)](Files/McElreath.PNG)

#### 生成モデリング

一方で生成モデルの文脈では，純粋に「データ分布からの複製」を目標とするため，階層モデルはモデリングの道具ではなく，ひとえに正確なデータ分布を学習するための装置とみなされる．

このように，[統計と機械学習とでは階層モデルに対する態度と姿勢が違うのみで，生成モデルとベイズモデリングは数理的には同じ営為であると言える]{.underline}．

このことは表現学習の初期から意識されていたことであり [@Yuille-Kersten2006]，実際データの背後にある因果構造を正しく特定できている形の階層モデルを推定した際は，その階層的な構造がデータの背後にある因果的な変動要因をうまく分解して陽の下に晒してくれるはずである [@Chen+2017]．

|| ベイズ統計 | 生成モデル |
|:---:|:----------:|:----------:|
| 目標 | 正しいモデルを得る | 高精度の生成をする |
| 生成 | おまけ | 主目的 |
| 価値観 | 不偏性は嬉しい | 精度が重要 |
| 推定法 | MCMC などの Monte Carlo 法 | 変分推論などの最適化 |

: 階層モデルの使い方の違い {.striped .hover .responsive-sm tbl-colwidths="[5,20,20]"}

### 「シミュレーション」としてのサンプリング

#### 「観測」：シミュレーション前夜

現代の科学技術のミトコンドリア・イブは Newton 力学だとする言説に，異論は少ないだろう．

Newton 力学から始まる全ての物理学における理論は，観測データを説明するために作られた．

統計モデルのように尤度を最適化するわけではないが，最もデータをよく説明する模型のみが残ってきたのは物理学も同じである．

Newton 力学の大きなモチベーションに Kepler の三法則の説明があり，この法則は [Tycho Brahe](https://ja.wikipedia.org/wiki/ティコ・ブラーエ) の観測から見出されたものである．

> ティコ・ブラーエは彼のためにオラネンブルグに建てられたよく整備された「天文台」の中で，同じ一様な製図の上に惑星の位置を書き記すだけでなく，前もって印刷した同じ星図の上に惑星の位置を書き記すだけでなく，前もって印刷した同じ星図をヨーロッパ中の天文学者に送ってそこへ書き記すように求めて，彼らからの観測結果をも集めた．
> **彼（ティコ・ブラーエのこと）の精神が突然に変化を遂げたのでは無い．彼の目が突然に古い偏見から自由になるのでは無い．以前の誰よりも夏の空を注意深く観測している訳でも無い．彼は，夏の空＋自分の観測＋同僚の観測＋コペルニクスの書物＋プトレマイオスの『アルマゲスト』の多くの版とを一望のもとに見て考えた最初の人物である**．長いネットワークの始点と終点に座り，不変で結合可能な可動物を私が呼ぶものを生み出した最初の人物である．[@ラトゥール1999]

#### 「実験」：最初のシミュレーション {#sec-physical-simulation}

まもなくして実験が物理学を駆動する方法論となり，長い間物理学においては，実験と理論の２者が相補的な関係にあった．

> If it disagrees with experiment, it’s wrong. In that simple statement, is the key to science. [@Feynman1964]

だが，多くの物理理論は，特定の「この数値を測定すれば良い」というようなところまで提供し，実験はこれを確認する役割を果たすことが多かった．

このようなスキームでは，実験から集中される観察データ自体が複雑な構造を持つということは稀だったと言えるだろう．

#### 「数値実験」：ラボからコンピュータへ

しかし，統計力学の扱う対象などは，例えば Ising 模型など，環境を整えて実験的に再現するということは難しい．その結果，計算機内でのシミュレーションが実験の代わりを果たすようになっている．３次元の Ising 模型の臨界指数の conformal bootstrap による計算 [@El-Showk+2012] などはその良い例である．

> The computer becomes the virtual laboratory in which a system is studied - a numerical experiment. [@Rapaport2004 p.3]

また，天体観測の時代とは違い，データ自体が複雑な構造を持つ一つの宇宙のような様相を呈しているのが計算機時代である．例えば，高次元における測度の集中の現象 [@ConvexityAndConcentration2017] が発見されたように，高次元データにおける多様体仮説も広く観察されている [@本武陽一2017]．

現代では，そのようなデータを料理すること自体が一つの重要な実験技法と言えるかもしれない．

#### 社会「科学」

「数値実験」「シミュレーション」という新たな「実験」技術が，真の意味で社会科学を科学たらしめるかもしれない．

> Social science is an example of a science which is not a science.<br>[Feynman on the social sciences](https://youtu.be/zkFPCTwPlkU?si=uA2tM0e18lfip_gI)

結局，このような「社会科学は科学か？」という論争も，自然科学の理論の実験による検証よりも，社会科学の理論の実験による検証の方が，はるかに実験技術の発達を必要とした，というだけに過ぎないかもしれない．

#### 意味論的シミュレーション

大規模言語モデル（LLM）は，物理学的なシミュレーションと相補的な世界モデルを提供しつつある．産業界では，初めて言語を生成できるモデルとして，会話やディスカッションのシミュレーションツールとしても使われている．

加えて，計算科学の意味での数値実験によるシミュレーションだけでなく，生成モデルを汎用物理シミュレーターとして用いる考え方が，Sora [@Brooks+2024] の出現以降広まった．

実際，動画の生成・自動運転のシミュレーション・自律的エージェントのシミュレーションなどは，物理法則のシミュレーションとタスクとして一致するところが多い [@Zhu+2024]．

## サンプリングと最適化の双対性

「生成」「シミュレーション」などの「隠れたサンプリング」が多いのと同様，隠れた最適化も多い．ほとんどの物理法則は変分法的解釈を持つ．

### サンプリングによる最適化

統計力学的な系は自由エネルギー最小化原理に従って基底状態に緩和する．

このことにより，最適化にサンプリングが利用できる．模擬アニーリング [@Kirkpartick+1983] などはその例と言えよう．

### 最適化によるサンプリング

生成モデルは，その生成の精度が重視されるために，多くの場合は最適化によってベイズ推論問題が解かれる．



## あとがき {.appendix}

本稿は，下掲の稿からの思索の発展を記したものである：

```{=html}
<div class="article-card-container">
    <div class="article-card">
        <a href="https://162348.github.io/posts/2024/Computation/AboutSimulation.html" target="_blank">
            <img src="https://162348.github.io/posts/2024/Computation/Files/feynman.jpg" alt="Article Image" class="article-image">
            <div class="article-content">
                <h3 class="article-title">計算とは何か</h3>
                <p class="article-description">計算とサンプリングのはざまにある Monte Carlo 法</p>
            </div>
        </a>
    </div>
</div>
```