---
title: "大規模な不均衡データに対するロジスティック回帰"
subtitle: "離散時間 MCMC から連続時間 MCMC へ"
author: "司馬 博文"
date: 7/12/2024
date-modified: 7/12/2024
categories: [Bayesian, Computation, Python, MCMC]
bibliography: 
    - ../../../mathematics.bib
    - ../../../bib.bib
csl: ../../../apalike.csl
abstract-title: 概要
abstract: ロジットモデルやプロビットモデルの事後分布からのサンプリングには，その混合構造を利用したデータ拡張による Gibbs サンプラーが考案されている．しかし，このような Gibbs サンプラーは不明な理由で極めて収束が遅くなることがよく見られ，そのうちの１つのパターンが **大規模な不均衡データ** である．この記事では，この現象がなぜ起こるかに関する考察と，代替手法として Zig-Zag サンプラーがうまくいくことをみる．
code-fold: false
execute:
    cache: true
---

{{< include ../../../_preamble.qmd >}}

## ロジスティック回帰

### ロジットモデルのベイズ推定

応答変数 $Y\in\L(\Om;2)$ は，説明変数 $X\in\L(\Om;\R^p)$ の関数であるとして，係数 $\xi\in\L(\Om;\R^p)$ をロジスティック回帰モデル
$$
\P[Y=1\mi X,\xi]=g^{-1}(X^\top\xi)=\frac{\exp(X^\top\xi)}{1+\exp(X^\top\xi)}
$$ {#eq-the-model}
を通じて定める．ただし，
$$
g(x):=\log\frac{x}{1-x}
$$
は [**ロジット関数**](https://ja.wikipedia.org/wiki/ロジット)，$g^{-1}$ は **ロジスティック関数** という．^[$x$ が確率を表すとき $\frac{x}{1-x}$ という量はオッズともいい，それゆえ $p$ のロジットは対数オッズ比ともいう．]

このパラメータ $\xi$ をベイス推定することを考える．即ち，データ $\{(y^i,x^i)\}_{i=1}^n\subset2\times\R^p$ と事前分布 $p_0(\xi)d\xi\in\cP(\R^p)$ を通じて，事後分布
$$
\pi(\xi)\propt p_0(\xi)\prod_{i=1}^n\frac{\exp(y^i(x^i)^\top\xi)}{1+\exp((x^i)^\top\xi)}=e^{-U(\xi)}
$$
を計算することを考える．ただし，
$$
U(\xi):=-\log p_0(\xi)-\sum_{i=1}^n\log\paren{\frac{\exp(y^i(x^i)^\top\xi)}{1+\exp((x^i)^\top\xi)}}
$$
と定めた．

### ロジットモデルの事後分布サンプラー

ロジットリンクによる変換が複雑であるため，ロジスティック回帰は（完全な）ベイズ推定を実行することが難しいモデルとして知られてきた．

一方で，リンク関数 $g$ を標準正規分布 $\rN(0,1)$ の分布関数の逆関数に取り替えた [プロビットモデル](https://ja.wikipedia.org/wiki/プロビット) は，Gaussian data augmentation [@Albert-Chib1993] と呼ばれるデータ拡張に基づく Gibbs サンプラーが早くから提案されており，これにより効率的なベイズ推論が可能となっていた．

プロビットモデルはロジットモデルに似ており，実用上はただ裾の重さが違うのみであると言って良い [@BDA p.407]．そのこともあり，プロビットモデルのベイズ推論は計量経済学や政治科学で広く使われている手法となったが，ロジットモデルのベイズ推論の応用は遅れた [@Polson+2013]．

しかし実は，ロジットモデルの事後分布 $\pi$ も正規分布の Pólya-Gamma 混合として表すことができ，データ拡張によって効率的な Gibbs サンプラーを構成することができる [@Polson+2013]．現在ではこのデータ拡張 Gibbs サンプラーが，標準的な事後分布サンプラーとなっている．

### Gibbs サンプラーの課題：不均衡データ

データもモデルも大規模になっていく現代では，このようなデータ拡張に基づく Gibbs サンプラーは，特定の条件が揃うと極めて収束が遅くなる場面が少なくないことが明らかになってきている．

そのうちの１つのパターンが大規模な **不均衡データ** [@Johndrow+2019]，すなわち，特定のラベルが極めて稀少なカテゴリカルデータである．このようなデータに対しては，プロビットモデルやロジットモデルに限らず，ほとんど全てのデータ拡張に基づく Gibbs サンプラーが低速化することが報告されている：

> We have found that this behavior occurs routinely, essentially regardless of the type and complexity of the statistical model, if the data are large and imbalanced. [@Johndrow+2019 p.1395]

### 実験：不均衡データでの性能比較

ここでは問題を簡単にし，カテゴリーが２つの場合，即ち２値のスパースデータ $y^i\in2=\{0,1\}$ の場合を考える．

この下で，
$$
\sum_{i=1}^n y^i\,\bigg|\,n\sim\Bin(n,g^{-1}(\theta)),\qquad\theta\sim\rN(0,B),
$$
すなわち，モデル ([-@eq-the-model]) において
$$
p=1,\qquad X=1,\qquad p_0(\xi)d\xi=\rN(a,B),
$$
とした，切片項のみでの回帰分析の場合を考える．

ここでは $(a,B)=(0,100)$ として実験するが，[@Johndrow+2019] では，
$$
\sum_{i=1}^ny^i\ll n
$$
である大規模不均衡データである限り，$(a,B)$ の値に依らず同様の結果が得られることが報告されている．

