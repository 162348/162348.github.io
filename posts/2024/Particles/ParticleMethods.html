<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="司馬 博文">

<title>粒子法の概観 – Hirofumi Shiba</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../assets/profile.jpg" rel="icon" type="image/jpeg">
<script src="../../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-65186549de95cd2ff331b98fa30c8ceb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-e61c4b84c5b1b44357aa153aaddca306.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "?",
    "H"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-lst-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-title','listing-image','listing-date','listing-subtitle',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-title","listing-author","listing-date","listing-image","listing-description"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-lst-listing'] = new List('listing-lst-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-36GX2G6GLL"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-36GX2G6GLL', { 'anonymize_ip': true});
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&amp;display=swap" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=BIZ+UDPGothic&amp;display=swap" rel="stylesheet">

<style>
  .navbar-title, .menu-text, .dropdown-item {
      font-family: "Zen Kurenaido", sans-serif !important;
      font-weight: 400;
      font-style: normal;
  }
  h1, .title, .description, .subtitle {
    font-family: "Zen Kurenaido", sans-serif !important;
  }
</style>

<!-- <style>
  .menu-text {
      font-family: "Gill Sans", sans-serif !important;
      font-weight: 400;
      font-style: normal;
  }
  .navbar-title {
      font-family: "Gill Sans", sans-serif !important;
      font-weight: 400;
      font-style: normal;
  }
</style> -->

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../assets/styles.css">
<meta property="og:title" content="粒子法の概観 – Hirofumi Shiba">
<meta property="og:description" content="粒子法とは空間や分布を多数の粒子の集合として離散化して表現・計算する技術の総称である．シミュレーションからデータ同化まで幅広い応用を持つ．この記事ではこれらの技術を「粒子」という軸でひとつの記事にまとめることを試みる．">
<meta property="og:image" content="https://162348.github.io/posts/2024/Particles/Files/lorenz96_animation.gif">
<meta property="og:site_name" content="Hirofumi Shiba">
<meta name="twitter:title" content="粒子法の概観 – Hirofumi Shiba">
<meta name="twitter:description" content="粒子法とは空間や分布を多数の粒子の集合として離散化して表現・計算する技術の総称である．シミュレーションからデータ同化まで幅広い応用を持つ．この記事ではこれらの技術を「粒子」という軸でひとつの記事にまとめることを試みる．">
<meta name="twitter:image" content="https://162348.github.io/posts/2024/Particles/Files/lorenz96_animation.gif">
<meta name="twitter:creator" content="@ano2math5">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Hirofumi Shiba</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-notes" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Notes</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-notes">    
        <li>
    <a class="dropdown-item" href="../../../static/English.html">
 <span class="dropdown-text">English Notes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../blog.html">
 <span class="dropdown-text">ノート (Japanese)</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../../static/Materials.html"> 
<span class="menu-text">Materials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../static/Slides.html"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../static/Software.html"> 
<span class="menu-text">Software</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../static/about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/162348/162348.github.io/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">粒子法の概観</h1>
            <p class="subtitle lead">分子動力学法から SMC サンプラーまで</p>
                                <div class="quarto-categories">
                <div class="quarto-category">Particles</div>
                <div class="quarto-category">Survey</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>司馬 博文 </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">4/07/2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">10/08/2024</p>
      </div>
    </div>
      
    </div>
    
  <div>
    <div class="abstract">
      <div class="block-title">概要</div>
      <p>粒子法とは空間や分布を多数の粒子の集合として離散化して表現・計算する技術の総称である．シミュレーションからデータ同化まで幅広い応用を持つ．この記事ではこれらの技術を「粒子」という軸でひとつの記事にまとめることを試みる．</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">目次</h2>
   
  <ul>
  <li><a href="#シミュレーションのための粒子法" id="toc-シミュレーションのための粒子法" class="nav-link active" data-scroll-target="#シミュレーションのための粒子法"><span class="header-section-number">1</span> シミュレーションのための粒子法</a>
  <ul class="collapse">
  <li><a href="#はじめに" id="toc-はじめに" class="nav-link" data-scroll-target="#はじめに"><span class="header-section-number">1.1</span> はじめに</a></li>
  <li><a href="#分子動力学法" id="toc-分子動力学法" class="nav-link" data-scroll-target="#分子動力学法"><span class="header-section-number">1.2</span> 分子動力学法</a></li>
  <li><a href="#モンテカルロ法" id="toc-モンテカルロ法" class="nav-link" data-scroll-target="#モンテカルロ法"><span class="header-section-number">1.3</span> モンテカルロ法</a></li>
  <li><a href="#推論のための粒子法との関係" id="toc-推論のための粒子法との関係" class="nav-link" data-scroll-target="#推論のための粒子法との関係"><span class="header-section-number">1.4</span> 推論のための粒子法との関係</a></li>
  </ul></li>
  <li><a href="#推論のための粒子法" id="toc-推論のための粒子法" class="nav-link" data-scroll-target="#推論のための粒子法"><span class="header-section-number">2</span> 推論のための粒子法</a>
  <ul class="collapse">
  <li><a href="#ベイズ逆問題" id="toc-ベイズ逆問題" class="nav-link" data-scroll-target="#ベイズ逆問題"><span class="header-section-number">2.1</span> ベイズ逆問題</a></li>
  <li><a href="#データ同化" id="toc-データ同化" class="nav-link" data-scroll-target="#データ同化"><span class="header-section-number">2.2</span> データ同化</a></li>
  <li><a href="#enkf" id="toc-enkf" class="nav-link" data-scroll-target="#enkf"><span class="header-section-number">2.3</span> EnKF</a></li>
  <li><a href="#変分法" id="toc-変分法" class="nav-link" data-scroll-target="#変分法"><span class="header-section-number">2.4</span> 変分法</a></li>
  <li><a href="#粒子フィルターの位置付け" id="toc-粒子フィルターの位置付け" class="nav-link" data-scroll-target="#粒子フィルターの位置付け"><span class="header-section-number">2.5</span> 粒子フィルターの位置付け</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="シミュレーションのための粒子法" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="シミュレーションのための粒子法"><span class="header-section-number">1</span> シミュレーションのための粒子法</h2>
<section id="はじめに" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="はじめに"><span class="header-section-number">1.1</span> はじめに</h3>
<p>多くの物質は元々離散的であり，その最小単位は原子や分子である．</p>
<p>これをコンピュータ内に粒子として表現し，その現実世界での動きを模倣することを目指すシミュレーション法は <a href="https://ja.wikipedia.org/wiki/分子動力学法">分子動力学法</a> (MD: molecular dynamics) と呼ばれる．</p>
<p>アイデアは大変シンプルである．</p>
<div class="callout callout-style-default callout-caution no-icon callout-titled" title="原子論についての Feynman の名言">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
原子論についての Feynman の名言
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Feynman の講義録（のちに教科書になる）では，最も重要な科学知識の一つとして原子論を挙げている：</p>
<blockquote class="blockquote">
<p>If, in some cataclysm, all of scientific knowledge were to be destroyed, and only one sentence passed on to the next generations of creatures, what statement would contain the most information in the fewest words? I believe it is the <em>atomic hypothesis</em> (or the atomic fact, or whatever you wish to call it) that <em>all things are made of atoms—little particles that move around in perpetual motion, attracting each other when they are a little distance apart, but repelling upon being squeezed into one another</em>. In that one sentence, you will see, there is an enormous amount of information about the world, if just a little imagination and thinking are applied. <span class="citation" data-cites="Fenyman+1963">(<a href="#ref-Fenyman+1963" role="doc-biblioref">Feynman et al., 1964</a>)</span></p>
</blockquote>
</div>
</div>
</div>
</section>
<section id="分子動力学法" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="分子動力学法"><span class="header-section-number">1.2</span> 分子動力学法</h3>
<p><a href="https://ja.wikipedia.org/wiki/分子動力学法">分子動力学法</a> の文脈で <strong>粒子法</strong> (particle methods) と言ったとき，</p>
<ul>
<li>古典的な質点には Newton 力学</li>
<li>剛体で体積を持つ場合は Euler 方程式</li>
<li>内部構造を持つ場合は Langrange 方程式</li>
<li>さらに一般の場合は Hamilton 方程式</li>
</ul>
<p>に基づいて粒子の動きをシミュレーションすることを指す．</p>
</section>
<section id="モンテカルロ法" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="モンテカルロ法"><span class="header-section-number">1.3</span> モンテカルロ法</h3>
<p>分子動力学法は Monte Carlo 法と組み合わせて使われることが多い．</p>
<p>粒子の動きを上述の方程式に基づいて提案し，離散化誤差を Metropolis 法によって補正することで，系の物理量の分布を求めたり，平均値を求めたりする <span class="citation" data-cites="Rapaport2004">(<a href="#ref-Rapaport2004" role="doc-biblioref">Rapaport, 2004, p. 4</a>)</span>, <span class="citation" data-cites="Griebel+2007">(<a href="#ref-Griebel+2007" role="doc-biblioref">Griebel et al., 2007, p. 17</a>)</span>．</p>
<p>そもそも MCMC の手法 <span class="citation" data-cites="Metropolis+1953">(<a href="#ref-Metropolis+1953" role="doc-biblioref">Metropolis et al., 1953</a>)</span> 自体も，Schrödinger 方程式に基づいた基底状態のシミュレーションを実行するために生まれたものである．</p>
<p>これが強力なのである．極めて強力であるが故に，計算科学の分野ではすでに，そして将来的には確実に，シミュレーションと数値実験が，実際の実験と似たような重要な役割を科学において担うことになると見られている．</p>
</section>
<section id="推論のための粒子法との関係" class="level3" data-number="1.4">
<h3 data-number="1.4" class="anchored" data-anchor-id="推論のための粒子法との関係"><span class="header-section-number">1.4</span> 推論のための粒子法との関係</h3>
<p>この意味での粒子法と，統計学において粒子法と言った場合に想像されるであろう SMC や IPM (interacting particle methods) とは <strong>実は数理的には同一物である</strong> ことを見たい．</p>
<p>一言で言えば，一般に粒子法はポテンシャル（ハミルトニアン）に従って粒子を伝播する方法であり，粒子フィルターは特にこれが Feynman-Kac 測度で与えられる場合に用いられる粒子法である．</p>
</section>
</section>
<section id="推論のための粒子法" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="推論のための粒子法"><span class="header-section-number">2</span> 推論のための粒子法</h2>
<section id="ベイズ逆問題" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="ベイズ逆問題"><span class="header-section-number">2.1</span> ベイズ逆問題</h3>
<p>シミュレーションができるようになったならば，これを実際の実験データや観測データと付き合わせて比較したいということになる．</p>
<p>このようにデータに基づいてシミュレーションを校正する作業は <strong>逆問題</strong> (inverse problem) と呼ばれ，旧来は統計的推論との関係は希薄であった．</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled" title="逆問題の例">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
逆問題の例
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><a href="https://ja.wikipedia.org/wiki/逆散乱">逆散乱問題</a>：<a href="https://ja.wikipedia.org/wiki/反響定位">反響定位</a> (echolocation) やソナー，<a href="https://en.wikipedia.org/wiki/Reflection_seismology">地震探索</a> (seismic exploration)</li>
<li><a href="https://ja.wikipedia.org/wiki/トモグラフィー">断層映像法</a> (tomography)：<a href="https://ja.wikipedia.org/wiki/海洋音響トモグラフィー">海洋音響トモグラフィー</a> や <a href="https://ja.wikipedia.org/wiki/%E5%9C%B0%E9%9C%87%E6%B3%A2%E3%83%88%E3%83%A2%E3%82%B0%E3%83%A9%E3%83%95%E3%82%A3%E3%83%BC">地震波トモグラフィー</a> など．</li>
<li><a href="https://ja.wikipedia.org/wiki/医用画像">医用画像</a> (medical imaging)：X線撮影，CT, MRI など．</li>
<li><a href="https://ja.wikipedia.org/wiki/非破壊検査">非破壊検査</a> (NDT: Non-Destructive Testing)：<a href="https://ja.wikipedia.org/wiki/超音波探傷試験">超音波探傷試験</a> (UT: Ultrasonic Testing / SAT: Scanning Acoustic Tomography)</li>
<li>認知科学：脳波 (EEG: Electroencephalogram)，脳磁図 (MEG: Magnetoencephalography) など．<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ul>
</div>
</div>
<div class="callout callout-style-default callout-important no-icon callout-titled" title="逆問題の形式的な定義">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
逆問題の形式的な定義
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>逆問題は広く Banach 関数上の作用素 <span class="math inline">\(F:X\osup U\to Y\)</span> の零点を求める問題として定式化される <span class="citation" data-cites="Nakamura-Potthast2015">(定義1.2.1 <a href="#ref-Nakamura-Potthast2015" role="doc-biblioref">Nakamura and Potthast, 2015, pp. 1–15</a>)</span>．</p>
<p>大きく分類すると，源泉問題 (source problem) と散乱問題 (scattering problem)，力学系逆問題 (dynamical systems inversion)，スペクトル逆問題 (spectral inverse problem) との４つに分けられる．</p>
<p>場の復元と形状の復元は散乱問題の特別な場合とみれる．スペクトル逆問題は <span class="citation" data-cites="Kac1966">(<a href="#ref-Kac1966" role="doc-biblioref">Kac, 1966</a>)</span> で有名である．</p>
<p>データ同化問題は力学系逆問題を逐次的に解く方法と位置付けられる <span class="citation" data-cites="Nakamura-Potthast2015">(<a href="#ref-Nakamura-Potthast2015" role="doc-biblioref">Nakamura and Potthast, 2015, pp. 1–20</a>)</span>．</p>
</div>
</div>
</div>
<p>しかし「系に対する，方程式などの形で与えられる事前知識をもとに，データから実際の構造に対する知識をアップデートしていく」という営みはまさにベイズ推論の一種である．</p>
<p>特にベイズによる取り扱いが統一的な数学的基礎を与えることに加え，従来からの無定義用語であった well-posedness に数学的に厳密な定義を与えることができることから，近年 <strong>ベイズ逆問題</strong> (Bayesian inverse problem) と呼ばれる分野が進展を見せている <span class="citation" data-cites="Stuart2010">(<a href="#ref-Stuart2010" role="doc-biblioref">Stuart, 2010</a>)</span>．</p>
<p>さらに従来の逆問題のためのアルゴリズムは統計学における対応物を持つことが多い．例えば Tikhonov-Phillips 正則化と呼ばれる手続きは Ridge 回帰 <span class="citation" data-cites="Hoerl-Kennard1970">(<a href="#ref-Hoerl-Kennard1970" role="doc-biblioref">Hoerl and Kennard, 1970</a>)</span> に他ならない．データ同化においては変分推論が先駆けて古くから使われている <span class="citation" data-cites="佐々木1958">(<a href="#ref-佐々木1958" role="doc-biblioref">Sasaki, 1958</a>)</span>．</p>
<p>ベイズの取り扱いはこのようなアルゴリズムの開発に対しても統一的な基盤を与える上に，アルゴリズムの最適性の議論も可能になる <span class="citation" data-cites="Nickl2017">(<a href="#ref-Nickl2017" role="doc-biblioref">Nickl, 2017</a>)</span>．</p>
</section>
<section id="データ同化" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="データ同化"><span class="header-section-number">2.2</span> データ同化</h3>
<p>極めて現代的な逆問題の発展形が <strong>データ同化</strong> (data assimilation) または <strong>動的逆問題</strong> (dynamic inverse problem) である．<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<p>データ同化は地球科学，特に気象予測の分野で芽生えた考え方である．気象予測では大規模なシミュレーションが欠かせないが，同時に正確な予測のためには初期値の正確さが重要であることがその黎明期から認識されていた <span class="citation" data-cites="Kalnay2002">(<a href="#ref-Kalnay2002" role="doc-biblioref">Kalnay, 2002</a>)</span>．</p>
<p>しかし系が巨大すぎるあまり，観測データから得られる情報は極めて限定的であり，むしろ初期値を正確に知るためにもシミュレーションや構造的な知識が必要である．</p>
<p>このように順問題と逆問題とを逐次的に考えることがデータ同化の特徴である．もしかしたら data-simulation assimilation や data-model assimilation と呼ぶべきかもしれない．</p>
<p>現在データ同化は測定値とシミュレーションを同化させて精度の良い予測を行う営為全般に応用が進んでいる <span class="citation" data-cites="Nakamura-Potthast2015">(<a href="#ref-Nakamura-Potthast2015" role="doc-biblioref">Nakamura and Potthast, 2015</a>)</span>．</p>
</section>
<section id="enkf" class="level3" data-number="2.3">
<h3 data-number="2.3" class="anchored" data-anchor-id="enkf"><span class="header-section-number">2.3</span> EnKF</h3>
<p>データ同化のダイナミックな問題設定が制御理論に近く，Kalman フィルター <span class="citation" data-cites="Kalman1960">(<a href="#ref-Kalman1960" role="doc-biblioref">Kalman, 1960</a>)</span> が利用可能であることが 1980 年代に自覚された <span class="citation" data-cites="Ghil+1981">(<a href="#ref-Ghil+1981" role="doc-biblioref">Ghil et al., 1981</a>)</span>．</p>
<p>しかし数値気象予測では状態空間が極めて高次元であり，計算コストの削減が必要であった．</p>
<p>アンサンブルカルマンフィルター (EnKF: Ensemble Kalman Filter) <span class="citation" data-cites="Evensen1994">(<a href="#ref-Evensen1994" role="doc-biblioref">Evensen, 1994</a>)</span> はデータ同化の 2024 時点でもデファクトスタンダードである．</p>
</section>
<section id="変分法" class="level3" data-number="2.4">
<h3 data-number="2.4" class="anchored" data-anchor-id="変分法"><span class="header-section-number">2.4</span> 変分法</h3>
<p><span class="citation" data-cites="佐々木1958">(<a href="#ref-佐々木1958" role="doc-biblioref">Sasaki, 1958</a>)</span> など黎明期から変分法の応用が考えられていた．</p>
<p>この方法は <span class="citation" data-cites="Lions1971">(<a href="#ref-Lions1971" role="doc-biblioref">Lions, 1971</a>)</span> で最適制御の <strong>随伴法</strong> (adjoint method) <span class="citation" data-cites="Pontryagin+1962">(<a href="#ref-Pontryagin+1962" role="doc-biblioref">Pontryagin et al., 1962</a>)</span> と合流し，3D-VAR, 4D-VAR などの手法が提案されている <span class="citation" data-cites="Talagrand-Coutier1987">(<a href="#ref-Talagrand-Coutier1987" role="doc-biblioref">Talagrand and Courtier, 1987</a>)</span>．</p>
<p>随伴法は <a href="../../../posts/2024/Samplers/NF1.html#sec-CNF">連続正規化流／ニューラル ODE のパラメータ推定でも用いられている</a>．</p>
</section>
<section id="粒子フィルターの位置付け" class="level3" data-number="2.5">
<h3 data-number="2.5" class="anchored" data-anchor-id="粒子フィルターの位置付け"><span class="header-section-number">2.5</span> 粒子フィルターの位置付け</h3>
<p>従来から粒子法が用いられていたが，粒子フィルターは今後の大規模データ世界におけるデータ同化の主力技術と目されている <span class="citation" data-cites="vanLeeuwen+2019">(<a href="#ref-vanLeeuwen+2019" role="doc-biblioref">Leeuwen et al., 2019</a>)</span>．</p>
<p>例えば気象予測の分野で，積雲対流 (cumulus convection) という現象は数 km のスケールで起こるが，大気循環の全体の記述に不可欠であることが知られている <span class="citation" data-cites="浅井冨雄1967">(<a href="#ref-浅井冨雄1967" role="doc-biblioref">浅井冨雄, 1967</a>)</span>．</p>
<p>これを観測する数 km 解像度の convective scale でのデータ同化は従来の <span class="math inline">\(10^4\)</span> オーダーでの <a href="https://ja.wikipedia.org/wiki/総観気象学">総観スケール</a> (synoptic scale) でのデータ同化よりもはるかに非線型性が強いため，従来法の革新が迫れられており <span class="citation" data-cites="Yano+2018">(<a href="#ref-Yano+2018" role="doc-biblioref">Yano et al., 2018</a>)</span>，粒子フィルターが注目されている．</p>
</section>
</section>
<section id="関連記事" class="level2 unlisted unnumbered">
<h2 class="unlisted unnumbered anchored" data-anchor-id="関連記事">関連記事</h2>
<div id="listing-lst-listing" class="listing quarto-float quarto-figure quarto-figure-left quarto-listing quarto-listing-container-grid anchored">
<div class="list grid quarto-listing-cols-3">
<div class="g-col-1" data-index="0" data-categories="UGFydGljbGVzJTJDU3VydmV5JTJDQ29tcHV0YXRpb24=" data-listing-date-sort="1700870400000" data-listing-file-modified-sort="1740457426329" data-listing-date-modified-sort="1702598400000" data-listing-reading-time-sort="5" data-listing-word-count-sort="821">
<a href="../../../posts/2023/Surveys/ParticleFilter.html" class="quarto-grid-link">
<div class="quarto-grid-item card h-100 card-left">
<p class="card-img-top">
<img loading="lazy" src="../../../posts/2023/Surveys/cover_LowResolution.jpg" class="thumbnail-image card-img" style="height: 150px;">
</p>
<div class="card-body post-contents">
<h5 class="no-anchor card-title listing-title">
粒子フィルターとは何か
</h5>
<div class="card-subtitle listing-subtitle">
非線型フィルタリング手法としての粒子フィルタ
</div>
<div class="card-attribution card-text-small end">
<div class="listing-date">
2023-11-25
</div>
</div>
</div>
</div>
</a>
</div>
<div class="g-col-1" data-index="1" data-categories="UGFydGljbGVzJTJDTUNNQyUyQ1N1cnZleQ==" data-listing-date-sort="1702512000000" data-listing-file-modified-sort="1740457430212" data-listing-date-modified-sort="1722816000000" data-listing-reading-time-sort="3" data-listing-word-count-sort="489">
<a href="../../../posts/Surveys/SMCSamplers.html" class="quarto-grid-link">
<div class="quarto-grid-item card h-100 card-left">
<p class="card-img-top">
<img loading="lazy" src="../../../posts/Surveys/SMCSamplers_LowResolution.jpg" class="thumbnail-image card-img" style="height: 150px;">
</p>
<div class="card-body post-contents">
<h5 class="no-anchor card-title listing-title">
粒子フィルターを用いたサンプリング | About SMC Samplers
</h5>
<div class="card-subtitle listing-subtitle">
テンパリングを通じたもう一つの万能サンプラー
</div>
<div class="card-attribution card-text-small end">
<div class="listing-date">
2023-12-14
</div>
</div>
</div>
</div>
</a>
</div>
<div class="g-col-1" data-index="2" data-categories="UGFydGljbGVzJTJDUHl0aG9u" data-listing-date-sort="1702252800000" data-listing-file-modified-sort="1740457426309" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="12" data-listing-word-count-sort="2261">
<a href="../../../posts/2023/Particles/ParticleFilter.html" class="quarto-grid-link">
<div class="quarto-grid-item card h-100 card-left">
<p class="card-img-top">
<img loading="lazy" src="../../../posts/2023/Particles/sample_plot.png" class="thumbnail-image card-img" style="height: 150px;">
</p>
<div class="card-body post-contents">
<h5 class="no-anchor card-title listing-title">
粒子フィルターの実装 | Particles Package
</h5>
<div class="card-subtitle listing-subtitle">
<code>NumPy</code> と <code>SciPy</code> で粒子フィルターを実装する
</div>
<div class="card-attribution card-text-small end">
<div class="listing-date">
2023-12-11
</div>
</div>
</div>
</div>
</a>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div>




</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Evensen1994" class="csl-entry" role="listitem">
Evensen, G. (1994). Sequential data assimilation with a nonlinear quasi-geostrophic model using monte carlo methods to forecast error statistics. <em>Journal of Geophysical Research</em>, <em>99</em>(C5), 10143–10162.
</div>
<div id="ref-Fenyman+1963" class="csl-entry" role="listitem">
Feynman, R. P., Leighton, R. B., and Sands, M. (1964). <a href="https://www.feynmanlectures.caltech.edu/I_01.html">The feynman lectures of physics</a>. In,Vol. I. Addison-Wesley.
</div>
<div id="ref-Ghil+1981" class="csl-entry" role="listitem">
Ghil, M., Cohn, S., Tavantzis, J., Bube, K., and Isaacson, E. (1981). <a href="https://doi.org/10.1007/978-1-4612-5970-1_5">Applications of estimation theory to numerical weather prediction</a>. In L. Bengtsson, M. Ghil, and E. Källén, editors, <em>Dynamic meteorology: Data assimilation methods</em>, pages 139–224. New York, NY: Springer New York.
</div>
<div id="ref-Griebel+2007" class="csl-entry" role="listitem">
Griebel, M., Zumbusch, G., and Knapek, S. (2007). <em><a href="https://link.springer.com/book/10.1007/978-3-540-68095-6">Numerical simulation in molecular dynamics: Numerics, algorithms, parallelization, applications</a></em>,Vol. 5. Springer Belin, Heidelberg.
</div>
<div id="ref-Hoerl-Kennard1970" class="csl-entry" role="listitem">
Hoerl, A. E., and Kennard, R. W. (1970). <a href="http://www.jstor.org/stable/1267351">Ridge regression: Biased estimation for nonorthogonal problems</a>. <em>Technometrics</em>, <em>12</em>(1), 55–67.
</div>
<div id="ref-Kac1966" class="csl-entry" role="listitem">
Kac, M. (1966). <a href="https://doi.org/10.1080/00029890.1966.11970915">Can one hear the shape of a drum?</a> <em>The American Mathematical Monthly</em>, <em>73</em>(4P2), 1–23.
</div>
<div id="ref-Kalman1960" class="csl-entry" role="listitem">
Kalman, R. E. (1960). <a href="https://asmedigitalcollection.asme.org/fluidsengineering/article-abstract/82/1/35/397706/A-New-Approach-to-Linear-Filtering-and-Prediction?redirectedFrom=fulltext">A new approach to linear filtering and prediction problems</a>. <em>Journal of Basic Engineering</em>, <em>82</em>(1), 35–45.
</div>
<div id="ref-Kalnay2002" class="csl-entry" role="listitem">
Kalnay, E. (2002). <em>Atmospheric modeling, data assimilation and predictability</em>. Cambridge University Press.
</div>
<div id="ref-vanLeeuwen+2019" class="csl-entry" role="listitem">
Leeuwen, P. J. van, Künsch, H. R., Nerger, L., Potthast, R., and Reich, S. (2019). <a href="https://doi.org/10.1002/qj.3551">Particle filters for high-dimensional geoscience applications: A review</a>. <em>Quarterly Journal of the Royal Meteorological Society</em>, <em>145</em>(723), 2335–2365.
</div>
<div id="ref-Lions1971" class="csl-entry" role="listitem">
Lions, J. L. (1971). <em><a href="https://link.springer.com/book/9783642650260">Optimal control of systems governed by partial differential equations</a></em>,Vol. 170. Springer Berlin, Heidelberg.
</div>
<div id="ref-Metropolis+1953" class="csl-entry" role="listitem">
Metropolis, N., Rosenbluth, A. W., Rosenbluth, M. N., Teller, A. H., and Teller, E. (1953). <a href="https://doi.org/10.1063/1.1699114">Equation of state calculations by fast computing machines</a>. <em>The Journal of Chemical Physics</em>, <em>21</em>(6), 1087–1092.
</div>
<div id="ref-Nakamura-Potthast2015" class="csl-entry" role="listitem">
Nakamura, G., and Potthast, R. (2015). <em><a href="https://doi.org/10.1088/978-0-7503-1218-9">Inverse modeling: An introduction to the theory and methods of inverse problems and data assimilation</a></em>. IOP Publishing.
</div>
<div id="ref-Nickl2017" class="csl-entry" role="listitem">
Nickl, R. (2017). <a href="https://www.bernoullisociety.org/files/BernoulliNews2017-2.pdf"><span class="nocase">On Bayesian Inference for Some Statistical Inverse Problems with Partial Differential Equations</span></a>. In <em>Bernoulli news</em>,Vol. 24. Bernoulli Society.
</div>
<div id="ref-Pontryagin+1962" class="csl-entry" role="listitem">
Pontryagin, L. S., Boltyanskii, V. G., Gamkrelidze, R. V., and Mishchenko, E. F. (1962). <em><a href="">The mathematical theory of optimal processes</a></em>. John Wiley &amp; Sons.
</div>
<div id="ref-Rapaport2004" class="csl-entry" role="listitem">
Rapaport, D. C. (2004). <em><a href="https://doi.org/10.1017/CBO9780511816581">The art of molecular dynamics simulation</a></em>. Cambridge University Press.
</div>
<div id="ref-佐々木1958" class="csl-entry" role="listitem">
Sasaki, Y. (1958). <a href="https://doi.org/10.2151/jmsj1923.36.3_77">An ObJective analysis based on the variational method</a>. <em>氣象集誌. 第2輯</em>, <em>36</em>(3), 77–88.
</div>
<div id="ref-Stuart2010" class="csl-entry" role="listitem">
Stuart, A. M. (2010). <a href="https://doi.org/10.1017/S0962492910000061">Inverse problems: A bayesian perspective</a>. <em>Acta Numerica</em>, <em>19</em>, 451–559.
</div>
<div id="ref-Talagrand-Coutier1987" class="csl-entry" role="listitem">
Talagrand, O., and Courtier, P. (1987). <a href="https://doi.org/10.1002/qj.49711347812">Variational assimilation of meteorological observations with the adjoint vorticity equation. I: theory</a>. <em>Quarterly Journal of the Royal Meteorological Society</em>, <em>113</em>(478), 1311–1328.
</div>
<div id="ref-Ter-Pogossian1975" class="csl-entry" role="listitem">
Ter-Pogossian, M. M., Phelps, M. E., Hoffman, E. J., and Mullani, N. A. (1975). <a href="https://doi.org/10.1148/114.1.89">A positron-emission transaxial tomograph for nuclear imaging (PETT)</a>. <em>Radiology</em>, <em>114</em>(1), 89–98.
</div>
<div id="ref-Yano+2018" class="csl-entry" role="listitem">
Yano, J.-I., Ziemiański, M. Z., Cullen, M., Termonia, P., Onvlee, J., Bengtsson, L., … Wyszogrodzki, A. A. (2018). <a href="https://doi.org/10.1175/BAMS-D-17-0125.1">Scientific challenges of convective-scale numerical weather prediction</a>. <em>Bulletin of the American Meteorological Society</em>, <em>99</em>(4), 699–710.
</div>
<div id="ref-岡本-本間2002" class="csl-entry" role="listitem">
岡本良夫, and 本間生夫. (2002). <a href="https://doi.org/10.1541/ieejeiss1987.122.9_1417">脳波とその逆問題解析</a>. <em>電気学会論文誌. C, 電子・情報・システム部門誌</em>, <em>122</em>(9), 1417–1425.
</div>
<div id="ref-浅井冨雄1967" class="csl-entry" role="listitem">
浅井冨雄. (1967). <a href="https://doi.org/10.2151/jmsj1965.45.3_251">細胞状積雲対流の特性について</a>. <em>Journal of the Meteorological Society of Japan. Ser. II</em>, <em>45</em>(3), 251–260.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>「MRI や PET では脳内における血流量や糖代謝等の空間分布が mm オーダーの分解能で直接に計測できるのに対し、EEG や MEG では頭表面上で計測される電位分布や磁場分布から脳内の起電力分布を推定するという問題、いわゆる脳電位逆問題や脳磁場逆問題を解決しなければならない。」<span class="citation" data-cites="岡本-本間2002">(<a href="#ref-岡本-本間2002" role="doc-biblioref">岡本良夫 and 本間生夫, 2002</a>)</span>．fMRI や陽電子断層撮像法 (PET: Positron Emission Tomography) <span class="citation" data-cites="Ter-Pogossian1975">(<a href="#ref-Ter-Pogossian1975" role="doc-biblioref">Ter-Pogossian et al., 1975</a>)</span> は深いところまで見れるが時間分解能が低いという欠点もある．<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>データ同化に対するレトロニムとして，逆問題を <strong>古典的逆問題</strong> (classical inverse problem) と呼ぶこともある <span class="citation" data-cites="Nakamura-Potthast2015">(<a href="#ref-Nakamura-Potthast2015" role="doc-biblioref">Nakamura and Potthast, 2015, pp. 1–5</a>)</span>．<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/162348\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="162348/162348.github.io" data-repo-id="R_kgDOKlfKYQ" data-category="Announcements" data-category-id="DIC_kwDOKlfKYc4CgDmb" data-mapping="pathname" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" data-loading="lazy" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://162348.github.io/">
<p>Hirofumi Shiba</p>
</a>
  </li>  
</ul>
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/162348/162348.github.io/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ano2math5">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:shiba.hirofumi@ism.ac.jp">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="../../../blog.xml">
      <i class="bi bi-rss" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>