---
title: "Poisson 過程を見てみよう"
subtitle: "YUIMA パッケージを用いたシミュレーションを通じて"
author: "司馬 博文"
date: 6/29/2024
categories: [Process, Simulation, Stan, YUIMA, R]
image: Poisson_files/figure-html/unnamed-chunk-2-1.png
bibliography: 
    - ../../../mathematics.bib
    - ../../../bib.bib
csl: ../../../apa.csl
abstract-title: 概要
abstract: Poisson 点過程とは，Poisson 分布に従う個数分だけ現れる一様な点がなすランダム測度である．複合 Poisson 点過程を考えることで，互いに素な集合に入る点の個数が独立に決まるようなランダム測度を特徴付けることができる．Lévy 過程としての Poisson 過程，複合 Poisson 過程は，これら点過程に関する確率積分として理解できる．
code-fold: false
---

{{< include ../../../_preamble.qmd >}}

YUIMAについては次の記事も参照：

```{=html}
<div class="article-card-container">
  <div class="article-card">
    <a href="https://162348.github.io/posts/2024/Computation/YUIMA.html" target="_blank">
      <img src="https://162348.github.io/posts/2024/Computation/YUIMA_files/figure-html/unnamed-chunk-5-1.png" alt="Article Image" class="article-image">
      <div class="article-content">
        <h3 class="article-title">YUIMA 入門</h3>
        <p class="article-description">確率微分方程式のシミュレーションと推測のためのパッケージ`yuima`の構造と使い方をまとめます．</p>
      </div>
    </a>
  </div>
</div>
```

## Poisson 過程

### 導入

Poisson 過程と言った場合，Poisson 点過程 $\eta$ と Poisson 計数過程 $N$ の２つを峻別する必要がある．^[[@Nualart2018 p.159] 例9.1.3，[@Revuz-Yor1999 p.471] 定義XII.1.3 などは，Poisson 計数過程の方を Poisson 過程と呼んでおり，[@Last_Penrose2017] などは Poisson 点過程の方を Poisson 過程と呼んでいる．]

::: {.callout-important appearance="simple" icon="false"}

$E=[0,T]$ とした場合，

* $E$ 上の（一様な） Poisson 点過程 $\eta$ とは，$X_k\iidsim\rU([0,T])$ を一様確率変数，$\kappa\sim\Pois(\lambda)$ を Poisson 確率変数として，
    $$
    \eta=\sum_{k=1}^\kappa\delta_{X_k}
    $$
    で表せる確率核 $\Om\to E$ をいう．
* $E$ 上の（一様な） Poisson 計数過程 $N$ とは，$\eta$ に対して
    $$
    N_t:=\#\Brace{n\in\N\mid X_n\le t}=\sum_{n=1}^\infty1_{\Brace{X_n\le t}}
    $$
    で定まる Lévy 過程をいう．

:::

このとき，
$$
\eta([0,t])\sim\Pois(\lambda t),
$$
$$
N_t\sim\Pois(\lambda t),
$$
が成り立つ．

$N$ は大きさ１の跳躍のみで増加する Lévy 過程として特徴付けられる．^[[@Revuz-Yor1999 p.472] 命題XII.1.4など．]

後者は，前者を駆動過程とした確率積分
$$
N_t:=\int_0^td\eta_s
$$
と理解できる．

### 点過程の定義

::: {.callout-tip title="定義 (point process)^[[@Kallenberg2017 p.49]，[@Last_Penrose2017 p.11] 定義2.1 に倣った．全く同じ概念を [@伊藤清1991 p.298] は **偶然配置** と呼ぶ．]" icon="false"}

$(E,\cE)$ を測度空間とする．$E$ 上の **点過程** とは，次の条件を満たす確率核 $\eta:\Om\to E$ をいう：
$$
\eta(\om,B)\in\N\cup\{\infty\},\qquad\om\in\Om,B\in\cE.
$$

:::

**真の点過程** とは，ある $E$-値確率変数の列 $X_1,X_2,\cdots$ と，$\N\cup\{\infty\}$-値確率変数 $\kappa$ が存在して，
$$
\eta=\sum_{n=1}^\kappa \delta_{X_n}\;\as
$$
と表せる点過程をいうこととする．

::: {.callout-important title="注（より直感的な定義）" collapse="true" icon="false"}

[@Revuz-Yor1999 p.471] 定義XII.1.1 は違う定義を与えている：

$E$ 上の点過程とは，$E_\delta:=E\cup\{\delta\}$ 上の確率過程 $\{e_t\}_{t\in\R_+}\subset\L(\Om;E_\delta)$ であって，次の２条件を満たすものをいう：

1. $(t,\om)\mapsto e_t(\om)$ は $\B(\R^+)\otimes\F$-可測である．
2. $D_\om:=\Brace{t\in\R_+\mid e_t(\om)\ne\delta}$ は殆ど確実に可算である．

[@Kingman2006] の定義は「$E$ 内のランダムに決まる可算集合」というもので，これに似ている．この定義は，上で与えた確率核による定義よりも強いものである．

確率核の意味での点過程が，追加で次の条件を満たすとき，真の点過程になる：^[[@Last_Penrose2017 p.48] 系6.5 を参照．] 特に，[@Revuz-Yor1999] の意味でも点過程である．

> ある可算な分割 $\sqcup_{n\in\N}B_n=E$ が存在して，
    $$
    \P[\eta(B_n)<\infty]=1
    $$
    である．

$E$ が Polish 空間で，$\eta(\om,-)$ が（殆ど確実に）任意の有界集合上で有限ならば，これを満たす．よって特に，$\sigma$-有限な強度測度を持つ Poisson 過程はこれを満たす．すなわち，いずれの意味でも点過程である．

:::

### 強度測度

点過程には「各集合 $B\in\cE$ に平均何個の点が入るか」を表す **強度測度** が定まる．

この強度測度に関して，Fubini の定理のような性質
$$
\E\Square{\int_E u\,d\eta}=\int_Eu\E[d\eta]
$$
が成り立つ．

::: {.callout-tip title="定義 (intensity measure)^[[@伊藤清1991 p.298] に倣った．]" icon="false"}

$\eta$ を点過程とする．$\eta$ の **強度測度** とは，次で定まる測度 $\mu:\cE\to[0,\infty]$ をいう：
$$
\lambda(B):=\E[\eta(B)],\qquad B\in\cE.
$$

:::

::: {.callout-tip title="命題 (Campbell)^[[@Last_Penrose2017 p.13] 命題2.7 に倣った．]" icon="false"}

$\eta$　を点過程，$\lambda$ をその強度測度とする．任意の $u\in\L(E)$ について，$(\eta|u)$ は確率変数であり，加えて $u\in\L^1(\lambda)$ または $u\ge0$ である場合，次が成り立つ：
$$
\E\Square{\int_Eu(x)\eta(dx)}=\int_Eu(x)\lambda(dx).
$$

:::

::: {.callout-note title="証明" icon="false" collapse="true"}

$u$ がある $B\in\cE$ の特性関数 $u=1_B$ である場合，
$$
\int_Eu(x)\eta(dx)=\eta(B)
$$
であり，点過程 $\eta$ の定義からこれは確率変数である．

期待値の線型性より一般の単関数，単調収束定理より一般の可測関数についても成り立つ．

$u\in\L^1(\lambda)$ であるとき，$u$ に収束する単関数列
$$
u_n:=\sum_{i=1}^{m_n}a_i^{(n)}1_{B_i^{(n)}}\nearrow u
$$
を取ると，Lebesgue の優収束定理より次のように結論づけられる：
\begin{align*}
    \E\Square{\int_Eu(x)\eta(dx)}&=\lim_{n\to\infty}\E\Square{\int_Eu_n(x)\eta(dx)}\\
    &=\lim_{n\to\infty}\E\Square{\sum_{i=1}^{m_n}a_i^{(n)}\eta(B_i^{(n)})}\\
    &=\lim_{n\to\infty}\sum_{i=1}^{m_n}a_i^{(n)}\lambda(B_i^{(n)})\\
    &=\int_Eu(x)\lambda(dx)=(\lambda|u)<\infty.
\end{align*}

$u\ge0$ の場合も同様で，Lebesgue の優収束定理が単調収束定理に変わるのみである．

:::

### Poisson 点過程の定義

::: {.callout-tip title="定義 (Poisson process / random measure)^[[@Nualart2018 p.160] 定義9.2.1，[@Sato2013 p.119] 第4章19節，[@Resnick2002 p.303]，[@Last_Penrose2017 p.19] 定義3.1 に倣った．]" icon="false"}

$(E,\cE)$ を可測空間，$\lambda:\cE\to[0,\infty]$ を測度とする．強度 $\lambda$ の **Poisson 過程** とは，次の２条件を満たす点過程 $\eta$ をいう：

1. 任意の $B\in\cE$ に対して，$\eta(B)\sim\Pois(\lambda(B))$．
2. 任意の $m\in\N$ と互いに素な可測集合 $B_1,\cdots,B_m\in\cE$ について，$\eta(B_1),\cdots,\eta(B_m)$ は独立である．

:::

$\lambda,\lambda'$ が $\sigma$-有限であるとする．このとき，$\lambda=\lambda'$ ならば，これを強度とする Poisson 過程は分布同等である．^[[@Revuz-Yor1999 p.476] 命題 XII.1.12，[@Last_Penrose2017 p.20] 命題3.2 も参照．]

::: {.callout-tip title="命題（Poisson 過程は Poisson 点過程と分布同等である）^[[@Last_Penrose2017 p.22] 系3.7 も参照．]" icon="false"}

$\lambda$ を $\sigma$-有限とする．このとき，ある確率変数の列 $\{X_n\}\subset\L(\Om;E)$ と $\N\cup\{\infty\}$-値確率変数 $\kappa$ が存在して，
$$
\eta:=\sum_{n=1}^\kappa\delta_{X_n}
$$
は強度 $\lambda$ の Poisson 過程となる．

:::

### 例

#### 二項過程の一般化

$\mu\in\cP(E),\pi\in\cP(\N)$ とする．$X_k\iidsim\mu$ と $\kappa\sim\pi$ について，
$$
\eta:=\sum_{k=1}^\kappa\delta_{X_k}
$$
は点過程を定める．これを **サンプリング分布 $\mu$ を持った $\pi$-複合二項過程** という．^[[@Last_Penrose2017 p.20] 定義3.4も参照．]

ある $\gamma>0$ に関して $\pi=\Pois(\gamma)$ と取った場合，$\eta$ は強度 $\gamma\mu$ を持った Poisson 過程となる．

これについて，次が成り立つ：

::: {.callout-tip title="命題（有限な強度を持つ Poisson 過程の特徴付け）^[[@Last_Penrose2017 p.23] 命題3.8も参照．]" icon="false"}

$\lambda:\cE\to(0,\infty)$ を有限測度とする．このとき，点過程 $\eta$ について，次の２条件は同値である：

1. $\eta$ は $\lambda$ を強度測度とする Poisson 過程である．
2. サンプリング分布 $\mu:=\lambda(E)^{-1}\lambda$ を持つ $\Pois(\lambda(E))$-複合二項過程である．

特に，$\eta(E)=m$ で条件づけた分布は，$\delta_{X_1}+\cdots+\delta_{X_m}$ に等しい．

:::

#### $\R_+$ 上の Poisson 過程 {#sec-Poisson-point-process-on-R}

$\R_+$ の Poisson 過程で，強度が $\R_+$ 上の Lebesgue 測度の定数倍であるものを **一様 Poisson 過程** といい，$\lambda>0$ を **レート** ともいう．

::: {.callout-tip title="命題（$\R_+$ 上の Poisson 点過程の特徴付け）^[[@Last_Penrose2017 p.59] 定理7.2参照．]" icon="false"}

$\eta$ を $\R_+$ 上の点過程とする．このとき，$\lambda>0$ に関して次は同値：

1. $\eta$ はレート $\lambda$ を持った一様 Poisson 過程である．
2. 到着時刻
    $$
    T_n(\om):=\inf\Brace{t\ge0\mid \eta(\om,[0,t])\ge n}
    $$
    の間隔は $\Exp(\lambda)$ の独立同分布である．

:::

### 剪定

::: {.callout-tip title="定義 ($K$-marking)^[[@Last_Penrose2017 p.40] 定義5.3 に倣った．[@Kingman1992 p.55] 5.2節も参照．]" icon="false"}

$\eta$ を $E$ 上の真の点過程，$K:E\to F$ を確率核，$\{Y_n\}\subset\L(\Om;F)$ を確率変数列とする．加えて，任意の $m\in\N\cup\{\infty\}$ について
$$
(Y_n)_{n\le m}\mi\kappa=m,(X_n)_{n\le m}\deq \otimes_{n=1}^mK(X_n,-)
$$
が成り立つとする．このとき，$X$ の **$K$-印字過程** とは，$E\times F$ 上の真の点過程
$$
\xi:=\sum_{n=1}^\kappa\delta_{(X_n,Y_n)}
$$
をいう．

:::

$\eta$ を $\sigma$-有限な強度 $\lambda$ を持つ Poisson 過程とするとき，$\eta$ の任意の可測写像 $T:E\to F$ による像は $T_*\lambda$ を強度とする Poisson 過程となり，$\eta$ の任意の $K$-印字過程もやはり Poisson 過程になる．^[例えば [@Kingman1992 p.55]，[@Last_Penrose2017 p.42] 命題5.5 を参照．]

::: {.callout-tip title="定義 ($p$-thinning)^[[@Last_Penrose2017 p.43] 定義5.7 に従った．]" icon="false"}

$p:E\to[0,1]$ を可測関数とし，確率核 $K:E\to2$ を次で定める：
$$
K_p(x,-):=\Paren{1-p(x)}\delta_0+p(x)\delta_1.
$$

$E$ 上の真の点過程 $X$ の，この確率核に関する $E\times2$ 上の $K$-印字過程 $M$ に対して，
$$
(\om,B)\mapsto M(\om,B\times\{1\})
$$
で定まる $E$ 上の真の点過程を $X$ の **$p$-剪定** という．

:::

すなわち，点 $x\in E$ に定まる所定の確率 $p(x)$ に関して，確率 $p(X_n)$ で点 $X_n$ を脱落させて得る点過程を，$p$-剪定という．

$p$-剪定は強度 $p(x)\lambda(dx)$ を持つ Poisson 過程となる．加えて，$1-p$-剪定と違いに独立になる．^[[@Last_Penrose2017 p.44] 系5.9 参照．]

### Poisson 過程が駆動する確率積分

::: {.callout-tip title="命題（Poisson 点過程との積分）^[[@Last_Penrose2017 p.111] 命題12.1 参考．]" icon="false"}

$(E,\cE,\lambda)$ を $\sigma$-有限な測度空間，$\eta$ を $E$ 上の強度測度 $\lambda$ を持つ Poisson 点過程とする．

このとき，$f\in\L(E)_+$ について，次は同値：

1. $\P[(\eta|f)<\infty]=1$．
2. 次が成り立つ：
$$
\int_E(f\land1)d\lambda<\infty.
$$

また，これらの条件が成り立たないとき，$\P[(\eta|f)=\infty]=1$ が成り立つ．

:::

Brown 運動に関する伊藤積分と同様に，
$$
I(f):=(\eta|f)-(\lambda|f)\in L^2(\P)
$$
は $L^1(\lambda)\cap L^2(\lambda)$ 上の等長作用素で，$L^2(\lambda)$ 上に有界延長する．^[[@Nualart2018 p.163] 9.3節，[@Last_Penrose2017 p.113] 命題12.4 など．]

### Poisson 計数過程のシミュレーション

`yuima`パッケージでは，Poisson 計数過程は複合 Poisson 計数過程の特別な場合として扱うため，シミュレーション法は第 [-@sec-simulating-CP] 節で扱い，ここでは結果のみを示す．

#### 一様な Poisson 計数過程

強度 $\lambda>0$ を持つ（一様な） Poisson 計数過程とは，$\R_+$ 上のレート $\lambda>0$ を持つ一様な Poisson 点過程（第 [-@sec-Poisson-point-process-on-R] 節）$\eta$ に対して，
$$
N_t(\om):=\eta(\om,[0,t])
$$
で定まる Lévy 過程である．

レート $\lambda>0$ はジャンプの頻度を表している：

```{R}
#| echo: false
#| output: false
library(yuima)
library(ggplot2)
library(gridExtra)  # グラフを並べて表示するために必要

mod1 <- setPoisson(intensity="lambda", df=list("dconst(z,1)"))

Terminal <- 30
samp <- setSampling(Terminal=Terminal, n=3000)
set.seed(123)

# lambda = 1 のシミュレーション
poisson1 <- simulate(mod1, true.par=list(lambda=1), sampling=samp)

# lambda = 5 のシミュレーション
poisson5 <- simulate(mod1, true.par=list(lambda=2), sampling=samp)
```

```{R}
#| echo: false
#| warning: false
# データの抽出と整形
data1 <- data.frame(time = index(poisson1@data@zoo.data$x), 
                    value = as.numeric(poisson1@data@zoo.data$x))
data5 <- data.frame(time = index(poisson5@data@zoo.data$x), 
                    value = as.numeric(poisson5@data@zoo.data$x))

# ggplot2を使用してプロットを作成
plot1 <- ggplot(data1, aes(x = time, y = value)) +
  geom_step() +
  ggtitle("Poisson Process (lambda = 1)") +
  theme_minimal() +
  ylab("Count") +
  xlab("Time") +
  ylim(0, 40)

plot5 <- ggplot(data5, aes(x = time, y = value)) +
  geom_step() +
  ggtitle("Poisson Process (lambda = 2)") +
  theme_minimal() +
  ylab("Count") +
  xlab("Time") +
  ylim(0, 40)

# 2つのプロットを横に並べて表示
grid.arrange(plot1, plot5, ncol=2)
```

#### 非一様な Poisson 計数過程

強度関数 $\lambda:\R_+\to\R^+$ を持つ **非一様な Poisson 計数過程** とは，全く同様な定義
$$
N_t(\om):=\eta(\om,[0,t])
$$
をし，ただ $\eta$ の強度測度を $\lambda(t)\ell_+(dt)$ に置き換えたものである．

例えば，強度関数
$$
\lambda(t)=10e^{-\frac{t}{5}}
$$
を持つ非一様な Poisson 過程は次のような見本道を持つ：

```{R}
#| echo: false
#| output: false
mod7 <- setPoisson(intensity="beta*exp(-lambda*t)", df=list("dconst(z,1)"))
poisson7 <- simulate(mod7, true.par=list(lambda=.2,beta=10), sampling=samp)
```

```{R}
#| echo: false
plot(poisson7)
f <- function(t,beta,lambda) beta*exp(-lambda*t)
curve(f(x,beta=10,lambda=0.2),from=0,to=Terminal,add=TRUE,col="red")
```

時間が経つごとに強度関数 $\lambda$ の値（赤線）が小さくなり，それに伴ってジャンプの頻度が減少していくことがわかる．

## 複合 Poisson 過程

### 導入

点過程としての複合 Poisson 過程は，Poisson 点過程の印字から構成される．

#### 計数過程として

Poisson 過程 $N$ は，大きさ１の跳躍のみで増加する Lévy 過程として特徴付けられるのであった．

この跳躍の大きさを任意の確率分布 $\mu\in\cP(\R)$ に従ったものに変更したもの
\begin{align*}
    M_t&:=\sum_{n=1}^{N_t}Y_n\\
    &=\sum_{k=1}^\kappa Y_k1_{\Brace{X_k\le t}}
\end{align*}
が **複合 Poisson （計数）過程** $\CP(\lambda,\mu)$ である．^[[@Nualart2018 p.159] 例9.1.4，[@Last_Penrose2017 p.155] 例15.5 など．]

$\mu=\delta_1$ の場合が Poisson 過程に当たる．^[[@Applebaum2009 p.50] も参照．]

#### 点過程として

これは，まず， $\eta$ の印字過程
$$
\xi:=\sum_{n=1}^\kappa\delta_{(X_n,Y_n)}
$$
が $E\times\R$ 上の強度測度 $\mu\otimes\lambda\ell$ を持つ Poisson 点過程であり，各 $X_n$ に $Y_n$ の重みをつけて足し合わせた点過程が基になっている．

これが複合 Poisson 点過程であり，$\xi$ に関する確率積分として $M$ が理解できる．

複合 Poisson 点過程はいわば Poisson 過程の

::: {.callout-important title="注（Lévy 過程としての見方）" collapse="true" icon="false"}

Poisson 過程は定数の Lévy 測度 $\lambda>0$ を持つ，特性量 $(0,0,\lambda)$ が定める Lévy 過程である．

一方で，複合 Poisson 過程 $\CP(\lambda,\mu)$ は特性量 $(0,0,\lambda\mu)$ を持つ Lévy 過程である．

Lévy 測度 $\nu$ について，$\norm{\nu}_\TV$ はジャンプの頻度，$\norm{\nu}_\TV^{-1}\nu$ がジャンプの分布を表すと言える．

:::

#### 複合 Poisson 点過程の普遍性

違いに素な $A,B\in\cE$ に対して $\xi(A)\indep\xi(B)$ を満たすようなランダム測度 $\xi$ は，固定した原子を持たないならば，ある決定論的な測度と複合 Poisson 点過程の和として表せる．^[[@Last_Penrose2017] 第 15.3 節参照．]

### 複合 Poisson 点過程の定義

::: {.callout-tip title="定義 (compound Poisson process)^[[@Last_Penrose2017 p.153] に倣った．]" icon="false"}

$(E,\cE)$ を可測空間とする．$E$ 上の **複合 Poisson 分布** とは，$E\times\R^+$ 上の Poisson 過程 $\eta$ を用いて
$$
\xi(\om,B)=\int_{B\times\R^+}r\,\eta(\om,dydr),
$$
$$
B\in\cE,
$$
と表せる確率核 $\xi:\Om\to E$ をいう．

:::

$E\times\R^+$ 上の Poisson 点過程 $\eta$ の第二成分が，$E$ 上のランダム点の「重み」のようなもので，$\xi$ は重みをつけて点を積分したものと理解できる．

::: {.callout-tip title="命題 ($\rho_0$-symmetric compound Poisson process with Lévy measure $\nu$)^[[@Last_Penrose2017 p.155] も参照，]" icon="false"}

Poisson 点過程 $\eta$ の強度測度が $\lambda=\rho_0\otimes\nu$ で表せ，さらに次を満たすとする：

1. $\rho_0\in\cP(E)$ は $\sigma$-有限．
2. $\nu\in\cP(\R^+)$ は
    $$
    \int_0^\infty(r\land1)\nu(dr)<\infty
    $$
    を満たす．

このとき，次が成り立つ：

1. $\xi$ は $\rho_0$-対称である：$\rho_0(B)=\rho_0(B')$ ならば，$\xi(B)\deq\xi(B')$．
2. 任意の $\ep>0$ について $\nu(\cointerval{0,\infty})<\infty$．

:::

::: {.callout-caution title="例（Lévy 過程に付随する複合 Poisson 点過程）^[[@Nualart2018 p.162] 例9.2.4 を参考．]" collapse="true" icon="false"}

Lévy 測度 $\nu$ を持つ Lévy 過程 $(L_t)$ を考える．

このとき $\nu$ は，$\nu(\{0\})=0$ で，
$$
\int_\R(1\land\abs{z}^2)\nu(dz)<\infty
$$
を満たすとされる．

$$
\cA_\nu:=\Brace{A\in\B(\R\setminus\{0\})\mid \nu(A)<\infty}
$$
に対して，
$$
N([s,t]\times A):=\sum_{s\le r\le t}1_A(\Delta L_r)
$$
とすると，時刻 $[s,t]$ 間の，幅が $A\in\cA_\nu$ に入るジャンプの数を表す確率変数となる．

これは $\R_+\times\R\setminus\{0\}$ 上の Poisson 点過程に延長し，強度 $\ell_+\otimes\nu$ を持つ．

すなわち，$N$ は Lévy 測度 $\nu$ を持つ $\ell_+$-対称な複合 Poisson 点過程である．この $N$ を **跳躍測度** (jump measure) ともいう．

Lévy 測度 $\nu$ は，単位時間あたり（$\ell_+$ で測って測度 $1$ の集合あたり）の平均ジャンプ数を表す：
$$
\nu(A)=\E[N([0,1]\times A)].
$$

:::

### 複合 Poisson 点過程が駆動する確率積分

$E$ 上の複合 Poisson 点過程 $\xi$ とは，$E\times\R^+$ 上の Poisson 点過程 $\eta$ に他ならないため，Poisson 点過程に関する確率積分を通じて
$$
\int_Ef\,d\xi_=\int_Erf(y)\eta(dydr)
$$
と定義できる．^[[@Nualart2018 p.164] 例9.3.1，[@Last_Penrose2017 p.161] 15.4節なども参照．]

$(r,z)\mapsto rf(z)$ が $\eta$ の強度測度 $\lambda$ に関して可積分ならば，$(\xi|f)$ も可積分な確率変数である．

::: {.callout-caution title="例（Lévy 過程の分解）^[[@Nualart2018 p.164] 例9.3.1，[@Sato2013 p.120] 定理19.2，[@Protter2005 p.31] 定理42 など参照．]" collapse="true" icon="false"}

$L$ を特性量 $(\beta,\al^2,\nu)$ を持つ Lévy 過程，$N$ を跳躍測度とする．

Lévy 測度は
$$
\int_{B^d}z^2\nu(dz)<\infty
$$
を満たすから，
$$
\int^t_0\int_{B^d}z\wh{N}(dsdz)<\infty
$$
は可積分である．ただし，
$$
\wh{N}([0,t]\times A):=N([0,t]\times A)-t\nu(A)
$$
を中心化した Poisson 過程とした．これを **Poisson 補過程** (compensated Poisson process) ともいう．

このとき，$L$ は次の分解を持つ：
$$
L_t=\beta t+\al B_t+\int^t_0\int_{B^d}z\wh{N}(dsdz)+\int^t_0\int_{\Brace{\abs{z}>1}}zN(dsdz).
$$
このとき，$B\indep N$ であり，最後の項は結局有限和である：
$$
\int^t_0\int_{\R^d\setminus B^d}zN(dsdz)=\sum_{0\le r\le t}\Delta L_r1_{\R^d\setminus B^d}(\Delta L_r).
$$
この項が有限であることは，$\nu$ が $\R^d\setminus B^d$ 上で有限であることによる．

:::

### 複合 Poisson 計数過程の定義

::: {.callout-tip title="定義 (compound Poisson processes)^[[@Iacus-Yoshida2018 p.137], p.158，[@Sato2013 p.18] 定理4.3，[@Protter2005 p.33] 例2，[@Baudoin2014-DiffusionProcess p.90] 演習3.44，[@Applebaum2009 p.49] 命題1.3.11 に倣った．]" icon="false"}

$\lambda>0$ を正数，$\mu\in\cP(\R^d)$ を確率分布とする．一様な **複合 Poisson 過程** $\CP(\lambda,\mu)$ とは，強度 $\lambda$ を持つ（一様な） Poisson 過程 $N$ が定める Lévy 過程 $\{X_t\}\subset\L(\Om;\R^d)$ をいう：
$$
X_t:=\sum_{n=1}^{N_t}Y_n,
$$
$$
Y_n\iidsim\mu.
$$

:::

この $X_t$ は Lévy 過程になっており，$X_t$ の特性関数は
$$
\varphi(u)=\exp\paren{\lambda t\int_{\R^d}\Paren{e^{i(u|y)}-1}\mu(dy)}
$$
で表される．

### シミュレーション {#sec-simulating-CP}

`yuima`パッケージには，複合 Poisson 分布専用のコンストラクタ`setPoisson`が用意されている．このコンストラクタは２つの引数を持つ：

::: {.callout-important appearance="simple" icon="false" title="`setPoisson`の引数"}

* `intensity`：強度（関数） $\lambda>0$ として用いる変数名を文字列で指定する．
* `df`：跳躍測度 $\mu\in\cP(\R^d)$ として用いる分布名を，文字列のリストで指定する．
* `scale=1`：$\norm{\nu}_\TV$ の値のこと．
* `dimension=1`：$d$ の値．

:::

::: {.callout-caution title="例（一様 Poisson 過程の例）" collapse="true" icon="false"}

Poisson 過程はジャンプの大きさが定数１の複合 Poisson 過程であるから，`df`としては $\delta_1$ を意味する`dconst(z,1)`を指定する．

```{R}
#| output: false
library(yuima)

mod1 <- setPoisson(intensity="lambda", df=list("dconst(z,1)"))
```

```{R}
#| output: false
Terminal <- 30
samp <- setSampling(Terminal=Terminal, n=3000)
set.seed(123)
poisson1 <- simulate(mod1, true.par=list(lambda=1), sampling=samp)
```

```{R}
plot(poisson1)
```

:::

::: {.callout-caution title="例（正規分布に従う跳躍を持つ複合 Poisson 過程）" collapse="true" icon="false"}

`df`として正規分布族`dnorm(z,mu,sigma)`を指定すれば良い．

```{R}
#| output: false
mod2 <- setPoisson(intensity="lambda", df=list("dnorm(z,mu,sigma)"))
poisson2 <- simulate(mod2, sampling=samp, true.par=list(lambda=1, mu=0, sigma=2))
```

跳躍分布が $\mu=\rN_1(0,2)$ である場合の複合 Poisson 過程をシミュレーションは次のとおり：

```{R}
plot(poisson2)
```

:::

## Gamma 過程

### 導入

あ