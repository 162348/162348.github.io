---
title: "ベイズデータ解析７"
subtitle: "ベイズ階層モデル"
author: "司馬 博文"
date: 12/12/2024
date-modified: 12/12/2024
categories: [Bayesian, Statistics]
bibliography: 
    - ../../../assets/mathematics.bib
    - ../../../assets/bib.bib
    - ../../../assets/bib1.bib
csl: ../../../assets/apalike.csl
# abstract-title: 概要
# abstract: |
#     通常の回帰モデルは応答変数が連続であることが暗黙の仮定となっている．
#     この節では，応答変数が質的変数である場合のモデリングを扱う．
#     この場合でも多くのモデルが利用可能であり，その多くが一般化線型モデルの枠組みで統一的に扱うことができる．
# keywords: [Binomial Model, Multinomial Model, Polychotomous Response Data, Log-linear Model, Bradley-Terry Model, Poisson Model, Rank Ordered Data]
# image: Files/BayesianWorkflow.svg
listing: 
    -   id: lst-survey
        type: grid
        sort: false
        contents:
            - "BDA1.qmd"
            - "../Lifestyle/FixedRandom.qmd"
            - "../Kernels/HierarchicalModel.qmd"
        date-format: iso
        fields: [title,image,date,subtitle]
    -   id: lst-regression
        type: grid
        sort: false
        contents:
            - "BayesRegression.qmd"
            - "BDA1.qmd"
            - "BDA2.qmd"
        date-format: iso
        fields: [title,image,date,subtitle]
---

{{< include ../../../assets/_preamble.qmd >}}

## 関連記事 {.unnumbered .unlisted}

::: {#lst-survey}
:::

## はじめに

### 階層モデル

データが自然な **階層構造** を持つとする．例えば標本がクラスター抽出された場合，パネルデータや経時的繰り返し観測による標本，共変量統制とマッチングなど，自然な階層構造を持つデータは多い．

このようなデータに対して，個々のサブグループに対して全く同じ回帰モデルを繰り返し適用し，結果のプロットを小窓に分割して並べることで，グループごとの効果の違いを比較することができる．

この方法はナイーブながらも有力で，[10.9 節 @Gelman-Hill-Vehtari2020 p.148] では "secret weapon" と呼んでいる．

この別々の回帰モデルはベイズ的に統合して推論することができる．このグループごとに変動する係数を許したモデルが（ベイズ）**階層モデル** である．

### いつ使うか？

線型回帰の枠組みで交差項を入れることで，グループごとに緩やかに異なる回帰係数を許すことができる．

さらには一般化線型モデルを用いることで，連続・離散データの簡単な非線型関係まで扱うことができる．

::: {#lst-regression}
:::

それでも階層モデルに進む動機として次のような点が挙げられる：

::: {.callout-important icon="false" title="階層モデルの美点"^[[@Gelman-Hill2006 p.246] も参照．]}

* グループレベルの回帰係数を推定することができる．特に特定のグループに対する回帰係数を正確に推定するために自然なモデルである．^[例えば小地域推定においては極めて自然なモデルである [@久保川達也2006]．]
* 一般にベイズは点推定と違い，確度が低いモデルも捨てずに推定に利用するため，より好ましい統計的推定を実行できる．これは **縮小推定** または partial pooling のキーワードの下でも追及されており，階層モデルは自然な縮小推定が実行される典型的な設定である．

:::

全体の係数のみに興味がある場合，グループレベルの変動やデータの階層構造は局外構造である．このような状況では，誤差が相関を持つ場合にも頑健な点推定手法として，一般化推定方程式法なども用いることができる．^[この点については [11.6 節 @Gelman-Hill2006 p.248]，[@Carlin+2001] などを参照．]

## 線型階層モデル

### 導入

階層モデル
$$
y_i=\al_{j[i]}+\beta x_i+\ep_i,
$$
$$
\al_j=\mu_\al+\eta_j,\qquad\eta_j\sim\rN(0,\sigma^2_\al),
$$
は２つの別の階層にある回帰モデルが，１つに統合された形をしている．

全く等価だが $D_i$ を $i$ 番目の成分のみが $1$ のベクトル，$\al=(\al_1,\cdots,\al_J)^\top$ として
$$
y_i=D_i\al+\beta x_i+\ep_i
$$
と表すことができる．こうみると $J$ 個のクラスそれぞれに関する指示変数で定数項を置き換えた単一の回帰モデルと見ることもできる．

## 文献紹介 {.appendix}

